import{u as Ce,r as u,R as Ie,j as e,B as b,T as C,P as ge,C as Sr,A as Ct,a as He,D as Hn,b as vr,I as Cr,F as ut,c as Ot,S as Dt,L as Un,M as Ze,d as et,e as Wt,f as Y,g as sn,h as Sn,i as ne,E as an,k as on,l as ln,m as Nn,n as zn,o as En,p as qe,q as oe,s as Ve,t as Gn,v as Mn,w as Kn,x as Dr,y as kr,z as st,G as Fr,H as ct,J as dt,K as Nr,N as zr,O as vt,Q as Er,U as ht,V as Lt,W as Mr,X as Yn,Y as Tr,Z as Ht,_ as qn,$ as Ar,a0 as kt,a1 as Ir,a2 as Rr,a3 as Ft,a4 as Nt,a5 as mt,a6 as zt,a7 as Tn,a8 as cn,a9 as $t,aa as Bt,ab as vn,ac as Pr,ad as In,ae as Rn,af as fn,ag as Vt,ah as Zn,ai as Jn,aj as Xn,ak as Qn,al as er,am as Wr,an as Ke,ao as jt,ap as wt,aq as Lr,ar as bn,as as _r,at as $r,au as Br,av as Vr,aw as Qt,ax as It,ay as Or,az as Hr,aA as Ur,aB as Gr,aC as Kr,aD as Yr,aE as qr,aF as Zr,aG as Be,aH as Jr,aI as Xr,aJ as Pn,aK as Wn,aL as Ln,aM as Qr,aN as _t,aO as Cn,aP as Dn,aQ as Rt,aR as nn,aS as es,aT as rn,aU as ts,aV as ns,aW as rs,aX as ss,aY as as,aZ as os,a_ as is,a$ as ls,b0 as cs,b1 as ds,b2 as us,b3 as hs,b4 as ms,b5 as gs,b6 as xs,b7 as ps,b8 as fs}from"./vendor-BUlXP2fl.js";import"./index-YCB0_Kmy.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();var Co=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Do(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const bs=t=>{if(t===0)return"0 Bytes";const n=1024,a=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(n));return Math.round(t/Math.pow(n,r)*100)/100+" "+a[r]},ys=t=>t.split(".").pop()?.toLowerCase()==="csv"?e.jsx(vr,{color:"info"}):e.jsx(Cr,{color:"success"}),js=({onFilesUpload:t,disabled:n})=>{const{t:a}=Ce(),[r,s]=u.useState([]),[o,l]=u.useState(!1),[c,h]=u.useState(null),f=Ie.useRef(null),d=D=>{const k=[],T=[],V=[".xlsx",".xls",".csv"];return D.forEach(L=>{const U=L.name.toLowerCase();V.some(q=>U.endsWith(q))?k.push(L):T.push(`"${L.name}" is not a valid Excel or CSV file`)}),{valid:k,errors:T}},y=u.useCallback(D=>{const k=Array.from(D),{valid:T,errors:V}=d(k);if(V.length>0?h(V.join("; ")):h(null),T.length>0){const L=T.map(q=>({name:q.name,size:q.size,type:q.type}));s(L);const U=T.reduce((q,re)=>(q.push(re),q),[]),J=new DataTransfer;U.forEach(q=>J.items.add(q)),t(J.files)}},[t]),x=u.useCallback(D=>{D.preventDefault(),D.stopPropagation(),n||l(!0)},[n]),g=u.useCallback(D=>{D.preventDefault(),D.stopPropagation(),l(!1)},[]),p=u.useCallback(D=>{D.preventDefault(),D.stopPropagation()},[]),S=u.useCallback(D=>{D.preventDefault(),D.stopPropagation(),l(!1),!n&&D.dataTransfer.files.length>0&&y(D.dataTransfer.files)},[n,y]),z=D=>{D.target.files&&D.target.files.length>0&&y(D.target.files)},$=()=>{f.current?.click()},F=(D,k)=>{k.stopPropagation();const T=[...r];if(T.splice(D,1),s(T),T.length>0){const V=new DataTransfer;T.forEach(L=>{const U=new File([],L.name,{type:L.type});V.items.add(U)}),t(V.files)}else{const V=new DataTransfer;t(V.files)}};return e.jsxs(b,{sx:{width:"100%"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,sx:{mb:2},children:a("uploader.title")}),e.jsxs(ge,{elevation:o?8:2,sx:{p:4,border:"2px dashed",borderColor:o?"primary.main":"divider",bgcolor:o?"action.hover":"background.paper",cursor:n?"not-allowed":"pointer",transition:"all 0.3s ease",textAlign:"center",opacity:n?.6:1},onDragEnter:x,onDragLeave:g,onDragOver:p,onDrop:S,onClick:n?void 0:$,children:[e.jsx("input",{accept:".xlsx, .xls, .csv",style:{display:"none"},id:"excel-file-input",multiple:!0,type:"file",onChange:z,disabled:n,ref:f}),e.jsxs(b,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(Sr,{sx:{fontSize:64,color:o?"primary.main":"text.secondary",transition:"color 0.3s ease"}}),e.jsxs(b,{children:[e.jsx(C,{variant:"h6",color:"text.primary",children:a(o?"uploader.dropFiles":"uploader.dragDrop")}),e.jsx(C,{variant:"body2",color:"text.secondary",sx:{mt:1},children:a("uploader.orClick")})]}),e.jsx(C,{variant:"caption",color:"text.secondary",children:a("uploader.supportedFormats")})]})]}),c&&e.jsx(Ct,{severity:"error",sx:{mt:2},children:c}),r.length>0&&e.jsxs(b,{sx:{mt:3},children:[e.jsx(C,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:a("uploader.selectedFiles",{count:r.length})}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:r.map((D,k)=>e.jsx(He,{icon:ys(D.name),label:`${D.name} (${bs(D.size)})`,onDelete:T=>F(k,T),deleteIcon:e.jsx(Hn,{}),variant:"outlined",size:"medium"},k))})]})]})},ws=()=>{try{return localStorage.getItem("excel-processor-debug")==="true"}catch{return!1}},An=(t,n,...a)=>{if(!ws()&&t==="debug")return;const s=[`[${new Date().toISOString()}]`,n,...a];switch(t){case"debug":console.debug(...s);break;case"info":console.info(...s);break;case"warn":console.warn(...s);break;case"error":console.error(...s);break}},me=(t,...n)=>An("debug",t,...n),dn=(t,...n)=>An("warn",t,...n),yn=(t,...n)=>An("error",t,...n),Ss=({data:t,onColumnSelect:n})=>{const{t:a}=Ce(),[r,s]=u.useState([]),[o,l]=u.useState(""),[c,h]=u.useState(1);u.useEffect(()=>{if(t.length>0){me("ColumnSelector","data[0] sample:",t[0]),me("ColumnSelector","all keys:",Object.keys(t[0]));const y=Object.keys(t[0]),x=k=>/^[A-Z]+$/.test(k)||/^__EMPTY/.test(k),g=y.filter(k=>!k.startsWith("_")),p=g.length>0&&!g.every(x),S=Math.min(3,t.length),z=[];me("ColumnSelector","rawHeaders:",y),y.forEach(k=>{if(!(k==="_sourceFileName"||k==="_sourceSheetName"))for(let T=0;T<S;T++){const L=t[T][k],U=L!=null&&L!==""?String(L):"(empty)";let J=k;if(k.startsWith("__EMPTY_")){let q=parseInt(k.replace("__EMPTY_",""),10);isNaN(q)&&(q=y.indexOf(k));let re="",ae=q+1;for(;ae>0;)re=String.fromCharCode(65+(ae-1)%26)+re,ae=Math.floor((ae-1)/26);J=re||k}z.push({original:k,display:`${J}: "${U}"`,rowIndex:T+1,value:U})}}),s(z),me("ColumnSelector","allColumns built:",z.length,"options");const $=["name","이름","성명","Name","NAME","이름 "," 성명"],F=k=>$.some(T=>k.toLowerCase().includes(T.toLowerCase())),D=z.find(k=>F(k.original)||F(k.display)||F(k.value));if(D){me("ColumnSelector","auto-selecting name column:",D),l(D.original);const k=p?0:D.rowIndex;h(k),n(D.original,k)}else{const k=z.find(T=>T.rowIndex===1&&T.value!=="(empty)");if(k){me("ColumnSelector","auto-selecting first non-empty:",k),l(k.original);const T=p?0:k.rowIndex;h(T),n(k.original,T)}else if(z.length>0){me("ColumnSelector","selecting first available:",z[0]),l(z[0].original);const T=p?0:z[0].rowIndex;h(T),n(z[0].original,T)}else me("ColumnSelector","no columns to select!")}}},[t,n]);const f=y=>{const x=y.target.value,[g,p]=x.split("-"),S=parseInt(g,10),z=r.find($=>$.original===p&&$.rowIndex===S);if(z){me("ColumnSelector","user selected:",z),l(p);const $=Object.keys(t[0]||{}),F=V=>/^[A-Z]+$/.test(V)||/^__EMPTY/.test(V),D=$.filter(V=>!V.startsWith("_")),T=D.length>0&&!D.every(F)?0:S;h(T),n(p,T)}},d=r.reduce((y,x)=>(y[x.rowIndex]||(y[x.rowIndex]=[]),y[x.rowIndex].push(x),y),{});return me("ColumnSelector","groupedColumns:",Object.keys(d)),me("ColumnSelector","selectedColumn value:",o),t.length===0?null:r.length===0?(me("ColumnSelector","no columns available!"),null):e.jsxs(b,{sx:{mt:3,width:"100%"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:a("columnSelector.title")}),e.jsx(C,{variant:"body2",color:"text.secondary",sx:{mb:1},children:a("columnSelector.subtitle")}),e.jsxs(ut,{fullWidth:!0,children:[e.jsx(Ot,{id:"column-select-label",children:a("columnSelector.label")}),e.jsx(Dt,{labelId:"column-select-label",id:"column-select",value:c?`${c}-${o}`:"",label:a("columnSelector.label"),onChange:f,MenuProps:{PaperProps:{sx:{maxHeight:600}}},children:Object.entries(d).flatMap(([y,x])=>[e.jsx(Un,{sx:{bgcolor:"grey.100",fontWeight:"bold"},children:a("columnSelector.row",{number:y})},`header-${y}`),...x.map(g=>e.jsx(Ze,{value:`${g.rowIndex}-${g.original}`,children:e.jsx(b,{sx:{display:"flex",flexDirection:"column"},children:e.jsx(C,{variant:"body2",sx:{fontWeight:g.value!=="(empty)"?"bold":"normal"},children:g.display})})},`${g.rowIndex}-${g.original}`))])})]})]})},vs=[{id:"name",numeric:!1,label:"Name"}];function Cs(t){const{onSelectAllClick:n,order:a,orderBy:r,numSelected:s,rowCount:o,onRequestSort:l}=t,c=h=>f=>{l(f,h)};return e.jsx(Mn,{children:e.jsxs(qe,{children:[e.jsx(oe,{padding:"checkbox",children:e.jsx(Ve,{color:"primary",indeterminate:s>0&&s<o,checked:o>0&&s===o,onChange:n,inputProps:{"aria-label":"select all names"}})}),vs.map(h=>e.jsx(oe,{align:h.numeric?"right":"left",padding:"normal",sortDirection:r===h.id?a:!1,children:e.jsx(Kn,{active:r===h.id,direction:r===h.id?a:"asc",onClick:c(h.id),children:h.label})},h.id))]})})}const Ds=({data:t,nameColumn:n,headerRowIndex:a,selectedNames:r,onNamesSelect:s})=>{const{t:o}=Ce(),[l,c]=u.useState(""),[h,f]=u.useState("asc"),[d,y]=u.useState("name"),[x,g]=u.useState(0),[p,S]=u.useState(10),[z,$]=u.useState(!0),F=u.useMemo(()=>{if(!n||t.length===0)return[];const _=a-1;let A=n;if((v=>/^[A-Z]+$/.test(v)||/^__EMPTY/.test(v))(n)&&_>=0&&_<t.length){const P=t[_][n];P!=null&&P!==""&&(A=String(P))}const E=t.filter((v,P)=>P!==_).map(v=>A in v?v[A]:v[n]).filter(Boolean);return me("UniqueNameList","Debug:"),me("UniqueNameList","- Original column key:",n),me("UniqueNameList","- Header row index:",a),me("UniqueNameList","- Actual column name from header:",A),me("UniqueNameList","- Total rows:",t.length),me("UniqueNameList","- Names found:",E.slice(0,10)),Array.from(new Set(E))},[t,n,a]),D=(_,A)=>{f(d===A&&h==="asc"?"desc":"asc"),y(A)},k=u.useMemo(()=>[...F.filter(A=>r.includes(A))].sort((A,I)=>(h==="desc"?-1:1)*String(A).localeCompare(String(I))),[F,r,h]),T=u.useMemo(()=>{if(!l)return[];const _=l.toLowerCase();return k.filter(A=>String(A).toLowerCase().includes(_))},[k,l]),V=u.useMemo(()=>{const _=l.toLowerCase();return[...F.filter(I=>!r.includes(I)).filter(I=>String(I).toLowerCase().includes(_))].sort((I,E)=>(h==="desc"?-1:1)*String(I).localeCompare(String(E)))},[F,r,l,h]),L=u.useMemo(()=>l?[...T,...V]:z?[...k,...F.filter(_=>!r.includes(_)).sort((_,A)=>(h==="desc"?-1:1)*String(_).localeCompare(String(A)))]:F.filter(_=>!r.includes(_)).sort((_,A)=>(h==="desc"?-1:1)*String(_).localeCompare(String(A))),[k,T,V,F,r,z,l,h]),U=T.length,J=_=>{r.length>0?s([]):s(L)},q=(_,A)=>{const I=r.indexOf(A);let E=[];I===-1?E=E.concat(r,A):I===0?E=E.concat(r.slice(1)):I===r.length-1?E=E.concat(r.slice(0,-1)):I>0&&(E=E.concat(r.slice(0,I),r.slice(I+1))),s(E)},re=(_,A)=>{g(A)},ae=_=>{S(parseInt(_.target.value,10)),g(0)},xe=_=>r.indexOf(_)!==-1,he=u.useMemo(()=>{if(!l)return[];const _=l.toLowerCase();return F.filter(A=>String(A).toLowerCase().includes(_))},[F,l]),Z=()=>{const _=new Set(r);he.forEach(A=>_.add(A)),s(Array.from(_))},ie=()=>{const _=new Set(he),A=r.filter(I=>!_.has(I));s(A)};if(!n||t.length===0)return null;const le=p>0?L.slice(x*p,x*p+p):L,de=x>0?Math.max(0,(1+x)*p-L.length):0;return e.jsxs(b,{sx:{mt:4,width:"100%"},children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(C,{variant:"h6",children:o("uniqueNames.title")}),e.jsx(C,{variant:"body2",color:"text.secondary",children:o("uniqueNames.found",{count:F.length,column:n})})]}),e.jsx(et,{fullWidth:!0,variant:"outlined",placeholder:o("uniqueNames.searchPlaceholder"),value:l,onChange:_=>{c(_.target.value),g(0)},InputProps:{startAdornment:e.jsx(Wt,{position:"start",children:e.jsx(Sn,{})}),endAdornment:l&&e.jsx(Wt,{position:"end",children:e.jsx(Y,{onClick:()=>c(""),edge:"end",children:e.jsx(sn,{})})})},sx:{mb:2}}),r.length>0&&e.jsxs(ge,{sx:{p:1.5,mb:2,bgcolor:"action.hover"},children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:()=>$(!z),children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{size:"small",label:`${r.length} ${o("uniqueNames.selected")}`,color:"primary"}),l&&U>0&&e.jsxs(C,{variant:"caption",color:"text.secondary",children:["(",o("uniqueNames.matchSearch",{count:U}),")"]})]}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{size:"small",onClick:_=>{_.stopPropagation(),s([])},color:"error",children:o("uniqueNames.clearAll")}),e.jsx(Y,{size:"small",children:z?e.jsx(an,{}):e.jsx(on,{})})]})]}),e.jsx(ln,{in:z,children:e.jsx(b,{sx:{mt:1.5,display:"flex",flexWrap:"wrap",gap:.5,maxHeight:150,overflowY:"auto"},children:k.map(_=>e.jsx(He,{label:_,size:"small",onDelete:()=>q({},_),sx:{maxWidth:200,"& .MuiChip-label":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},_))})})]}),l&&e.jsxs(b,{sx:{mb:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(C,{variant:"body2",color:"text.secondary",children:o("uniqueNames.searchResults",{count:L.length,term:l})}),U>0&&e.jsx(He,{size:"small",label:`${U} ${o("uniqueNames.selected")}`,color:"primary",variant:"outlined"}),e.jsxs(b,{sx:{display:"flex",gap:.5,ml:"auto"},children:[e.jsx(ne,{size:"small",variant:"outlined",onClick:Z,disabled:he.length===U,children:o("uniqueNames.selectAll")}),e.jsx(ne,{size:"small",variant:"outlined",color:"error",onClick:ie,disabled:U===0,children:o("uniqueNames.deselectAll")})]})]}),e.jsxs(ge,{sx:{width:"100%",mb:2},children:[e.jsx(Nn,{children:e.jsxs(zn,{stickyHeader:!0,"aria-label":"unique names table",children:[e.jsx(Cs,{numSelected:r.length,order:h,orderBy:d,onSelectAllClick:J,onRequestSort:D,rowCount:F.length}),e.jsxs(En,{children:[le.map((_,A)=>{const I=xe(_),E=`enhanced-table-checkbox-${A}`;return e.jsxs(qe,{hover:!0,onClick:v=>q(v,_),role:"checkbox","aria-checked":I,tabIndex:-1,selected:I,sx:{cursor:"pointer"},children:[e.jsx(oe,{padding:"checkbox",children:e.jsx(Ve,{color:"primary",checked:I,inputProps:{"aria-labelledby":E}})}),e.jsx(oe,{component:"th",id:E,scope:"row",sx:{minWidth:150},children:e.jsx(C,{noWrap:!0,children:_})})]},_)}),de>0&&e.jsx(qe,{style:{height:53*de},children:e.jsx(oe,{colSpan:2})})]})]})}),e.jsx(Gn,{rowsPerPageOptions:[5,10,25],component:"div",count:L.length,rowsPerPage:p,page:x,onPageChange:re,onRowsPerPageChange:ae})]})]})},ks=({templates:t,selectedTemplate:n,onTemplateChange:a})=>{const r=s=>{const o=t.find(l=>l.id===s.target.value);o&&a(o)};return e.jsxs(ut,{fullWidth:!0,size:"small",children:[e.jsx(Ot,{children:"PDF Template"}),e.jsx(Dt,{value:n.id,label:"PDF Template",onChange:r,children:t.map(s=>e.jsxs(Ze,{value:s.id,children:[s.name," - ",s.description]},s.id))})]})},Te=({type:t,label:n,value:a,onChange:r,options:s,radioOptions:o,radioGroupName:l,disabled:c=!1,fullWidth:h=!0,sx:f,textColor:d,helperText:y})=>{const x={mb:2,...f};switch(t){case"text":return e.jsx(et,{label:n,value:a||"",onChange:g=>r(g.target.value),disabled:c,fullWidth:h,sx:x,size:"small",InputProps:{style:d?{color:d}:void 0}});case"number":return e.jsx(et,{label:n,type:"number",value:typeof a=="number"?Math.round(a*100)/100:a||"",onChange:g=>{const p=parseFloat(g.target.value),S=isNaN(p)?0:Math.round(p*100)/100;r(S)},disabled:c,fullWidth:h,sx:x,size:"small",InputProps:{inputProps:{step:"0.01",min:"0",lang:"en-US"},style:d?{color:d}:void 0}});case"checkbox":return e.jsx(b,{sx:x,children:e.jsx(st,{control:e.jsx(Ve,{checked:a===!0||a==="true",onChange:g=>r(g.target.checked),disabled:c}),label:e.jsxs(b,{children:[e.jsx(C,{variant:"body2",component:"div",children:n}),y&&e.jsx(C,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:y})]})})});case"select":return e.jsxs(ut,{fullWidth:h,sx:x,size:"small",children:[e.jsx(Ot,{id:`select-${n}`,children:n}),e.jsx(Dt,{labelId:`select-${n}`,value:a||"",label:n,onChange:g=>r(g.target.value),disabled:c,children:s?.map(g=>e.jsx(Ze,{value:g,children:g},g))})]});case"radio":return e.jsxs(ut,{sx:x,fullWidth:h,children:[e.jsx(Dr,{component:"legend",children:n}),e.jsx(kr,{name:l||"radio-group",value:a,onChange:g=>r(g.target.value),children:o?.map(g=>e.jsx(st,{value:g.value,control:e.jsx(Fr,{}),label:e.jsxs(b,{children:[e.jsx(C,{variant:"body2",component:"div",children:g.label}),g.helperText&&e.jsx(C,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:g.helperText})]})},g.value))})]});default:return null}},Fs=["Jan.","Feb.","Mär.","Apr.","Mai.","Jun.","Jul.","Aug.","Sep.","Okt.","Nov.","Dez."],en=["null","eins","zwei","drei","vier","fünf","sechs","sieben","acht","neun","zehn","elf","zwölf","dreizehn","vierzehn","fünfzehn","sechzehn","siebzehn","achtzehn","neunzehn"],jn=["","","zwanzig","dreißig","vierzig","fünfzig","sechzig","siebzig","achtzig","neunzig"];function _n(t){if(t<0||t>11)throw new Error(`Invalid month index: ${t}`);return Fs[t]}function kn(t){const n=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear();return`${n}.${a}.${r}`}function Ns(){return kn(new Date)}function Oe(t){return t.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2})}function gt(t){return t.toLocaleString("de-DE",{minimumFractionDigits:1,maximumFractionDigits:1})+"%"}function zs(t){if(t===0)return"null";const n=Math.floor(t),a=Math.round((t-n)*100);let r=Qe(n);return a>0?r+=` Euro und ${Qe(a)} Cent`:r+=" Euro",r}function Qe(t){if(t===0)return en[0];if(t<0)return"minus "+Qe(-t);if(t<20)return en[t];if(t<100){const n=Math.floor(t/10),a=t%10;return a===0?jn[n]:a===1?"einund"+jn[n]:en[a]+"und"+jn[n]}if(t<1e3){const n=Math.floor(t/100),a=t%100;return n===1?a>0?"einhundert "+Qe(a):"einhundert":en[n]+"hundert"+(a>0?" "+Qe(a):"")}if(t<1e6){const n=Math.floor(t/1e3),a=t%1e3,r=n===1?"eintausend":Qe(n)+"tausend";return a>0?r+" "+Qe(a):r}if(t<1e9){const n=Math.floor(t/1e6),a=t%1e6,r=n===1?"eine Million":Qe(n)+" Millionen";return a>0?r+" "+Qe(a):r}return String(t)}function Es(t){if(!isFinite(t))return null;const a=new Date(Date.UTC(1899,11,30)).getTime()+t*24*60*60*1e3,r=new Date(a);return isNaN(r.getTime())?null:r}function tr(t){const n=String(t).trim();if(!n)return null;let a=n.match(/(\d{4})[-\/.](\d{1,2})[-\/.](\d{1,2})/);if(a){const r=parseInt(a[1],10),s=parseInt(a[2],10)-1,o=parseInt(a[3],10),l=new Date(r,s,o);return isNaN(l.getTime())?null:l}if(a=n.match(/(\d{1,2})[.\/-](\d{1,2})[.\/-](\d{2,4})/),a){const r=parseInt(a[1],10),s=parseInt(a[2],10)-1,o=parseInt(a[3],10),l=o<100?2e3+o:o,c=new Date(l,s,r);return isNaN(c.getTime())?null:c}if(a=n.match(/(\d{4})(\d{2})(\d{2})/),a){const r=parseInt(a[1],10),s=parseInt(a[2],10)-1,o=parseInt(a[3],10),l=new Date(r,s,o);return isNaN(l.getTime())?null:l}return null}function Fn(t){if(t==null)return null;if(t instanceof Date)return isNaN(t.getTime())?null:t;if(typeof t=="number"){if(t>2e4&&t<8e4)return Es(t);const n=new Date(t);return isNaN(n.getTime())?null:n}return typeof t=="string"?tr(t):null}function Ms(t){for(const n of Object.keys(t)){if(n==="_sourceFileName"||n==="_sourceSheetName")continue;const a=t[n];if(typeof a=="string"){const r=tr(a);if(r)return r}else if(typeof a=="number"){const r=Fn(a);if(r)return r}else if(a instanceof Date){const r=Fn(a);if(r)return r}}return null}function Ts(t,n,a,r=/(\d{8})/){const s=new Array(12).fill(0);let o=null,l=null,c=null;for(const d of t){let y=null;if(a&&d[a]&&(y=Fn(d[a])),!y){const g=(d._sourceFileName||"").match(r);if(g){const p=g[1],S=parseInt(p.substring(0,4),10),z=parseInt(p.substring(4,6),10)-1,$=parseInt(p.substring(6,8),10),F=new Date(S,z,$);isNaN(F.getTime())||(y=F)}}if(y||(y=Ms(d)),y){const x=y.getFullYear(),g=y.getMonth();(l===null||y<l)&&(l=y),(c===null||y>c)&&(c=y),o===null&&(o=x);const p=d[n],S=typeof p=="number"?p:parseFloat(String(p).replace(/\s/g,""))||0;g>=0&&g<12&&(s[g]+=S)}}const h=s.reduce((d,y)=>d+y,0);let f="";if(l&&c&&o!==null){const d=_n(l.getMonth()),y=_n(c.getMonth());f=`${d} - ${y} ${o}`}else o=o!==null?o:new Date().getFullYear(),f=`Jan. - Dez. ${o}`;return{jan:s[0],feb:s[1],mar:s[2],apr:s[3],may:s[4],jun:s[5],jul:s[6],aug:s[7],sep:s[8],oct:s[9],nov:s[10],dec:s[11],total:h,dateRange:f,year:o}}const As=({open:t,onClose:n,onConfirm:a,context:r,template:s})=>{const{t:o}=Ce(),[l,c]=u.useState(""),[h,f]=u.useState(""),[d,y]=u.useState(""),[x,g]=u.useState({jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0}),[p,S]=u.useState(0),[z,$]=u.useState(""),[F,D]=u.useState(""),[k,T]=u.useState(""),[V,L]=u.useState("Kelsterbach"),[U,J]=u.useState("no"),[q,re]=u.useState("freistellungsbescheid"),[ae,xe]=u.useState("Frankfurt/Main StNr. 14 255 72251"),[he,Z]=u.useState("23.12.2025"),[ie,le]=u.useState("Frankfurt/Main StNr. 4525057301"),[de,_]=u.useState("29.04.2011"),[A,I]=u.useState("27.12.2016"),[E,v]=u.useState(!0),[P,H]=u.useState("#FF0000"),[te,ee]=u.useState([]),Q=[{name:o("pdfExport.colors.red"),value:"#FF0000"},{name:o("pdfExport.colors.black"),value:"#000000"},{name:o("pdfExport.colors.blue"),value:"#0000FF"},{name:o("pdfExport.colors.green"),value:"#008000"},{name:o("pdfExport.colors.darkBlue"),value:"#00008B"},{name:o("pdfExport.colors.brown"),value:"#A52A2A"},{name:o("pdfExport.colors.purple"),value:"#800080"},{name:o("pdfExport.colors.gray"),value:"#808080"}];u.useEffect(()=>{if(t){const R=[],fe=se=>/^[-]?(\d+\.?\d*|\.\d+)([eE][-+]?\d+)?$/.test(String(se).trim());for(const se of r.visibleHeaders)if(!(se.id==="_sourceFileName"||se.id==="_sourceSheetName"))for(const G of r.data){const ye=G[se.id];if(ye!=null&&ye!==""){if(typeof ye=="number"||typeof ye=="string"&&fe(ye)){R.push({id:se.id,label:se.label});break}break}}if(ee(R),R.length>0&&!d?y(R[0].id):R.length>0&&d&&(R.some(G=>G.id===d)||y(R[0].id)),l||(r.selectedNames.length===1||r.selectedNames.length>1)&&c(r.selectedNames[0]),T(Ns()),J("no"),re("freistellungsbescheid"),v(!0),s.customFieldDefaults){const se=s.customFieldDefaults,G={signatureLocation:L,taxExemptionOption:re,taxNumber1:xe,taxDate1:Z,taxNumber2:le,taxDate2:_,taxValidFrom:I},ye=De();Object.entries(se).forEach(([_e,Ne])=>{const ze=G[_e];if(ze){const ke=ye?.[_e]??Ne;ke!=null&&ze(ke)}})}}},[t,r.data,r.visibleHeaders,r.selectedNames,s]),u.useEffect(()=>{if(d&&r.data.length>0){const R=r.data.filter(Ne=>r.includedIndices.has(Ne._stableIndex)),fe=r.sourceFiles.length>0&&r.sourceFiles.every(Ne=>Ne.toLowerCase().endsWith(".csv"));let se;if(fe){const Ne=r.visibleHeaders.find(ze=>ze.label.toLowerCase().includes("source file")&&ze.id!=="_sourceFileName");if(Ne)se=Ne.id;else{const ze=ke=>typeof ke=="string"&&/(\d{4}[\/-]\d{1,2}[\/-]\d{1,2})|(\d{1,2}[.\/-]\d{1,2}[.\/-]\d{2,4})|(\d{8})/.test(ke);for(const ke of r.visibleHeaders){if(ke.id==="_sourceFileName"||ke.id==="_sourceSheetName")continue;if(R.some(Xe=>ze(Xe[ke.id]))){se=ke.id;break}}}}const G=Ts(R,d,se);g({jan:G.jan,feb:G.feb,mar:G.mar,apr:G.apr,may:G.may,jun:G.jun,jul:G.jul,aug:G.aug,sep:G.sep,oct:G.oct,nov:G.nov,dec:G.dec});const ye={jan:Math.round(G.jan*100)/100,feb:Math.round(G.feb*100)/100,mar:Math.round(G.mar*100)/100,apr:Math.round(G.apr*100)/100,may:Math.round(G.may*100)/100,jun:Math.round(G.jun*100)/100,jul:Math.round(G.jul*100)/100,aug:Math.round(G.aug*100)/100,sep:Math.round(G.sep*100)/100,oct:Math.round(G.oct*100)/100,nov:Math.round(G.nov*100)/100,dec:Math.round(G.dec*100)/100};g(ye);const _e=Object.values(ye).reduce((Ne,ze)=>Ne+ze,0);S(Math.round(_e*100)/100),D(G.dateRange)}},[d,r.data,r.includedIndices,r.visibleHeaders,r.sourceFiles]),u.useEffect(()=>{$(zs(p))},[p]);const pe=R=>{y(R.target.value)},be=(R,fe)=>{const se={...x,[R]:fe};g(se);const G=Object.values(se).reduce((ye,_e)=>ye+_e,0);S(Math.round(G*100)/100)},O="pdfExportDefaults",X=()=>{const R={signatureLocation:V,taxExemptionOption:q,taxNumber1:ae,taxDate1:he,taxNumber2:ie,taxDate2:de,taxValidFrom:A};localStorage.setItem(O,JSON.stringify(R))},De=()=>{try{const R=localStorage.getItem(O);if(R)return JSON.parse(R)}catch(R){console.warn("Failed to load PDF export defaults from storage:",R)}return null},Ue=()=>{if(localStorage.removeItem(O),s.customFieldDefaults){const R=s.customFieldDefaults,fe={signatureLocation:L,taxExemptionOption:re,taxNumber1:xe,taxDate1:Z,taxNumber2:le,taxDate2:_,taxValidFrom:I};Object.entries(R).forEach(([se,G])=>{const ye=fe[se];ye&&G!==void 0&&G!==null&&ye(G)})}},Ge=()=>{const R={donorName:l,donorAddress:h,amount:p.toFixed(2),amountInWords:z,donationPeriod:F,issueDate:k,signatureLocation:V,verzichtJa:String(U==="yes"),verzichtNein:String(U==="no"),taxExemptionOption:q,taxNumber1:ae,taxDate1:he,taxNumber2:ie,taxDate2:de,taxValidFrom:A,notMembership:String(E),...x};X(),a(R,P)},xt=["Jan.","Feb.","Mär.","Apr.","Mai.","Jun.","Jul.","Aug.","Sep.","Okt.","Nov.","Dez."],pt=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];return e.jsxs(ct,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,scroll:"paper",children:[e.jsx(dt,{children:e.jsxs(b,{sx:{position:"relative",pr:20},children:[o("pdfExport.customFields.title"),e.jsxs(b,{sx:{position:"absolute",right:0,top:-8,display:"flex",alignItems:"center",gap:.5},children:[Q.slice(0,6).map(R=>e.jsx(b,{onClick:()=>H(R.value),sx:{width:24,height:24,backgroundColor:R.value,border:P===R.value?"2px solid #1976d2":"1px solid #ddd",borderRadius:.5,cursor:"pointer",transition:"all 0.2s","&:hover":{transform:"scale(1.15)",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}},title:R.name},R.value)),e.jsxs(b,{sx:{position:"relative",width:24,height:24,border:"1px dashed #999",borderRadius:.5,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:[e.jsx("input",{type:"color",value:P,onChange:R=>H(R.target.value),style:{position:"absolute",width:"100%",height:"100%",opacity:0,cursor:"pointer"}}),e.jsx(Nr,{sx:{fontSize:14,color:"#666"}})]}),e.jsx(b,{onClick:Ue,sx:{display:"flex",alignItems:"center",gap:.5,px:1,py:.5,border:"1px dashed #999",borderRadius:.5,cursor:"pointer",transition:"all 0.2s","&:hover":{backgroundColor:"#f5f5f5",borderColor:"#666"}},title:o("pdfExport.resetDefaults"),children:e.jsx(zr,{sx:{fontSize:14,color:"#666"}})})]})]})}),e.jsxs(vt,{sx:{pb:2},children:[e.jsx(C,{variant:"h6",sx:{mt:2,mb:1},children:o("pdfExport.customFields.donorName")}),e.jsxs(ge,{variant:"outlined",sx:{p:2,mb:2},children:[r.selectedNames.length>1?e.jsx(Er,{freeSolo:!0,options:r.selectedNames,value:l,inputValue:l,onChange:(R,fe)=>c(fe||""),onInputChange:(R,fe)=>c(fe),renderInput:R=>e.jsx(et,{...R,label:o("pdfExport.customFields.donorName"),size:"small",sx:{mb:2},InputProps:{...R.InputProps,style:P?{color:P}:void 0}})}):e.jsx(Te,{type:"text",label:o("pdfExport.customFields.donorName"),value:l,onChange:c,textColor:P}),e.jsx(Te,{type:"text",label:o("pdfExport.customFields.address"),value:h,onChange:f,sx:{mb:0},textColor:P})]}),e.jsx(C,{variant:"h6",sx:{mt:2,mb:1},children:o("pdfExport.customFields.amountColumn")}),e.jsxs(ge,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(ut,{fullWidth:!0,size:"small",children:[e.jsx(Ot,{id:"amount-column-label",children:o("pdfExport.customFields.amountColumn")}),e.jsx(Dt,{labelId:"amount-column-label",value:d,label:o("pdfExport.customFields.amountColumn"),onChange:pe,children:te.map(R=>e.jsx(Ze,{value:R.id,children:R.label},R.id))})]}),e.jsx(C,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:o("pdfExport.customFields.amountColumnHint")})]}),e.jsx(C,{variant:"h6",sx:{mt:2,mb:1},children:o("pdfExport.customFields.monthlyAmounts")}),e.jsx(ge,{variant:"outlined",sx:{p:2,mb:2},children:e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:pt.map((R,fe)=>e.jsx(b,{sx:{width:{xs:"45%",sm:"30%",md:"23%"}},children:e.jsx(Te,{type:"number",label:xt[fe],value:x[R],onChange:se=>be(R,se),sx:{mb:0},textColor:P})},R))})}),e.jsx(C,{variant:"h6",sx:{mt:2,mb:1},children:o("pdfExport.customFields.summary")}),e.jsxs(ge,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(Te,{type:"number",label:o("pdfExport.customFields.totalAmount"),value:p,onChange:S,fullWidth:!0,textColor:P}),e.jsx(Te,{type:"text",label:o("pdfExport.customFields.amountInWords"),value:z,onChange:$,fullWidth:!0,textColor:P}),e.jsx(Te,{type:"text",label:o("pdfExport.customFields.period"),value:F,onChange:D,sx:{mb:0},textColor:P})]}),e.jsx(C,{variant:"h6",sx:{mt:2,mb:1},children:o("pdfExport.customFields.taxExemptionNotice")}),e.jsxs(ge,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(Te,{type:"radio",label:o("pdfExport.customFields.taxExemptionNotice"),value:U,onChange:J,radioGroupName:"waiver-choice",radioOptions:[{value:"yes",label:o("pdfExport.customFields.waiverReimbursementYes"),helperText:o("pdfExport.customFields.waiverReimbursementYesHint")},{value:"no",label:o("pdfExport.customFields.waiverReimbursementNo"),helperText:o("pdfExport.customFields.waiverReimbursementNoHint")}]}),e.jsx(ht,{sx:{my:1}}),e.jsx(Te,{type:"checkbox",label:o("pdfExport.customFields.taxExemption"),value:E,onChange:v,helperText:o("pdfExport.customFields.taxExemptionHint")}),e.jsx(ht,{sx:{my:1}}),e.jsx(Te,{type:"radio",label:o("pdfExport.customFields.taxExemptionType"),value:q,onChange:re,radioGroupName:"tax-exemption-option",radioOptions:[{value:"freistellungsbescheid",label:o("pdfExport.customFields.taxExemptionNotice"),helperText:o("pdfExport.customFields.taxExemptionNoticeHint")},{value:"vorlaeufigeBescheinigung",label:o("pdfExport.customFields.preliminaryCertificate"),helperText:o("pdfExport.customFields.preliminaryCertificateHint")}]}),q==="freistellungsbescheid"&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{type:"text",label:o("pdfExport.customFields.taxNumber"),value:ae,onChange:xe}),e.jsx(Te,{type:"text",label:o("pdfExport.customFields.taxDate"),value:he,onChange:Z,helperText:o("pdfExport.customFields.taxDateHint"),sx:{mb:0}})]}),q==="vorlaeufigeBescheinigung"&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{type:"text",label:o("pdfExport.customFields.taxNumber"),value:ie,onChange:le}),e.jsx(Te,{type:"text",label:o("pdfExport.customFields.taxDate"),value:de,onChange:_}),e.jsx(Te,{type:"text",label:o("pdfExport.customFields.validFrom"),value:A,onChange:I,sx:{mb:0}})]})]}),e.jsx(C,{variant:"h6",sx:{mt:2,mb:1},children:o("pdfExport.customFields.signature")}),e.jsxs(ge,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(Te,{type:"text",label:o("pdfExport.customFields.location"),value:V,onChange:L,textColor:P}),e.jsx(Te,{type:"text",label:o("pdfExport.customFields.date"),value:k,onChange:T,sx:{mb:0},textColor:P})]})]}),e.jsxs(Lt,{children:[e.jsx(ne,{onClick:n,children:o("pdfExport.cancel")}),e.jsx(ne,{variant:"contained",onClick:Ge,children:o("pdfExport.exportPdf")})]})]})},$n=[{id:"german-donation-receipt1",name:"우리교회 헌금 영수증",description:"created on 20260219",page:{orientation:"portrait",format:"a4",margins:{top:15,right:15,bottom:15,left:15}},customFieldDefaults:{signatureLocation:"Kelsterbach",taxNumber1:"Frankfurt/Main StNr. 14 255 72251",taxDate1:"23.12.2025",taxNumber2:"Frankfurt/Main StNr. 4525057301",taxDate2:"29.04.2011",taxValidFrom:"27.12.2016"},sections:[{type:"box",x:15,y:15,width:180,height:20,border:!0,borderColor:"#000000",borderWidth:.3,sections:[{type:"textBlock",content:`Aussteller (Bezeichnung und Anschrift der steuerbegünstigten Einrichtung)
Koreanische Kirchengemeinde URI e. V.
Oberhöchstädter Weg 7
65760 Eschborn`,x:2,y:4,width:180,align:"left",fontSize:11}]},{type:"textBlock",content:"Bestätigung über Geldzuwendungen/Mitgliedsbeitrag",x:105,y:44,width:180,align:"center",bold:!0,fontSize:14},{type:"textBlock",content:"Im Sinne des § 10b des Einkommensteuergesetzes an eine der in § 5 Abs. 1 Nr. 9 des Körperschaftsteuergesetzes bezeichneten Körperschaften, Personenvereinigungen oder Vermögensmassen",x:15,y:52,width:180,fontSize:9},{type:"box",x:15,y:60,width:180,height:22,border:!0,borderColor:"#000000",borderWidth:.3,sections:[{type:"textBlock",content:"Name und Anschrift des Zuwendenden:",x:2,y:4,width:176,bold:!0,fontSize:10},{type:"textBlock",content:"{{customFields.donorName}}",x:2,y:12,width:176,bold:!0,fontSize:11},{type:"textBlock",content:"{{customFields.donorAddress}}",x:2,y:18,width:176,fontSize:10}]},{type:"customDataTable",x:15,y:85,headers:["Betrag der Zuwendung in Ziffern","in Buchstaben","Tag der Zuwendung"],rows:[["EUR {{customFields.amount}}","{{customFields.amountInWords}}","{{customFields.donationPeriod}}"]],options:{showHeaders:!0,repeatHeader:!1,gridLines:!0,borderWidth:.3,borderColor:"#000000",headerBackgroundColor:"#ffffff",headerTextColor:"#000000",alternateRowColors:!1,alternateRowColor1:"#ffffff",alternateRowColor2:"#ffffff",fontSize:9,cellPadding:3,align:"center"},substituteVariables:!0},{type:"textBlock",content:"Es handelt sich um den Verzicht auf Erstattung von Aufwendungen.",x:15,y:122,width:180,bold:!0,fontSize:9},{type:"checkbox",label:"Ja",checked:"{{customFields.verzichtJa}}",x:135,y:121,fontSize:9,boxSize:4,labelGap:2},{type:"checkbox",label:"Nein",checked:"{{customFields.verzichtNein}}",x:160,y:121,fontSize:9,boxSize:4,labelGap:2},{type:"divider",x:15,y:133,width:180,color:"#000000",lineWidth:.1,style:"solid"},{type:"textBlock",content:"Steuerbegünstigung",x:15,y:142,width:180,bold:!0,fontSize:11},{type:"checkbox",label:"Wir sind wegen Förderung (Angabe des begünstigten Zwecks / der begünstigten Zwecke) nach dem letzten uns zugegangenen Freistellungsbescheid bzw. nach der Anlage zum Körperschaftsteuerbescheid des Finanzamtes {{customFields.taxNumber1}}, vom {{customFields.taxDate1}} nach § 5 Abs. 1 Nr. 9 des Körperschaftsteuergesetzes von der Körperschaftsteuer und nach § 3 Nr. 6 des Gewerbesteuergesetzes von der Gewerbesteuer befreit.",checked:"{{customFields.taxExemptionOption}}",x:15,y:152,fontSize:8,boxSize:4,group:"taxExemption",groupValue:"freistellungsbescheid"},{type:"checkbox",label:"Wir sind wegen Förderung gemeinnütziger Zwecke (Religion §52 Abs.2 Satz 1 Nr. 2 AO) durch vorläufige Bescheinigung des Finanzamtes {{customFields.taxNumber2}}, vom {{customFields.taxDate2}} ab {{customFields.taxValidFrom}} als steuerbegünstigten Zwecken dienend anerkannt.",checked:"{{customFields.taxExemptionOption}}",x:15,y:175,fontSize:8,boxSize:4,group:"taxExemption",groupValue:"vorlaeufigeBescheinigung"},{type:"textBlock",content:"Es wird bestätigt, dass die Zuwendung nur zur Förderung (gemeinnütziger Zwecke) Religion § 52 Abs. 2 Satz 1 Nr. 2 Abgabenordnung verwendet wird.",x:15,y:195,width:180,bold:!0,fontSize:8},{type:"checkbox",label:"Es wird bestätigt, dass es sich nicht um einen Mitgliedsbeitrag i.S.v § 10b Abs. 1 Satz 2 Einkommensteuergesetzes handelt.",checked:"{{customFields.notMembership}}",x:15,y:210,fontSize:8,boxSize:4},{type:"divider",x:15,y:220,width:180,color:"#000000",lineWidth:.1,style:"solid"},{type:"textBlock",content:"{{customFields.signatureLocation}}, {{customFields.issueDate}}",x:15,y:243,width:100,bold:!0,fontSize:10},{type:"divider",x:15,y:245,width:180,color:"#000000",lineWidth:.5,style:"solid"},{type:"textBlock",content:"Ort, Datum und Unterschrift des Zuwendungsempfängers",x:15,y:249,width:180,fontSize:8},{type:"textBlock",content:"Hinweis",x:15,y:265,width:180,bold:!0,fontSize:10},{type:"textBlock",content:"Wer vorsätzlich oder grob fahrlässig eine unrichtige Zuwendungsbestätigung erstellt oder wer veranlasst, dass Zuwendungen nicht zu den in der Zuwendungsbestätigung angegebenen steuerbegünstigten Zwecken verwendet werden, haftet für die Steuer, die dem Fiskus durch einen etwaigen Abzug der Zuwendungen beim Zuwendenden entgeht (§ 10 b Abs. 4 EStG, § 9 Abs. 3 KStG, § 9 Nr. 5 GewStG).",x:15,y:270,width:180,fontSize:7},{type:"textBlock",content:"Diese Bestätigung wird nicht als Nachweis für die steuerliche Berücksichtigung der Zuwendung anerkannt, wenn das Datum des Freistellungsbescheides länger als 5 Jahre bzw. das Datum der vorläufigen Bescheinigung länger als 3 Jahre seit Ausstellung der Bestätigung zurückliegt (BMF vom 15.12.1994 - BStBl I S. 884).",x:15,y:280,width:180,fontSize:7},{type:"pageBreak"},{type:"textBlock",content:`Koreanische Kirchengemeinde URI e. V.
Oberhöchstädter Weg 7
65760 Eschborn`,x:105,y:20,width:180,align:"center",fontSize:11},{type:"textBlock",content:"Anhang zur Bestätigung über Geldzuwendung/Spendequittung",x:105,y:42,width:180,align:"center",bold:!0,fontSize:14},{type:"textBlock",content:"Aufstellung der Einzelzuwendungen",x:105,y:52,width:180,align:"center",bold:!0,fontSize:12},{type:"spacer",height:45},{type:"customDataTable",headers:["Datum","Betrag (EUR)","Art"],rows:[["Jan.","EUR {{customFields.jan}}","Spende"],["Feb.","EUR {{customFields.feb}}",'"'],["Mär.","EUR {{customFields.mar}}",'"'],["Apr.","EUR {{customFields.apr}}",'"'],["Mai.","EUR {{customFields.may}}",'"'],["Jun.","EUR {{customFields.jun}}",'"'],["Jul.","EUR {{customFields.jul}}",'"'],["Aug.","EUR {{customFields.aug}}",'"'],["Sep.","EUR {{customFields.sep}}",'"'],["Okt.","EUR {{customFields.oct}}",'"'],["Nov.","EUR {{customFields.nov}}",'"'],["Dez.","EUR {{customFields.dec}}",'"'],["Gesamtsumme","EUR {{customFields.amount}}","(siehe Sammelbestätigung)"]],options:{showHeaders:!0,repeatHeader:!1,gridLines:!0,borderWidth:.2,borderColor:"#000000",headerBackgroundColor:"#ffffff",headerTextColor:"#000000",alternateRowColors:!1,alternateRowColor1:"#ffffff",alternateRowColor2:"#ffffff",fontSize:10,cellPadding:3},substituteVariables:!0}]},{id:"german-donation-receipt2",name:"주안에우리교회 헌금 영수증",description:"created on 20260219",page:{orientation:"portrait",format:"a4",margins:{top:15,right:15,bottom:15,left:15}},customFieldDefaults:{signatureLocation:"Sulzbach am Taunus",taxNumber1:"Frankfurt/Main StNr. xxxx",taxDate1:"dd.mm.yyyy",taxNumber2:"Frankfurt/Main StNr. yyyy",taxDate2:"dd.mm.yyyy",taxValidFrom:"dd.mm.yyyy"},sections:[{type:"box",x:15,y:15,width:180,height:20,border:!0,borderColor:"#000000",borderWidth:.3,sections:[{type:"textBlock",content:`Aussteller (Bezeichnung und Anschrift der steuerbegünstigten Einrichtung)
Koreanische Kirchengemeinde Juane-Uri e. V.
Platz a. d. Linde 6
65843 Sulzbach (Taunus)`,x:2,y:4,width:180,align:"left",fontSize:11}]},{type:"textBlock",content:"Bestätigung über Geldzuwendungen/Mitgliedsbeitrag",x:105,y:44,width:180,align:"center",bold:!0,fontSize:14},{type:"textBlock",content:"Im Sinne des § 10b des Einkommensteuergesetzes an eine der in § 5 Abs. 1 Nr. 9 des Körperschaftsteuergesetzes bezeichneten Körperschaften, Personenvereinigungen oder Vermögensmassen",x:15,y:52,width:180,fontSize:9},{type:"box",x:15,y:60,width:180,height:22,border:!0,borderColor:"#000000",borderWidth:.3,sections:[{type:"textBlock",content:"Name und Anschrift des Zuwendenden:",x:2,y:4,width:176,bold:!0,fontSize:10},{type:"textBlock",content:"{{customFields.donorName}}",x:2,y:12,width:176,bold:!0,fontSize:11},{type:"textBlock",content:"{{customFields.donorAddress}}",x:2,y:18,width:176,fontSize:10}]},{type:"customDataTable",x:15,y:85,headers:["Betrag der Zuwendung in Ziffern","in Buchstaben","Tag der Zuwendung"],rows:[["EUR {{customFields.amount}}","{{customFields.amountInWords}}","{{customFields.donationPeriod}}"]],options:{showHeaders:!0,repeatHeader:!1,gridLines:!0,borderWidth:.3,borderColor:"#000000",headerBackgroundColor:"#ffffff",headerTextColor:"#000000",alternateRowColors:!1,alternateRowColor1:"#ffffff",alternateRowColor2:"#ffffff",fontSize:9,cellPadding:3,align:"center"},substituteVariables:!0},{type:"textBlock",content:"Es handelt sich um den Verzicht auf Erstattung von Aufwendungen.",x:15,y:122,width:180,bold:!0,fontSize:9},{type:"checkbox",label:"Ja",checked:"{{customFields.verzichtJa}}",x:135,y:121,fontSize:9,boxSize:4,labelGap:2},{type:"checkbox",label:"Nein",checked:"{{customFields.verzichtNein}}",x:160,y:121,fontSize:9,boxSize:4,labelGap:2},{type:"divider",x:15,y:133,width:180,color:"#000000",lineWidth:.1,style:"solid"},{type:"textBlock",content:"Steuerbegünstigung",x:15,y:142,width:180,bold:!0,fontSize:11},{type:"checkbox",label:"Wir sind wegen Förderung (Angabe des begünstigten Zwecks / der begünstigten Zwecke) nach dem letzten uns zugegangenen Freistellungsbescheid bzw. nach der Anlage zum Körperschaftsteuerbescheid des Finanzamtes {{customFields.taxNumber1}}, vom {{customFields.taxDate1}} nach § 5 Abs. 1 Nr. 9 des Körperschaftsteuergesetzes von der Körperschaftsteuer und nach § 3 Nr. 6 des Gewerbesteuergesetzes von der Gewerbesteuer befreit.",checked:"{{customFields.taxExemptionOption}}",x:15,y:152,fontSize:8,boxSize:4,group:"taxExemption",groupValue:"freistellungsbescheid"},{type:"checkbox",label:"Wir sind wegen Förderung gemeinnütziger Zwecke (Religion §52 Abs.2 Satz 1 Nr. 2 AO) durch vorläufige Bescheinigung des Finanzamtes {{customFields.taxNumber2}}, vom {{customFields.taxDate2}} ab {{customFields.taxValidFrom}} als steuerbegünstigten Zwecken dienend anerkannt.",checked:"{{customFields.taxExemptionOption}}",x:15,y:175,fontSize:8,boxSize:4,group:"taxExemption",groupValue:"vorlaeufigeBescheinigung"},{type:"textBlock",content:"Es wird bestätigt, dass die Zuwendung nur zur Förderung (gemeinnütziger Zwecke) Religion § 52 Abs. 2 Satz 1 Nr. 2 Abgabenordnung verwendet wird.",x:15,y:195,width:180,bold:!0,fontSize:8},{type:"checkbox",label:"Es wird bestätigt, dass es sich nicht um einen Mitgliedsbeitrag i.S.v § 10b Abs. 1 Satz 2 Einkommensteuergesetzes handelt.",checked:"{{customFields.notMembership}}",x:15,y:210,fontSize:8,boxSize:4},{type:"divider",x:15,y:220,width:180,color:"#000000",lineWidth:.1,style:"solid"},{type:"textBlock",content:"{{customFields.signatureLocation}}, {{customFields.issueDate}}",x:15,y:243,width:100,bold:!0,fontSize:10},{type:"divider",x:15,y:245,width:180,color:"#000000",lineWidth:.5,style:"solid"},{type:"textBlock",content:"Ort, Datum und Unterschrift des Zuwendungsempfängers",x:15,y:249,width:180,fontSize:8},{type:"textBlock",content:"Hinweis",x:15,y:265,width:180,bold:!0,fontSize:10},{type:"textBlock",content:"Wer vorsätzlich oder grob fahrlässig eine unrichtige Zuwendungsbestätigung erstellt oder wer veranlasst, dass Zuwendungen nicht zu den in der Zuwendungsbestätigung angegebenen steuerbegünstigten Zwecken verwendet werden, haftet für die Steuer, die dem Fiskus durch einen etwaigen Abzug der Zuwendungen beim Zuwendenden entgeht (§ 10 b Abs. 4 EStG, § 9 Abs. 3 KStG, § 9 Nr. 5 GewStG).",x:15,y:270,width:180,fontSize:7},{type:"textBlock",content:"Diese Bestätigung wird nicht als Nachweis für die steuerliche Berücksichtigung der Zuwendung anerkannt, wenn das Datum des Freistellungsbescheides länger als 5 Jahre bzw. das Datum der vorläufigen Bescheinigung länger als 3 Jahre seit Ausstellung der Bestätigung zurückliegt (BMF vom 15.12.1994 - BStBl I S. 884).",x:15,y:280,width:180,fontSize:7},{type:"pageBreak"},{type:"textBlock",content:`Koreanische Kirchengemeinde Juane-Uri e. V.
Platz a. d. Linde 6
65843 Sulzbach (Taunus)`,x:105,y:20,width:180,align:"center",fontSize:11},{type:"textBlock",content:"Anhang zur Bestätigung über Geldzuwendung/Spendequittung",x:105,y:42,width:180,align:"center",bold:!0,fontSize:14},{type:"textBlock",content:"Aufstellung der Einzelzuwendungen",x:105,y:52,width:180,align:"center",bold:!0,fontSize:12},{type:"spacer",height:45},{type:"customDataTable",headers:["Datum","Betrag (EUR)","Art"],rows:[["Jan.","EUR {{customFields.jan}}","Spende"],["Feb.","EUR {{customFields.feb}}",'"'],["Mär.","EUR {{customFields.mar}}",'"'],["Apr.","EUR {{customFields.apr}}",'"'],["Mai.","EUR {{customFields.may}}",'"'],["Jun.","EUR {{customFields.jun}}",'"'],["Jul.","EUR {{customFields.jul}}",'"'],["Aug.","EUR {{customFields.aug}}",'"'],["Sep.","EUR {{customFields.sep}}",'"'],["Okt.","EUR {{customFields.oct}}",'"'],["Nov.","EUR {{customFields.nov}}",'"'],["Dez.","EUR {{customFields.dec}}",'"'],["Gesamtsumme","EUR {{customFields.amount}}","(siehe Sammelbestätigung)"]],options:{showHeaders:!0,repeatHeader:!1,gridLines:!0,borderWidth:.2,borderColor:"#000000",headerBackgroundColor:"#ffffff",headerTextColor:"#000000",alternateRowColors:!1,alternateRowColor1:"#ffffff",alternateRowColor2:"#ffffff",fontSize:10,cellPadding:3},substituteVariables:!0}]}],Is="modulepreload",Rs=function(t){return"/excel-processor/"+t},Bn={},ko=function(n,a,r){let s=Promise.resolve();if(a&&a.length>0){let h=function(f){return Promise.all(f.map(d=>Promise.resolve(d).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");s=h(a.map(f=>{if(f=Rs(f),f in Bn)return;Bn[f]=!0;const d=f.endsWith(".css"),y=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${y}`))return;const x=document.createElement("link");if(x.rel=d?"stylesheet":Is,d||(x.as="script"),x.crossOrigin="",x.href=f,c&&x.setAttribute("nonce",c),document.head.appendChild(x),d)return new Promise((g,p)=>{x.addEventListener("load",g),x.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return n().catch(o)})};async function Ps(t){}function un(t){return/[\uAC00-\uD7AF\u1100-\u11FF\u3131-\u318E]/.test(t)}function Je(t,n,a=!1){t.setFont("helvetica",a?"bold":"normal")}async function Ws(t,n){const a=new Mr({orientation:t.page.orientation,format:t.page.format});await Ps();let r=t.page.margins.top;for(const l of t.sections)switch(l.type){case"header":r=_s(a,l,n,r);break;case"text":r=$s(a,l,n,r);break;case"summary":r=Bs(a,l,n,r);break;case"table":r=await Vs(a,l,n,r);break;case"customDataTable":const c=l;c.y!==void 0||c.x!==void 0?await Vn(a,c,n,c.y??r,c.x):r=await Vn(a,c,n,r);break;case"footer":Us(a,l,n);break;case"labeledField":rr(a,l,n);break;case"textBlock":sr(a,l,n);break;case"checkbox":ar(a,l,n);break;case"box":Os(a,l,n);break;case"pageBreak":a.addPage(),r=t.page.margins.top;break;case"spacer":r+=l.height;break;case"divider":Hs(a,l);break}const s=new Date().toISOString().split("T")[0],o=n.customFields?.donorName?`${n.customFields.donorName}_${s}.pdf`:`report_${s}.pdf`;a.save(o)}function nr(t,n){if(n.textColor){const a=Pe(n.textColor);t.setTextColor(a[0],a[1],a[2])}}function tt(t){t.setTextColor(0,0,0)}function Le(t,n){let a=t.replace(/\{\{names\}\}/g,n.selectedNames.join(", ")).replace(/\{\{timestamp\}\}/g,new Date().toLocaleString()).replace(/\{\{rowCount\}\}/g,String(n.includedIndices.size)).replace(/\{\{sourceFiles\}\}/g,n.sourceFiles.join(", ")).replace(/\{\{sourceSheets\}\}/g,n.sourceSheets.join(", ")).replace(/\{\{pageNum\}\}/g,"").replace(/\{\{totalPages\}\}/g,"");if(n.customFields)for(const[r,s]of Object.entries(n.customFields)){const o=new RegExp(`\\{\\{customFields\\.${r}\\}\\}`,"g");a=a.replace(o,String(s))}return a}function Ls(t,n,a){if(typeof t!="number")return String(t??"");const r=Tr.toWords(t);switch(a){case"upper":return r.toUpperCase();case"lower":return r.toLowerCase();case"title":return r.split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join("-");default:return r}}function Pe(t){const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:[0,0,0]}function _s(t,n,a,r){const s=t.internal.pageSize.getWidth();let o=r;const l=Le(n.title,a);t.setFontSize(n.fontSize),tt(t),Je(t,l,!0);let c;switch(n.alignment){case"center":c=s/2,t.text(l,c,o,{align:"center"});break;case"right":c=s-t.internal.pageSize.getWidth()/2,t.text(l,c,o,{align:"right"});break;default:c=0,t.text(l,c+t.internal.pageSize.getWidth()*.1,o,{align:"left"})}if(o+=n.fontSize*.5,n.subtitle){const h=Le(n.subtitle,a);switch(t.setFontSize(n.fontSize*.7),Je(t,h,!1),n.alignment){case"center":t.text(h,s/2,o,{align:"center"});break;case"right":t.text(h,s-10,o,{align:"right"});break;default:t.text(h,t.internal.pageSize.getWidth()*.1,o,{align:"left"})}o+=n.fontSize*.5}return o+10}function $s(t,n,a,r){const s=t.internal.pageSize.getWidth(),o=Le(n.content,a);t.setFontSize(n.fontSize),tt(t),Je(t,o,!1);let l;switch(n.alignment){case"center":l=s/2,t.text(o,l,r+n.margin.top,{align:"center"});break;case"right":l=s-10,t.text(o,l,r+n.margin.top,{align:"right"});break;default:t.text(o,t.internal.pageSize.getWidth()*.1,r+n.margin.top,{align:"left"})}return r+n.margin.top+n.margin.bottom}function Bs(t,n,a,r){const s=t.internal.pageSize.getWidth();let o=r;if(n.showRowCounts||n.showColumnTotals){const l=s*.8,c=15,h=(s-l)/2;t.setFillColor(...Pe(n.backgroundColor)),t.rect(h,o,l,c,"F"),t.setFontSize(n.fontSize),t.setFont("helvetica","normal");let f="";if(n.showRowCounts&&(f=`Total Rows: ${a.includedIndices.size}`),n.showColumnTotals&&Object.keys(a.columnTotals).length>0){f&&(f+=" | ");const d=Object.entries(a.columnTotals).map(([y,x])=>`${y}: ${x}`).join(", ");f+=`Totals: ${d}`}f&&t.text(f,s/2,o+c/2+2,{align:"center"}),o+=c+5}return o}async function Vs(t,n,a,r){const s=a.visibleHeaders.map(l=>l.label),o=a.data.filter((l,c)=>a.includedIndices.has(c)).map(l=>a.visibleHeaders.map(c=>{let h=l[c.id]??"";return n.columnConversions?.[c.label]?.toWords&&(h=Ls(h,!0,n.columnConversions[c.label].capitalize)),String(h)}));return o.some(l=>l.some(c=>un(String(c))))||s.some(l=>un(l)),Yn(t,{head:[s],body:o,startY:r,styles:{fontSize:n.options.fontSize,cellPadding:n.options.cellPadding,lineColor:Pe(n.options.borderColor),lineWidth:n.options.borderWidth,font:"helvetica"},headStyles:{fillColor:Pe(n.options.headerBackgroundColor),textColor:Pe(n.options.headerTextColor),fontStyle:"bold"},alternateRowStyles:n.options.alternateRowColors?{fillColor:Pe(n.options.alternateRowColor2)}:void 0}),t.lastAutoTable.finalY+10}async function Vn(t,n,a,r,s){const o=n.rows.map(f=>f.map(d=>n.substituteVariables!==!1?Le(String(d),a):String(d)));o.some(f=>f.some(d=>un(String(d))))||n.headers&&n.headers.some(f=>un(f));const l=n.rows,c={};n.options.columnAlign&&n.options.columnAlign.forEach((f,d)=>{c[d]={cellWidth:"wrap"};const y={left:"left",center:"center",right:"right",justify:"justify"};c[d].halign=y[f]||"left"});const h={head:n.options.showHeaders?[n.headers]:void 0,body:o,startY:r,styles:{fontSize:n.options.fontSize,cellPadding:n.options.cellPadding,lineColor:Pe(n.options.borderColor),lineWidth:n.options.borderWidth,font:"helvetica",halign:n.options.align??"left"},columnStyles:Object.keys(c).length>0?c:void 0,headStyles:n.options.showHeaders?{fillColor:Pe(n.options.headerBackgroundColor),textColor:Pe(n.options.headerTextColor),fontStyle:"bold"}:void 0,alternateRowStyles:n.options.alternateRowColors?{fillColor:Pe(n.options.alternateRowColor2)}:void 0,willDrawCell:f=>{if(f.section==="body"&&a.textColor){const d=f.row.index,y=f.column.index;if(l[d]&&l[d][y]){const x=String(l[d][y]);if(/\{\{customFields\./.test(x)){const g=Pe(a.textColor);t.setTextColor(g[0],g[1],g[2])}else t.setTextColor(0,0,0)}}}};return s!==void 0&&(h.margin={left:s,top:r,right:15,bottom:15}),Yn(t,h),t.lastAutoTable.finalY+10}function rr(t,n,a){const r=Le(n.label,a),s=Le(n.value,a),o=n.separator??": ";t.setFontSize(n.labelFontSize??n.fontSize??10),tt(t),Je(t,r,n.boldLabel!==!1),t.text(r,n.x,n.y);const l=n.labelWidth??t.getTextWidth(r+o),c=n.x+l;t.setFontSize(n.fontSize??10),/\{\{customFields\./.test(n.value)&&a.textColor?nr(t,a):tt(t),Je(t,s,n.boldValue===!0),t.text(o+s,c,n.y),tt(t)}function sr(t,n,a){const r=Le(n.content,a);t.setFontSize(n.fontSize??10),/\{\{customFields\./.test(n.content)&&a.textColor?nr(t,a):tt(t),Je(t,r,n.bold===!0);const o={maxWidth:n.width};n.align==="center"?o.align="center":n.align==="right"?o.align="right":n.align==="justify"?o.align="justify":o.align="left",t.text(r,n.x,n.y,o),tt(t)}function ar(t,n,a){const r=n.boxSize??10,s=n.labelGap??5;let o;n.group&&n.groupValue?o=(typeof n.checked=="string"?Le(n.checked,a):String(n.checked))===n.groupValue:o=typeof n.checked=="string"?Le(n.checked,a)==="true":n.checked;const l=Le(n.label,a),h=t.internal.pageSize.getWidth()-15-(n.x+r+s);t.setDrawColor(0),t.setLineWidth(.5),t.rect(n.x,n.y-r/2,r,r),o&&(t.line(n.x,n.y-r/2,n.x+r,n.y+r/2),t.line(n.x+r,n.y-r/2,n.x,n.y+r/2)),t.setFontSize(n.fontSize??10),tt(t),Je(t,l,!1);const f=t.splitTextToSize(l,h),d=(n.fontSize??10)*.4;f.forEach((y,x)=>{const g=n.y+x*d;t.text(y,n.x+r+s,g)})}function Os(t,n,a,r){if(n.backgroundColor&&(t.setFillColor(...Pe(n.backgroundColor)),t.rect(n.x,n.y,n.width,n.height,"F")),n.border!==!1&&(t.setDrawColor(...Pe(n.borderColor??"#000000")),t.setLineWidth(n.borderWidth??.5),t.rect(n.x,n.y,n.width,n.height)),n.sections&&n.sections.length>0)for(const s of n.sections){const o=s.x??0,l=s.y??0,c={...s,x:n.x+o,y:n.y+l};switch(c.type){case"textBlock":sr(t,c,a);break;case"checkbox":ar(t,c,a);break;case"labeledField":rr(t,c,a);break}}}function Hs(t,n){const a=n.color??"#000000",r=n.lineWidth??.5;if(t.setDrawColor(...Pe(a)),t.setLineWidth(r),n.style==="dashed"){let l=n.x;const c=n.x+n.width;for(;l<c;){const h=Math.min(l+3,c);t.line(l,n.y,h,n.y),l=h+2}}else t.line(n.x,n.y,n.x+n.width,n.y)}function Us(t,n,a){const r=t.internal.getNumberOfPages(),s=t.internal.pageSize.getHeight();for(let o=1;o<=r;o++){t.setPage(o),t.setFontSize(n.fontSize),t.setFont("helvetica","normal"),tt(t);const l=s-10;if(n.left){const c=Le(n.left,a);Je(t,c,!1),t.text(c,10,l,{align:"left"})}if(n.center){let c=Le(n.center,a);c=c.replace(/\{\{pageNum\}\}/g,String(o)).replace(/\{\{totalPages\}\}/g,String(r)),Je(t,c,!1),t.text(c,t.internal.pageSize.getWidth()/2,l,{align:"center"})}if(n.right){const c=Le(n.right,a);Je(t,c,!1),t.text(c,t.internal.pageSize.getWidth()-10,l,{align:"right"})}}}function Gs(t){const n=new Map,a=/\{\{customFields\.([^}]+)\}\}/g,r=s=>{if(!s)return;let o;for(;(o=a.exec(s))!==null;){const l=o[1];n.has(l)||n.set(l,Ys(l,t.customFieldDefaults?.[l]))}};for(const s of t.sections)switch(s.type){case"header":r(s.title),r(s.subtitle);break;case"text":r(s.content);break;case"footer":r(s.left),r(s.center),r(s.right);break;case"labeledField":r(s.label),r(s.value);break;case"textBlock":r(s.content);break;case"checkbox":r(s.label),typeof s.checked=="string"&&r(s.checked);break;case"customDataTable":if(s.substituteVariables!==!1)for(const o of s.rows)for(const l of o)r(l);break}return Array.from(n.values())}function Ks(t){return Gs(t).length>0}function Ys(t,n){const a=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];let r="text";a.includes(t.toLowerCase())?r="month-amount":t.startsWith("is")||t.endsWith("Checked")||t.includes("option")?r="boolean":(t.toLowerCase().includes("amount")||t.toLowerCase().includes("betrag"))&&(r="number");const s=t.replace(/([A-Z])/g," $1").replace(/^./,l=>l.toUpperCase()).trim();let o;return n!==void 0?o=n:t==="signatureLocation"?o="Kelsterbach":t==="verzichtNein"?o=!0:t==="verzichtJa"?o=!1:t==="taxOption2"?o=!0:t==="taxOption1"?o=!1:t==="notMembership"?o=!0:t==="taxNumber2"?o="4525057301":t==="taxDate2"?o="29.04.2011":t==="taxValidFrom"&&(o="27.12.2016"),{key:t,type:r,label:s,defaultValue:o}}const qs=({open:t,onClose:n,context:a})=>{const{t:r}=Ce(),[s,o]=u.useState($n[0]),[l,c]=u.useState(!1),[h,f]=u.useState(!1),d=Ks(s),y=async()=>{d?f(!0):await g(s,a)},x=async(p,S)=>{const z={...a,customFields:p,textColor:S};await g(s,z),f(!1)},g=async(p,S)=>{c(!0);try{await Ws(p,S),n()}catch(z){dn("PDFExport","PDF generation failed:",z),alert(r("pdfExport.failed"))}finally{c(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(ct,{open:t&&!h,onClose:n,maxWidth:"sm",fullWidth:!0,children:[e.jsx(dt,{children:r("pdfExport.title")}),e.jsxs(vt,{children:[e.jsx(C,{variant:"body2",color:"text.secondary",sx:{mb:2},children:r("pdfExport.rowsSelected",{count:a.includedIndices.size})}),e.jsx(ks,{templates:$n,selectedTemplate:s,onTemplateChange:o})]}),e.jsxs(Lt,{children:[e.jsx(ne,{onClick:n,disabled:l,children:r("pdfExport.cancel")}),e.jsx(ne,{variant:"contained",onClick:y,disabled:l,children:r(l?"pdfExport.generating":d?"pdfExport.next":"pdfExport.exportPdf")})]})]}),e.jsx(As,{open:h,onClose:()=>f(!1),onConfirm:x,context:a,template:s})]})},Pt=["#1976d2","#dc004e","#00a152","#ff6f00","#7b1fa2","#00bcd4","#ff5722","#607d8b","#e91e63","#8bc34a"],Zs=({x:t,y:n,payload:a})=>{if(!a||!t||!n)return null;const r=a.value,s=r.indexOf(`
`);if(s!==-1){const o=r.substring(0,s),l=r.substring(s+1);return e.jsxs("text",{x:t,y:n,textAnchor:"middle",fill:"currentColor",children:[e.jsx("tspan",{x:t,dy:"0.7em",fontSize:11,fontWeight:500,children:o}),e.jsx("tspan",{x:t,dy:"14",fontSize:9,fill:"currentColor",opacity:.7,children:l})]})}return e.jsx("text",{x:t,y:n,dy:"0.4em",textAnchor:"middle",fontSize:11,fill:"currentColor",children:r})},or=t=>t===0?"0.00":Math.abs(t)>=1e6?(t/1e6).toFixed(2)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(2)+"K":t.toFixed(2),ir=u.memo(({active:t,payload:n,label:a})=>t&&n&&n.length?e.jsxs(b,{sx:{bgcolor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5,boxShadow:3},children:[e.jsx(C,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:a}),n.map((r,s)=>e.jsxs(C,{variant:"body2",sx:{color:r.color,fontSize:"0.875rem"},children:[r.name,": ",or(r.value)]},s))]}):null);ir.displayName="CustomTooltip";const Js=({data:t,series:n,type:a="area",isLoading:r=!1,error:s})=>{const{t:o}=Ce(),l=Ht(),c=l.palette.divider,h=a==="stacked",f=h?"area":a,d=f==="line"?Ir:Rr,y=u.useMemo(()=>!r&&!s&&t.length>0&&n.length>0,[r,s,t.length,n.length]),x=u.useMemo(()=>n.map(p=>{const S=p.color;return f==="line"?e.jsx(qn,{type:"monotone",dataKey:p.key,name:p.label,stroke:S,strokeWidth:2,dot:{fill:S,r:3},activeDot:{r:5}},p.key):e.jsx(Ar,{type:"monotone",dataKey:p.key,name:p.label,stroke:S,strokeWidth:2,fill:S,fillOpacity:h?.8:.3,stackId:h?"stack":void 0},p.key)}),[n,f,h]),g=u.useCallback(()=>e.jsx("g",{children:n.map((D,k)=>{const T=22+k*22;return e.jsxs("g",{children:[e.jsx("rect",{x:"85%",y:T+2,width:12,height:12,fill:D.color,stroke:D.color,dx:6}),e.jsx("text",{x:"85%",y:T+12,dx:24,fill:l.palette.text.primary,fontSize:12,alignmentBaseline:"baseline",children:D.label})]},D.key)})}),[n,l.palette.text.primary]);return r?e.jsx(b,{sx:{height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:o("charts.loadingData")})}):s?e.jsx(b,{sx:{height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{variant:"body2",color:"error",children:o("charts.errorLoading",{message:s.message})})}):y?e.jsx(b,{sx:{width:"100%",height:"100%"},"data-chart-id":"trend-chart",children:e.jsx(kt,{width:"100%",height:"100%",debounce:1,children:e.jsxs(d,{data:t,margin:{top:16,right:120,left:40,bottom:50},children:[e.jsx(Ft,{strokeDasharray:"3 3",stroke:c}),e.jsx(Nt,{dataKey:"period",stroke:l.palette.text.primary,tick:e.jsx(Zs,{}),tickLine:{stroke:l.palette.text.secondary},height:50,interval:"preserveStartEnd",minTickGap:35}),e.jsx(mt,{stroke:l.palette.text.primary,tick:{fill:l.palette.text.primary,fontSize:12},tickFormatter:p=>or(p)}),e.jsx(zt,{content:p=>e.jsx(ir,{...p})}),e.jsx(Tn,{component:g}),x]})})}):e.jsx(b,{sx:{height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:o("charts.noDataForPeriod")})})},lr=u.memo(Js,(t,n)=>t.data===n.data&&t.series===n.series&&t.periodType===n.periodType&&t.type===n.type&&t.isLoading===n.isLoading&&t.error===n.error);lr.displayName="TrendChart";function Xs(){return Pt}function Qs(t,n=2){return t.toFixed(n)}function ea(t){return t===0?"0":Math.abs(t)>=1e6?(t/1e6).toFixed(1)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}function ta(t){return t===0?"0.00":Math.abs(t)>=1e6?(t/1e6).toFixed(2)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(2)+"K":t.toFixed(2)}const na=(t,n)=>{const a=u.memo(({active:r,payload:s,label:o,anonymize:l=!1})=>{if(r&&s&&s.length){const c=s[0].payload;let h=n("charts.anonymized");if(l){const f=t.findIndex(d=>d.name===c.name);f!==-1&&(h=n("charts.anonymized",{index:f+1}))}return e.jsxs(b,{sx:{bgcolor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5,boxShadow:3},children:[e.jsx(C,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:l?h:o}),e.jsxs(C,{variant:"body2",sx:{color:s[0].color},children:[n("charts.value"),": ",ta(c.value)]}),e.jsxs(C,{variant:"body2",sx:{color:s[0].color},children:[n("charts.count"),": ",c.count]}),e.jsxs(C,{variant:"body2",sx:{color:s[0].color},children:[n("charts.percentage"),": ",c.percentage.toFixed(1),"%"]})]})}return null});return a.displayName="CustomTooltip",a},ra=({data:t,valueLabel:n,limit:a=10,anonymize:r=!1,isLoading:s=!1,error:o})=>{const{t:l}=Ce(),c=Ht(),h=Xs(),f=c.palette.divider,d=u.useMemo(()=>t.slice(0,a).map(S=>({name:S.category,value:S.value,count:S.count,percentage:S.percentage})),[t,a]),y=u.useMemo(()=>!s&&!o&&t.length>0,[s,o,t.length]),x=u.useMemo(()=>na(d,l),[d,l]),g=u.useCallback(()=>{const F=n||l("charts.value"),D=85,k=16,T=h[0];return e.jsxs("g",{children:[e.jsx("rect",{x:`${D}%`,y:k+6,width:12,height:12,fill:T,stroke:T}),e.jsx("text",{x:`${D}%`,y:k+6+12-1,dx:18,fill:c.palette.text.primary,fontSize:12,alignmentBaseline:"baseline",children:F})]})},[n,h,c.palette.text.primary,f,l]),p=u.useCallback((S,z)=>{const $=d.length,F=$>40?10:$>20?5:$>10?2:1;return r&&z%F===0?`#${z+1}`:r?"":String(S)},[r,d.length]);return s?e.jsx(b,{sx:{width:"100%",height:"100%",minHeight:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:l("charts.loadingData")})}):o?e.jsx(b,{sx:{width:"100%",height:"100%",minHeight:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{variant:"body2",color:"error",children:l("charts.errorLoading",{message:o.message})})}):y?e.jsx(b,{sx:{width:"100%",height:"100%",display:"flex"},"data-chart-id":"top-contributors",children:e.jsx(kt,{width:"100%",height:"100%",minWidth:200,minHeight:200,children:e.jsxs(cn,{data:d,layout:"horizontal",margin:{top:16,right:100,left:40,bottom:60},children:[e.jsx(Ft,{strokeDasharray:"3 3",stroke:f}),e.jsx(Nt,{dataKey:"name",stroke:c.palette.text.primary,tick:{fill:c.palette.text.primary,fontSize:"12px"},angle:-45,textAnchor:"end",height:100,interval:r?0:void 0,tickFormatter:p}),e.jsx(mt,{stroke:c.palette.text.primary,tick:{fill:c.palette.text.primary},tickFormatter:S=>ea(S)}),e.jsx(zt,{content:S=>e.jsx(x,{...S,anonymize:r})}),e.jsx(Tn,{component:g}),e.jsx($t,{dataKey:"value",name:n,children:d.map((S,z)=>e.jsx(Bt,{fill:h[z%h.length]},`cell-${z}`))})]})})}):e.jsx(b,{sx:{width:"100%",height:"100%",minHeight:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:l("charts.noDataAvailable")})})},cr=u.memo(ra,(t,n)=>t.data===n.data&&t.valueLabel===n.valueLabel&&t.limit===n.limit&&t.anonymize===n.anonymize&&t.isLoading===n.isLoading&&t.error===n.error);cr.displayName="TopDonorsChart";function tn(t,n){if(t.length===0)return 0;if(t.length===1)return t[0];const a=n/100*(t.length-1),r=Math.floor(a),s=Math.ceil(a),o=a-r;return r===s?t[r]:t[r]*(1-o)+t[s]*o}function sa(t,n,a){const r=[];if(t.forEach(F=>{const D=F[n];if(D!=null&&D!==""){const k=typeof D=="number"?D:parseFloat(String(D));isNaN(k)||r.push(k)}}),r.length===0)return{columnName:n,columnLabel:a,sum:0,avg:0,min:0,max:0,median:0,stdDev:0,count:t.length,nonNullCount:0,percentile25:0,percentile75:0,percentile90:0,percentile95:0};const s=r.reduce((F,D)=>F+D,0),o=s/r.length,l=Math.min(...r),c=Math.max(...r),h=[...r].sort((F,D)=>F-D),f=Math.floor(h.length/2),d=h.length%2!==0?h[f]:(h[f-1]+h[f])/2,x=r.map(F=>Math.pow(F-o,2)).reduce((F,D)=>F+D,0)/r.length,g=Math.sqrt(x),p=tn(h,25),S=tn(h,75),z=tn(h,90),$=tn(h,95);return{columnName:n,columnLabel:a,sum:s,avg:o,min:l,max:c,median:d,stdDev:g,count:t.length,nonNullCount:r.length,percentile25:p,percentile75:S,percentile90:z,percentile95:$}}function dr(t){if(t.length===0)return[];const n=new Set(["_sourceFileName","_sourceSheetName"]),a=new Map;t.forEach(s=>{Object.keys(s).forEach(o=>{if(n.has(o))return;a.has(o)||a.set(o,{numeric:0,total:0});const l=a.get(o),c=s[o];if(c!=null&&c!==""){if(l.total++,typeof c=="number")l.numeric++;else if(typeof c=="string"){const h=c.trim();h!==""&&!isNaN(parseFloat(h))&&l.numeric++}}})});const r=[];return a.forEach((s,o)=>{s.total>0&&s.numeric/s.total>=.5&&r.push(o)}),r}function ur(t){if(t.length===0)return[];const n=new Set(["_sourceFileName","_sourceSheetName"]),a=[],r=new Set,s=[/^\d{4}-\d{1,2}-\d{1,2}$/,/^\d{1,2}\/\d{1,2}\/\d{2,4}$/,/^\d{1,2}\.\d{1,2}\.\d{2,4}$/,/^\d{8}$/],o=/(\d{8})/,l=c=>{if(!isFinite(c))return null;const f=new Date(Date.UTC(1899,11,30)).getTime()+c*24*60*60*1e3,d=new Date(f);return isNaN(d.getTime())?null:d};return t.forEach(c=>{Object.keys(c).forEach(h=>{if(n.has(h)||r.has(h))return;const f=c[h];if(f!=null&&f!==""){if(f instanceof Date){a.includes(h)||a.push(h),r.add(h);return}if(typeof f=="string"){const d=f.trim();if(s.some(x=>x.test(d))){a.includes(h)||a.push(h),r.add(h);return}if(o.test(d)){a.includes(h)||a.push(h),r.add(h);return}}if(typeof f=="number"){if(f>2e4&&f<8e4){if(l(f)){a.includes(h)||a.push(h),r.add(h);return}}else if(f>1e11&&f<1e13){const d=new Date(f);if(!isNaN(d.getTime())){a.includes(h)||a.push(h),r.add(h);return}}}}})}),a}function hr(t){if(t instanceof Date)return isNaN(t.getTime())?null:t;if(typeof t=="number"){if(t>2e4&&t<8e4){const s=new Date(Date.UTC(1899,11,30)).getTime()+t*24*60*60*1e3,o=new Date(s);return isNaN(o.getTime())?null:o}else if(t>1e11&&t<1e13){const r=new Date(t);return isNaN(r.getTime())?null:r}return null}if(typeof t!="string")return null;const n=t.trim(),a=/(\d{8})/.exec(n);if(a){const r=a[1],s=parseInt(r.substring(0,4),10),o=parseInt(r.substring(4,6),10)-1,l=parseInt(r.substring(6,8),10);return new Date(s,o,l)}if(/^\d{8}$/.test(n)){const r=parseInt(n.substring(0,4),10),s=parseInt(n.substring(4,6),10)-1,o=parseInt(n.substring(6,8),10);return new Date(r,s,o)}if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(n)){const[r,s,o]=n.split("-").map(l=>parseInt(l,10));return new Date(r,s-1,o)}if(/^\d{1,2}\.\d{1,2}\.\d{2,4}$/.test(n)){const r=n.split("."),s=parseInt(r[0],10),o=parseInt(r[1],10)-1,l=parseInt(r[2],10),c=r[2].length===2?2e3+l:l;return new Date(c,o,s)}if(/^\d{1,2}\/\d{1,2}\/\d{2,4}$/.test(n)){const r=n.split("/"),s=parseInt(r[0],10),o=parseInt(r[1],10)-1,l=parseInt(r[2],10),c=r[2].length===2?2e3+l:l;return new Date(c,o,s)}return null}function wn(t,n,a,r){const s=new Map;return t.forEach(l=>{const c=hr(l[n]);if(!c)return;const h=parseFloat(String(l[a]??""))||0;let f,d;switch(r){case"monthly":f=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,d=new Date(c.getFullYear(),c.getMonth(),1);break;case"quarterly":{const x=Math.floor(c.getMonth()/3);f=`${c.getFullYear()}-Q${x+1}`,d=new Date(c.getFullYear(),x*3,1);break}case"yearly":f=`${c.getFullYear()}`,d=new Date(c.getFullYear(),0,1);break}s.has(f)||s.set(f,{value:0,count:0,date:d});const y=s.get(f);y.value+=h,y.count+=1}),Array.from(s.entries()).map(([l,c])=>({period:l,value:c.value,count:c.count,date:c.date})).sort((l,c)=>(l.date?.getTime()||0)-(c.date?.getTime()||0))}function hn(t,n,a){const r=new Map;t.forEach(l=>{const c=l[n];if(c==null||c==="")return;const h=String(c),f=a?parseFloat(String(l[a]??""))||0:1;r.has(h)||r.set(h,{value:0,count:0});const d=r.get(h);d.value+=f,d.count+=1});const s=Array.from(r.values()).reduce((l,c)=>l+c.value,0);return Array.from(r.entries()).map(([l,c])=>({category:l,value:c.value,count:c.count,percentage:s>0?c.value/s*100:0})).sort((l,c)=>c.value-l.value)}function mr(t,n=10){return t.slice(0,n)}function aa(t,n,a){const r=dr(t),s=ur(t),o=r.map(d=>sa(t,d,n[d]||d)),l={};if(s.length>0&&r.length>0){const d=s[0],y=r[0];l.monthly=wn(t,d,y,"monthly"),l.quarterly=wn(t,d,y,"quarterly"),l.yearly=wn(t,d,y,"yearly")}const c={};a&&r.length>0&&(c.byName=hn(t,a,r[0])),t.length>0&&"_sourceFileName"in t[0]&&(c.bySource=hn(t,"_sourceFileName",r[0]));const h=c.byName?mr(c.byName,10):[],f={totalRows:t.length,filteredRows:t.length};if(s.length>0){const d=t.map(y=>hr(y[s[0]])).filter(y=>y!==null).sort((y,x)=>y.getTime()-x.getTime());d.length>0&&(f.dateRange={start:d[0],end:d[d.length-1]})}return{numericColumns:o,timeSeries:l,distributions:c,topDonors:h,metadata:f}}function oa(t,n){const a=[];return t.forEach(r=>{const s=r[n];if(s!=null&&s!==""){const o=typeof s=="number"?s:parseFloat(String(s));isNaN(o)||a.push(o)}}),a}function ia(t,n=10){if(t.length===0)return{bins:[],mean:0,median:0,min:0,max:0};const a=[...t].sort((x,g)=>x-g),r=a[0],s=a[a.length-1],l=t.reduce((x,g)=>x+g,0)/t.length,c=Math.floor(a.length/2),h=a.length%2!==0?a[c]:(a[c-1]+a[c])/2;if(r===s)return{bins:[{binStart:r,binEnd:s,count:t.length,label:`${r.toFixed(2)}`}],mean:l,median:h,min:r,max:s};const d=(s-r)/n,y=[];for(let x=0;x<n;x++){const g=r+x*d,p=x===n-1?s:r+(x+1)*d;y.push({binStart:g,binEnd:p,count:0,label:`${g.toFixed(0)}-${p.toFixed(0)}`})}return t.forEach(x=>{let g=Math.floor((x-r)/d);g>=n&&(g=n-1),y[g].count++}),{bins:y,mean:l,median:h,min:r,max:s}}function la(t){if(t.length===0)return[];const n=[...t].sort((s,o)=>o.value-s.value),a=n.reduce((s,o)=>s+o.value,0);let r=0;return n.map(s=>(r+=s.value,{category:s.category,value:s.value,cumulativeValue:r,cumulativePercentage:a>0?r/a*100:0}))}const ca=[{label:"0 EUR",min:0,max:0},{label:"1-50 EUR",min:1,max:50},{label:"51-100 EUR",min:51,max:100},{label:"101-200 EUR",min:101,max:200},{label:"201-500 EUR",min:201,max:500},{label:"501-1000 EUR",min:501,max:1e3},{label:"1001+ EUR",min:1001,max:1/0}];function da(t,n=ca){if(t.length===0)return[];const a=t.reduce((s,o)=>s+o,0),r=new Map;return n.forEach(s=>{r.set(s.label,{count:0,amount:0})}),t.forEach(s=>{for(const o of n)if(s>=o.min&&s<=o.max){const l=r.get(o.label);l.count++,l.amount+=s;break}}),Array.from(r.entries()).filter(([,s])=>s.count>0).map(([s,o])=>({label:s,count:o.count,amount:o.amount,percentage:a>0?o.amount/a*100:0}))}const Ye=t=>Qs(t),ua=({statistics:t,isLoading:n=!1,error:a})=>{const{t:r}=Ce(),[s,o]=u.useState(!1),l=u.useCallback(()=>{o(h=>!h)},[]),c=u.useMemo(()=>!n&&!a&&t.length>0,[n,a,t.length]);return n?e.jsx(b,{sx:{py:4,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:r("charts.loadingData")})}):a?e.jsx(b,{sx:{py:4,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"error",children:r("charts.errorLoading",{message:a.message})})}):c?e.jsxs(b,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(ne,{size:"small",endIcon:s?e.jsx(an,{}):e.jsx(on,{}),onClick:l,children:r(s?"charts.hidePercentiles":"charts.showPercentiles")})}),e.jsx(Nn,{component:ge,variant:"outlined",children:e.jsxs(zn,{size:"small",stickyHeader:!0,children:[e.jsx(Mn,{children:e.jsxs(qe,{children:[e.jsx(oe,{sx:{fontWeight:"bold"},children:r("charts.column")}),e.jsx(oe,{align:"right",sx:{fontWeight:"bold"},children:r("charts.sum")}),e.jsx(oe,{align:"right",sx:{fontWeight:"bold"},children:r("charts.avg")}),e.jsx(oe,{align:"right",sx:{fontWeight:"bold"},children:r("charts.min")}),e.jsx(oe,{align:"right",sx:{fontWeight:"bold"},children:r("charts.max")}),e.jsx(oe,{align:"right",sx:{fontWeight:"bold"},children:r("charts.median")}),e.jsx(oe,{align:"right",sx:{fontWeight:"bold"},children:r("charts.stdDev")}),e.jsx(oe,{align:"right",sx:{fontWeight:"bold"},children:r("charts.nonNullCount")})]})}),e.jsx(En,{children:t.map(h=>e.jsxs(Ie.Fragment,{children:[e.jsxs(qe,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(oe,{component:"th",scope:"row",sx:{fontWeight:"medium"},children:h.columnLabel}),e.jsx(oe,{align:"right",children:Ye(h.sum)}),e.jsx(oe,{align:"right",children:Ye(h.avg)}),e.jsx(oe,{align:"right",children:Ye(h.min)}),e.jsx(oe,{align:"right",children:Ye(h.max)}),e.jsx(oe,{align:"right",children:Ye(h.median)}),e.jsx(oe,{align:"right",children:Ye(h.stdDev)}),e.jsx(oe,{align:"right",children:h.nonNullCount})]}),e.jsx(qe,{children:e.jsx(oe,{colSpan:8,sx:{py:0,border:0,backgroundColor:"action.hover"},children:e.jsx(ln,{in:s,children:e.jsxs(b,{sx:{py:1,display:"flex",gap:3,flexWrap:"wrap"},children:[e.jsxs(C,{variant:"caption",color:"text.secondary",children:[e.jsxs("strong",{children:[r("charts.percentile25"),":"]})," ",Ye(h.percentile25)]}),e.jsxs(C,{variant:"caption",color:"text.secondary",children:[e.jsxs("strong",{children:[r("charts.percentile75"),":"]})," ",Ye(h.percentile75)]}),e.jsxs(C,{variant:"caption",color:"text.secondary",children:[e.jsxs("strong",{children:[r("charts.percentile90"),":"]})," ",Ye(h.percentile90)]}),e.jsxs(C,{variant:"caption",color:"text.secondary",children:[e.jsxs("strong",{children:[r("charts.percentile95"),":"]})," ",Ye(h.percentile95)]})]})})})})]},h.columnName))})]})})]}):e.jsx(b,{sx:{py:4,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:r("dashboard.noNumericColumns")})})},gr=u.memo(ua,(t,n)=>t.statistics===n.statistics&&t.isLoading===n.isLoading&&t.error===n.error);gr.displayName="StatisticsTable";const ha=({data:t,color:n,isLoading:a=!1,error:r})=>{const{t:s}=Ce(),o=Ht(),l=n||o.palette.primary.main,{yAxisMax:c,meanBinLabel:h,medianBinLabel:f}=u.useMemo(()=>{const x=Math.max(...t.bins.map(z=>z.count)),g=Math.ceil(x*1.1),p=t.bins.find(z=>t.mean>=z.binStart&&t.mean<=z.binEnd)?.label,S=t.bins.find(z=>t.median>=z.binStart&&t.median<=z.binEnd)?.label;return{yAxisMax:g,meanBinLabel:p,medianBinLabel:S}},[t.bins,t.mean,t.median]),d=u.useMemo(()=>!a&&!r&&t.bins.length>0,[a,r,t.bins.length]),y=u.useCallback(x=>{const z=[{type:"box",label:s("charts.count"),color:l},{type:"line",label:s("charts.mean"),color:o.palette.error.main,dashed:!0},{type:"line",label:s("charts.medianLabel"),color:o.palette.warning.main,dashed:!0}],$=16,F=85,D=16,{width:k=600}=x,T=k*F/100;return e.jsx("g",{children:z.map((V,L)=>{const U=D+6+L*($+4);return e.jsxs("g",{children:[V.type==="box"?e.jsx("rect",{x:T,y:U+2,width:12,height:12,fill:V.color,stroke:V.color}):e.jsx("line",{x1:T+6,x2:T+6+12,y1:U+8,y2:U+8,stroke:V.color,strokeWidth:2,strokeDasharray:V.dashed?"5 5":void 0}),e.jsx("text",{x:T,y:U+12,dx:18,fill:o.palette.text.primary,fontSize:12,alignmentBaseline:"baseline",children:V.label})]},V.label)})})},[l,o.palette.text.primary,o.palette.error.main,o.palette.warning.main,s]);return a?e.jsx(b,{sx:{width:"100%",height:"100%",py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:s("charts.loadingData")})}):r?e.jsx(b,{sx:{width:"100%",height:"100%",py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"error",children:s("charts.errorLoading",{message:r.message})})}):d?e.jsx(b,{sx:{width:"100%",height:"100%",display:"flex"},"data-chart-id":"histogram",children:e.jsx(kt,{width:"100%",height:"100%",minWidth:200,minHeight:200,children:e.jsxs(cn,{data:t.bins,margin:{top:24,right:100,left:28,bottom:8},children:[e.jsx(Ft,{strokeDasharray:"3 3",stroke:o.palette.divider}),e.jsx(Nt,{dataKey:"label",tick:{fontSize:11},stroke:o.palette.text.secondary,angle:-45,textAnchor:"end",height:60}),e.jsx(mt,{tick:{fontSize:12},stroke:o.palette.text.secondary,domain:[0,c],label:{value:s("charts.count"),angle:-90,position:"insideLeft",style:{textAnchor:"middle",fill:o.palette.text.secondary}}}),e.jsx(zt,{contentStyle:{backgroundColor:o.palette.background.paper,border:`1px solid ${o.palette.divider}`,borderRadius:o.shape.borderRadius},formatter:(x,g)=>[(typeof x=="number"?x:parseFloat(x))??0,g==="count"?s("charts.count"):g??""],labelFormatter:x=>`Range: ${x}`}),e.jsx(Tn,{component:y}),e.jsx($t,{dataKey:"count",name:"count",fill:l,radius:[4,4,0,0],children:t.bins.map((x,g)=>e.jsx(Bt,{fill:l,fillOpacity:.8},`cell-${g}`))}),h&&e.jsx(vn,{x:h,stroke:o.palette.error.main,strokeDasharray:"5 5",strokeWidth:2,label:{value:`${s("charts.mean")}: ${Oe(t.mean)}`,position:"insideTopRight",fill:o.palette.error.main,fontSize:11}}),f&&e.jsx(vn,{x:f,stroke:o.palette.warning.main,strokeDasharray:"3 3",strokeWidth:2,label:{value:`${s("charts.medianLabel")}: ${Oe(t.median)}`,position:"insideTopRight",fill:o.palette.warning.main,fontSize:11}})]})})}):e.jsx(b,{sx:{width:"100%",height:"100%",py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:s("charts.noDataForHistogram")})})},xr=u.memo(ha,(t,n)=>t.data===n.data&&t.color===n.color&&t.isLoading===n.isLoading&&t.error===n.error);xr.displayName="DistributionHistogram";const ma=(t,n)=>{const a=u.memo(({active:r,payload:s,label:o,anonymize:l=!1,valueLabel:c})=>{if(r&&s&&s.length){const h=s[0].payload;let f=n("charts.anonymized");if(l){const d=t.findIndex(y=>y.category===h.category);d!==-1&&(f=n("charts.anonymized",{index:d+1}))}return e.jsxs(b,{sx:{bgcolor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5,boxShadow:3},children:[e.jsx(C,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:l?f:o}),s.map((d,y)=>e.jsx(C,{variant:"body2",sx:{color:d.color},children:d.name==="cumulativePercentage"?`${n("charts.cumulativePercent")}: ${gt(d.value??0)}`:d.name==="value"?`${c}: ${Oe(d.value??0)}`:`${d.name}: ${d.value}`},y)),h.cumulativePercentage!==void 0&&e.jsxs(C,{variant:"body2",sx:{color:"text.secondary"},children:["Cumulative %: ",gt(h.cumulativePercentage)]})]})}return null});return a.displayName="CustomTooltip",a},ga=({data:t,valueLabel:n="Value",barColor:a,lineColor:r,showTop:s=15,anonymize:o=!1,isLoading:l=!1,error:c})=>{const{t:h}=Ce(),f=Ht(),d=a||f.palette.primary.main,y=r||f.palette.secondary.main,x=u.useMemo(()=>t.slice(0,s),[t,s]),{eightyPercentIndex:g,totalValue:p}=u.useMemo(()=>{const F=x.findIndex(k=>k.cumulativePercentage>=80),D=x.length>0?x[x.length-1].cumulativeValue:0;return{eightyPercentIndex:F,totalValue:D}},[x]),S=u.useCallback(F=>F>=1e3?`${(F/1e3).toFixed(0)}k`:String(F),[]),z=u.useCallback((F,D)=>{const k=x.length,T=k>40?10:k>20?5:k>10?2:1;return o&&D%T===0?`#${D+1}`:o?"":String(F)},[o,x.length]),$=u.useMemo(()=>ma(x,h),[x,h]);return l?e.jsx(b,{sx:{width:"100%",height:"100%",py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:h("charts.loadingData")})}):c?e.jsx(b,{sx:{width:"100%",height:"100%",py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"error",children:h("charts.errorLoading",{message:c.message})})}):x.length===0?e.jsx(b,{sx:{width:"100%",height:"100%",py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:h("charts.noDataForPareto")})}):e.jsxs(b,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},"data-chart-id":"pareto",children:[e.jsx(b,{sx:{flex:1,minHeight:0},children:e.jsx(kt,{width:"100%",height:"100%",minWidth:200,minHeight:200,children:e.jsxs(Pr,{data:x,margin:{top:20,right:60,left:20,bottom:20},children:[e.jsx(Ft,{strokeDasharray:"3 3",stroke:f.palette.divider}),e.jsx(Nt,{dataKey:"category",tick:{fontSize:10},stroke:f.palette.text.secondary,angle:-45,textAnchor:"end",interval:0,height:35,tickFormatter:z}),e.jsx(mt,{yAxisId:"left",tick:{fontSize:11},stroke:f.palette.text.secondary,domain:[0,p],tickFormatter:S,label:{value:n,angle:-90,position:"insideLeft",style:{textAnchor:"middle",fill:f.palette.text.secondary}}}),e.jsx(mt,{yAxisId:"right",orientation:"right",tick:{fontSize:11},stroke:f.palette.text.secondary,domain:[0,100],tickFormatter:F=>`${F}%`,label:{value:h("charts.cumulativePercent"),angle:90,position:"insideRight",style:{textAnchor:"middle",fill:f.palette.text.secondary}}}),e.jsx(zt,{content:F=>e.jsx($,{...F,anonymize:o,valueLabel:n})}),e.jsx($t,{yAxisId:"left",dataKey:"value",name:"value",radius:[4,4,0,0],children:x.map((F,D)=>e.jsx(Bt,{fill:D<=g?d:f.palette.grey[400],fillOpacity:D<=g?.9:.5},`cell-${D}`))}),e.jsx(qn,{yAxisId:"right",type:"monotone",dataKey:"cumulativePercentage",stroke:y,strokeWidth:2,dot:{fill:y,strokeWidth:2,r:3},activeDot:{r:5}}),e.jsx(vn,{yAxisId:"right",y:80,stroke:f.palette.error.main,strokeDasharray:"5 5",strokeWidth:2,label:{value:"80%",position:"right",fill:f.palette.error.main,fontSize:12}})]})})}),e.jsxs(b,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mt:-1,gap:0},children:[e.jsx(C,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.8rem",lineHeight:1.2,mb:-.5},children:h("charts.contributors80",{count:g+1})}),e.jsxs(b,{sx:{display:"flex",justifyContent:"center",gap:.5,flexWrap:"wrap"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(b,{sx:{width:16,height:12,backgroundColor:d,borderRadius:.5}}),e.jsx(C,{variant:"caption",color:"text.secondary",children:n})]}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(b,{sx:{width:16,height:3,backgroundColor:y}}),e.jsx(C,{variant:"caption",color:"text.secondary",children:h("charts.cumulativePercent")})]}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(b,{sx:{width:16,height:3,backgroundColor:f.palette.error.main,borderStyle:"dashed"}}),e.jsx(C,{variant:"caption",color:"text.secondary",children:h("charts.percent80Threshold")})]})]})]})]})},pr=u.memo(ga,(t,n)=>t.data===n.data&&t.valueLabel===n.valueLabel&&t.barColor===n.barColor&&t.lineColor===n.lineColor&&t.showTop===n.showTop&&t.anonymize===n.anonymize&&t.isLoading===n.isLoading&&t.error===n.error);pr.displayName="ParetoChart";const St=["#1976d2","#388e3c","#f57c00","#7b1fa2","#c62828","#00838f","#5d4037","#455a64"],xa=u.memo(({active:t,payload:n})=>{if(!t||!n||n.length===0)return null;const a=n[0].payload,r=a.chartType==="count";return e.jsxs(b,{sx:{backgroundColor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5,boxShadow:3},children:[e.jsx(C,{variant:"subtitle2",gutterBottom:!0,children:a.name}),e.jsx(C,{variant:"body2",children:r?`Donors: ${a.value} (${gt(a.percentage)})`:`Amount: ${Oe(a.value)} (${gt(a.percentage)})`})]})}),pa=t=>{const n=u.memo(({active:a,payload:r})=>{if(!a||!r||r.length===0)return null;const s=r[0].payload,o=s.chartType==="count";return e.jsxs(b,{sx:{backgroundColor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5,boxShadow:3},children:[e.jsx(C,{variant:"subtitle2",gutterBottom:!0,children:s.name}),e.jsx(C,{variant:"body2",children:o?`${t("charts.donors")}: ${s.value} (${gt(s.percentage)})`:`${t("charts.amount")}: ${Oe(s.value)} (${gt(s.percentage)})`})]})});return n.displayName="CustomTooltipWithT",n};xa.displayName="CustomTooltip";const fa=({data:t,valueLabel:n="Value",isLoading:a=!1,error:r})=>{const{t:s}=Ce(),o=Ht(),l=u.useMemo(()=>pa(s),[s]),{totalCount:c,countData:h,amountData:f,totalAmount:d}=u.useMemo(()=>{const p=t.reduce((F,D)=>F+D.count,0),S=t.map(F=>({name:F.label,value:F.count,percentage:p>0?F.count/p*100:0,chartType:"count"})).reverse(),z=t.map(F=>({name:F.label,value:F.amount,percentage:F.percentage,chartType:"amount"})).reverse(),$=t.reduce((F,D)=>F+D.amount,0);return{totalCount:p,countData:S,amountData:z,totalAmount:$}},[t]),y=u.useMemo(()=>!a&&!r&&t.length>0,[a,r,t.length]),x=u.useCallback(p=>Oe(p),[]),g=u.useCallback(p=>e.jsx("span",{style:{fontSize:11},children:p}),[]);return a?e.jsx(b,{sx:{py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:s("charts.loadingData")})}):r?e.jsx(b,{sx:{py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"error",children:s("charts.errorLoading",{message:r.message})})}):y?e.jsxs(b,{sx:{width:"100%"},"data-chart-id":"range-distribution",children:[e.jsxs(b,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsxs(ge,{sx:{flex:1,minWidth:320,p:2},children:[e.jsx(C,{variant:"subtitle1",gutterBottom:!0,align:"center",children:s("charts.byDonorCount")}),e.jsx(b,{sx:{height:360},children:e.jsx(kt,{width:"100%",height:"100%",minWidth:200,minHeight:220,children:e.jsxs(cn,{data:h,layout:"vertical",margin:{top:10,right:100,left:24,bottom:20},children:[e.jsx(Ft,{strokeDasharray:"3 3",stroke:o.palette.divider}),e.jsx(Nt,{type:"number",tick:{fontSize:12},stroke:o.palette.text.secondary}),e.jsx(mt,{type:"category",dataKey:"name",width:100,tick:{fontSize:12},stroke:o.palette.text.secondary}),e.jsx(zt,{content:p=>e.jsx(l,{...p})}),e.jsx(In,{verticalAlign:"bottom",height:24,wrapperStyle:{paddingTop:10},formatter:g}),e.jsxs($t,{dataKey:"value",name:"Count",children:[h.map((p,S)=>e.jsx(Bt,{fill:St[S%St.length]},`cell-count-${S}`)),e.jsx(Rn,{dataKey:"value",position:"right",fontSize:11,fill:o.palette.text.secondary})]})]})})}),e.jsx(C,{variant:"caption",color:"text.secondary",align:"center",display:"block",children:s("charts.totalDonors",{count:c})})]}),e.jsxs(ge,{sx:{flex:1,minWidth:320,p:2},children:[e.jsx(C,{variant:"subtitle1",gutterBottom:!0,align:"center",children:s("charts.byTotalValue",{value:n})}),e.jsx(b,{sx:{height:360},children:e.jsx(kt,{width:"100%",height:"100%",minWidth:200,minHeight:220,children:e.jsxs(cn,{data:f,layout:"vertical",margin:{top:10,right:120,left:24,bottom:20},children:[e.jsx(Ft,{strokeDasharray:"3 3",stroke:o.palette.divider}),e.jsx(Nt,{type:"number",tick:{fontSize:12},stroke:o.palette.text.secondary,tickFormatter:p=>x(p)}),e.jsx(mt,{type:"category",dataKey:"name",width:100,tick:{fontSize:12},stroke:o.palette.text.secondary}),e.jsx(zt,{content:p=>e.jsx(l,{...p})}),e.jsx(In,{verticalAlign:"bottom",height:24,wrapperStyle:{paddingTop:10},formatter:g}),e.jsxs($t,{dataKey:"value",name:n,children:[f.map((p,S)=>e.jsx(Bt,{fill:St[S%St.length]},`cell-amount-${S}`)),e.jsx(Rn,{dataKey:"value",position:"right",fontSize:11,fill:o.palette.text.secondary,formatter:p=>Oe(Number(p||0))})]})]})})}),e.jsxs(C,{variant:"caption",color:"text.secondary",align:"center",display:"block",children:["Total: ",Oe(d)]})]})]}),e.jsxs(b,{sx:{mt:2},children:[e.jsx(C,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:s("charts.rangeDistributionSummary")}),e.jsx(b,{sx:{display:"flex",flexDirection:"column",gap:.5,border:1,borderColor:"divider",borderRadius:1,p:1},children:[...t].reverse().map((p,S)=>e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:.5},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{sx:{width:12,height:12,backgroundColor:St[(t.length-1-S)%St.length],borderRadius:.5}}),e.jsx(C,{variant:"body2",children:p.label})]}),e.jsxs(b,{sx:{display:"flex",gap:2},children:[e.jsxs(C,{variant:"body2",color:"text.secondary",children:[p.count," (",(p.count/c*100).toFixed(1),"%)"]}),e.jsxs(C,{variant:"body2",color:"text.secondary",children:[Oe(p.amount)," (",gt(p.percentage),")"]})]})]},p.label))})]})]}):e.jsx(b,{sx:{py:8,textAlign:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:s("charts.noDataForRange")})})},fr=u.memo(fa,(t,n)=>t.data===n.data&&t.valueLabel===n.valueLabel&&t.isLoading===n.isLoading&&t.error===n.error);fr.displayName="RangeDistributionCharts";const ba=Ur(Gr),br=/(\d{8})/,ya=({data:t,columnMapping:n,nameColumn:a,deferRendering:r=!1})=>{const{t:s}=Ce(),o=Ie.useRef(0);o.current+=1;const[l,c]=Ie.useState(!r);u.useEffect(()=>{if(r&&!l){const i=setTimeout(()=>{c(!0)},100);return()=>clearTimeout(i)}},[r,l]);const[h,f]=u.useState("weekly"),[d,y]=u.useState("area"),[x,g]=u.useState(20),[p,S]=u.useState(0),[z,$]=u.useState(70),[F,D]=u.useState(null),[k,T]=u.useState(null),V=Ie.useRef(!1),[L,U]=u.useState(!0),J="excel-processor-dashboard-layout",q=10,re={lg:1200,md:996,sm:768,xs:480,xxs:0},ae={lg:12,md:10,sm:6,xs:4,xxs:2},xe="excel-processor-dashboard-rowheight",[he,Z]=u.useState("lg"),ie=u.useCallback((i,w="png",N)=>{N&&(N.stopPropagation(),N.preventDefault());const W=document.querySelector(`[data-chart-id="${i}"]`);if(!W)return;const B=Array.from(W.querySelectorAll("svg"));if(i==="range-distribution"||i==="pareto"||B.length>1){(async()=>{try{const We=await fn(W,{backgroundColor:"#ffffff",scale:Math.max(1,Math.floor(window.devicePixelRatio||1)),useCORS:!0}),we=w==="jpg"?"image/jpeg":"image/png";We.toBlob(Re=>{if(!Re)return;const Me=URL.createObjectURL(Re),Se=document.createElement("a");Se.href=Me,Se.download=`chart-${i}.${w}`,document.body.appendChild(Se),Se.click(),document.body.removeChild(Se),URL.revokeObjectURL(Me)},we,.92)}catch{}})();return}const K=B,Fe=K.length>0?K.reduce((We,we)=>{const Re=we.getBoundingClientRect(),Me=(Re.width||0)*(Re.height||0),Se=We.getBoundingClientRect(),wr=(Se.width||0)*(Se.height||0);return Me>wr?we:We},K[0]):null;if(!Fe){(async()=>{try{const We=await fn(W,{backgroundColor:"#ffffff",scale:Math.max(1,Math.floor(window.devicePixelRatio||1)),useCORS:!0}),we=w==="jpg"?"image/jpeg":"image/png";We.toBlob(Re=>{if(!Re)return;const Me=URL.createObjectURL(Re),Se=document.createElement("a");Se.href=Me,Se.download=`chart-${i}.${w}`,document.body.appendChild(Se),Se.click(),document.body.removeChild(Se),URL.revokeObjectURL(Me)},we,.92)}catch{}})();return}const $e=W.getBoundingClientRect();let je=Math.max(1,Math.round($e.width)),ue=Math.max(1,Math.round($e.height));if(!je||!ue){const We=Fe.getAttribute("viewBox");if(We){const we=We.split(/\s+/).map(Number);we.length===4&&(je=we[2],ue=we[3])}else try{const we=Fe.getBBox?.();we&&we.width&&we.height&&(je=we.width,ue=we.height)}catch{}(!je||!ue)&&(je=W.offsetWidth||800,ue=W.offsetHeight||400)}const ce=Fe.cloneNode(!0);ce.setAttribute("xmlns","http://www.w3.org/2000/svg"),ce.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),ce.setAttribute("width",`${je}`),ce.setAttribute("height",`${ue}`),ce.getAttribute("viewBox")||ce.setAttribute("viewBox",`0 0 ${je} ${ue}`);const ot=new XMLSerializer().serializeToString(ce),it=new Blob([ot],{type:"image/svg+xml;charset=utf-8"}),lt=URL.createObjectURL(it),Jt=new Image,yt=document.createElement("canvas"),Tt=yt.getContext("2d");if(!Tt){URL.revokeObjectURL(lt);return}const Xt=Math.max(1,Math.floor(window.devicePixelRatio||1));yt.width=je*Xt,yt.height=ue*Xt,yt.style.width=`${je}px`,yt.style.height=`${ue}px`,Tt.setTransform(Xt,0,0,Xt,0,0),Jt.onload=()=>{try{Tt.fillStyle="#ffffff",Tt.fillRect(0,0,je,ue),Tt.drawImage(Jt,0,0,je,ue);const We=w==="jpg"?"image/jpeg":"image/png";yt.toBlob(we=>{if(we){const Re=URL.createObjectURL(we),Me=document.createElement("a");Me.href=Re,Me.download=`chart-${i}.${w}`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),URL.revokeObjectURL(Re)}URL.revokeObjectURL(lt)},We,.92)}catch{URL.revokeObjectURL(lt)}},Jt.onerror=async()=>{URL.revokeObjectURL(lt);try{const We=await fn(W,{backgroundColor:"#ffffff",scale:Math.max(1,Math.floor(window.devicePixelRatio||1)),useCORS:!0}),we=w==="jpg"?"image/jpeg":"image/png";We.toBlob(Re=>{if(!Re)return;const Me=URL.createObjectURL(Re),Se=document.createElement("a");Se.href=Me,Se.download=`chart-${i}.${w}`,document.body.appendChild(Se),Se.click(),document.body.removeChild(Se),URL.revokeObjectURL(Me)},we,.92)}catch{}},Jt.src=lt},[]),le={lg:[{i:"trend-chart",x:0,y:0,w:12,h:16,minW:6,minH:10},{i:"statistics-table",x:0,y:16,w:12,h:12,minW:6,minH:4},{i:"top-contributors",x:0,y:28,w:12,h:18,minW:6,minH:10},{i:"histogram",x:0,y:46,w:12,h:16,minW:6,minH:8},{i:"pareto",x:0,y:62,w:12,h:14,minW:6,minH:8},{i:"range-distribution",x:0,y:76,w:12,h:18,minW:6,minH:10}],md:[{i:"trend-chart",x:0,y:0,w:10,h:16,minW:5,minH:10},{i:"statistics-table",x:0,y:16,w:10,h:12,minW:5,minH:4},{i:"top-contributors",x:0,y:28,w:10,h:18,minW:5,minH:10},{i:"histogram",x:0,y:46,w:10,h:16,minW:5,minH:8},{i:"pareto",x:0,y:62,w:10,h:14,minW:5,minH:8},{i:"range-distribution",x:0,y:76,w:10,h:18,minW:5,minH:10}],sm:[{i:"trend-chart",x:0,y:0,w:6,h:16,minW:3,minH:10},{i:"statistics-table",x:0,y:16,w:6,h:12,minW:3,minH:4},{i:"top-contributors",x:0,y:28,w:6,h:18,minW:3,minH:10},{i:"histogram",x:0,y:46,w:6,h:16,minW:3,minH:8},{i:"pareto",x:0,y:62,w:6,h:14,minW:3,minH:8},{i:"range-distribution",x:0,y:76,w:6,h:18,minW:3,minH:10}],xs:[{i:"trend-chart",x:0,y:0,w:4,h:16,minW:2,minH:10},{i:"statistics-table",x:0,y:16,w:4,h:12,minW:2,minH:4},{i:"top-contributors",x:0,y:28,w:4,h:18,minW:2,minH:10},{i:"histogram",x:0,y:46,w:4,h:16,minW:2,minH:8},{i:"pareto",x:0,y:62,w:4,h:14,minW:2,minH:8},{i:"range-distribution",x:0,y:76,w:4,h:18,minW:2,minH:10}],xxs:[{i:"trend-chart",x:0,y:0,w:2,h:16,minW:2,minH:10},{i:"statistics-table",x:0,y:16,w:2,h:12,minW:2,minH:4},{i:"top-contributors",x:0,y:28,w:2,h:18,minW:2,minH:10},{i:"histogram",x:0,y:46,w:2,h:16,minW:2,minH:8},{i:"pareto",x:0,y:62,w:2,h:14,minW:2,minH:8},{i:"range-distribution",x:0,y:76,w:2,h:18,minW:2,minH:10}]},de=["trend-chart","top-contributors","statistics-table","histogram","pareto","range-distribution"],_=i=>{const w={};for(const N of Object.keys(re)){const W=ae[N]||12,B=i&&i[N]?i[N]:le[N],K={};(B||[]).forEach(ue=>{if(!ue||!ue.i||!de.includes(ue.i))return;const ce={...ue},ot=ce.minW??1,it=ce.minH??4;ce.w=Number.isFinite(ce.w)?Math.max(ot,Math.min(ce.w,W)):Math.max(ot,Math.min(6,W)),ce.h=Number.isFinite(ce.h)?Math.max(it,ce.h):Math.max(it,10),ce.x=Number.isFinite(ce.x)?Math.max(0,Math.min(ce.x,Math.max(0,W-1))):0,ce.y=Number.isFinite(ce.y)?Math.max(0,ce.y):0,K[ce.i]=ce});const Fe=de.filter(ue=>!K[ue]),$e=le[N].filter(ue=>Fe.includes(ue.i)),je=[...Object.values(K),...$e];w[N]=je}return w},A=i=>{try{if(!i||typeof i!="object")return!0;for(const w of Object.keys(re)){const N=ae[w]||12,W=i[w]||[],B=new Set(W.map(K=>K?.i));for(const K of de)if(!B.has(K))return!0;if(W.length!==de.length)return!0;for(const K of W){if(!K)return!0;const{i:Fe,x:$e,y:je,w:ue,h:ce,minW:ot,minH:it}=K;if(!Fe||!de.includes(Fe)||![$e,je,ue,ce].every(lt=>Number.isFinite(lt))||ue<=0||ce<=0||typeof ot=="number"&&ue<ot||typeof it=="number"&&ce<it||$e<0||je<0||$e+ue>N)return!0}}return!1}catch{return!0}},[I,E]=u.useState(()=>{try{const i=localStorage.getItem(J);if(i){const w=JSON.parse(i);return w._version!==q?(console.log("Layout version mismatch, using defaults"),localStorage.removeItem(J),le):_(w)}}catch(i){console.warn("Could not load dashboard layout:",i)}return le});u.useEffect(()=>{try{const i="excel-processor-dashboard-force-reset",w=`${J}-autoreset-v${q}`,N=localStorage.getItem(i)==="true",W=localStorage.getItem(w)==="true",B=localStorage.getItem(J);N&&dn("[Dashboard]","Force-reset flag detected; resetting saved layout"),(N||B&&A(JSON.parse(B)))&&!W&&(dn("[Dashboard]","Auto-resetting corrupted or mismatched layout"),localStorage.removeItem(J),localStorage.setItem(w,"true"),E(le),setTimeout(()=>{try{window.dispatchEvent(new Event("resize"))}catch{}},50))}catch(i){console.warn("Auto-reset check failed:",i)}},[]);const v=u.useCallback((i,w)=>{E(w);try{const N={...w,_version:q};localStorage.setItem(J,JSON.stringify(N))}catch(N){console.warn("Could not save dashboard layout:",N)}},[]),P=u.useCallback(()=>{if((!a||t.length===0?0:(()=>{const w=new Set;for(let N=0;N<t.length;N++){const W=t[N][a];W&&w.add(String(W))}return w.size})())<=1){const w=["top-contributors","histogram","pareto","range-distribution"],N={};for(const W of Object.keys(re)){const K=(le[W]||[]).filter(je=>!w.includes(je.i));let Fe=0;const $e=K.map(je=>{const ue={...je,y:Fe};return Fe+=je.h||10,ue});N[W]=$e}E(N)}else E(le);localStorage.removeItem(J)},[le,t,a]),[H,te]=u.useState(()=>{try{const i=localStorage.getItem(xe);return i&&parseInt(i,10)||50}catch{return 50}});u.useEffect(()=>{try{localStorage.setItem(xe,String(H))}catch{}},[H]);const ee=u.useCallback((i,w)=>{E(N=>{const W={...N},B=W[he]||[];W[he]=B.map(K=>K.i===i?{...K,h:Math.max(K.minH||4,(K.h||10)+w)}:K);try{const K={...W,_version:q};localStorage.setItem(J,JSON.stringify(K))}catch(K){console.warn("Could not save dashboard layout after height adjust:",K)}return W})},[he]);u.useEffect(()=>{try{const i={...I,_version:q};localStorage.setItem(J,JSON.stringify(i))}catch(i){console.warn("Could not persist dashboard layout from effect:",i)}},[I]);const Q=u.useMemo(()=>{let i=[];try{i=dr(t)}catch(w){yn("[Dashboard]","detectNumericColumns failed",w),i=[]}return i},[t]),pe=u.useMemo(()=>{let i=[];try{i=ur(t)}catch(w){yn("[Dashboard]","detectDateColumns failed",w),i=[]}return i},[t]),be=u.useMemo(()=>{if(t.length===0)return!1;const i=t.find(w=>w._sourceFileName);return i?!!i._sourceFileName.match(br):!1},[t]),[O,X]=u.useState([]),[De,Ue]=u.useState(null),[Ge,xt]=u.useState(!1),[pt,R]=u.useState(!1),[fe,se]=u.useState({}),[G,ye]=u.useState(new Set),_e=Ie.useRef([]),Ne=Ie.useRef(!1),ze=Ie.useRef(!1);Ie.useEffect(()=>{_e.current.length===0&&Q.length>0&&(X(Q),_e.current=Q)},[Q]),Ie.useEffect(()=>{pe.length>0&&!Ne.current&&(Ue(pe[0]),Ne.current=!0),pe.length===0&&be&&!ze.current&&!pt&&(xt(!0),ze.current=!0)},[pe,be,pt]);const ke=u.useMemo(()=>{if(!t||t.length===0)return"empty";const i=t[0];return`${i._sourceFileName||""}-${i._sourceSheetName||""}-${t.length}`},[t.length,t[0]?._sourceFileName,t[0]?._sourceSheetName]);Ie.useEffect(()=>{R(!1),_e.current=[],Ne.current=!1,ze.current=!1},[ke]);const nt=u.useMemo(()=>{if(!t||t.length===0)return"empty";const i=t[0],w=i?Object.keys(i).sort().join(","):"",N=i?Object.values(i).slice(0,3).map(String).join("|"):"";return`${t.length}|${w}|${N}`},[t]),Xe=u.useMemo(()=>{try{return aa(t,n,a)}catch(i){return yn("[Dashboard]","analyzeDataForDashboard failed",i),{numericColumns:[],timeSeries:{},distributions:{},topDonors:[],metadata:{totalRows:t.length,filteredRows:t.length}}}},[nt,n,a]),Mt=u.useMemo(()=>(O||[]).length===0?{weekly:[],monthly:[],quarterly:[],yearly:[]}:Ge?wa(t,O):De?ja(t,De,O):{weekly:[],monthly:[],quarterly:[],yearly:[]},[nt,De,O,Ge,n]),Ut=u.useMemo(()=>{if((O||[]).length===0||!a)return[];const i=hn(t,a,O[0]);return mr(i,x)},[nt,O,a,x]),ft=u.useMemo(()=>{if(!a||t.length===0)return 0;const i=new Set;for(let w=0;w<t.length;w++){const N=t[w][a];N&&i.add(String(N))}return i.size},[t.length,a,ke]),bt=Ie.useMemo(()=>ft,[ft]),Ee=u.useMemo(()=>(O||[]).length===0||!a?[]:hn(t,a,O[0]),[nt,O,a]),Gt=u.useMemo(()=>(O||[]).filter(i=>!G.has(i)),[O,G]),rt=u.useMemo(()=>Gt.map(i=>{const w=(O||[]).indexOf(i);return{key:i,label:n[i]||i,color:fe[i]||Pt[w%Pt.length]}}),[Gt,O,n,fe]),Ae=u.useMemo(()=>(O||[]).length===0?[]:a?Ee.map(i=>i.value):oa(t,O[0]),[nt,O,a,Ee]),mn=u.useMemo(()=>{if(Ae.length===0)return{bins:[],mean:0,median:0,min:0,max:0};let i=Ae;return(F!==null||k!==null)&&(i=Ae.filter(w=>!(F!==null&&w<F||k!==null&&w>k))),ia(i,z)},[Ae,z,F,k]),ve=u.useMemo(()=>{if(Ae.length===0)return{min:0,max:0};const i=[...Ae].sort((w,N)=>w-N);return{min:i[0],max:i[i.length-1]}},[Ae]);u.useEffect(()=>{if(Ae.length>0&&!V.current){const{min:i,max:w}=ve;if(w>i){const W=(w-i)*.75;D(i),T(i+W),V.current=!0}}},[Ae.length,ve]),u.useEffect(()=>{Ee.length>0&&p===0&&S(ft)},[Ee.length,ft,p]);const gn=()=>{const i=F??ve.min,w=k??ve.max,W=(w-i)*.75,B=(i+w)/2;D(B-W/2),T(B+W/2)},xn=()=>{const i=F??ve.min,w=k??ve.max,W=(w-i)*.33,B=Math.max(ve.min,i-W),K=Math.min(ve.max,w+W);B<=ve.min&&K>=ve.max?(D(null),T(null)):(D(B),T(K))},pn=()=>{if(F===null||k===null)return;const w=(k-F)*.2,N=Math.max(ve.min,F-w),W=F-N;D(N),T(k-W)},Kt=()=>{if(F===null||k===null)return;const w=(k-F)*.2,N=Math.min(ve.max,k+w),W=N-k;D(F+W),T(N)},Yt=()=>{D(null),T(null)},at=u.useMemo(()=>!Ee||Ee.length===0?[]:la(Ee.slice(0,p)),[Ee,p]),qt=u.useMemo(()=>Ae.length===0?[]:da(Ae),[Ae]),Zt=i=>{ye(w=>new Set(w).add(i))},m=u.useCallback(i=>{ye(w=>{const N=new Set(w);return N.has(i)?N.delete(i):N.add(i),N})},[]),j=u.useCallback(i=>{if(!i.destination)return;const w=Array.from(O||[]),[N]=w.splice(i.source.index,1);w.splice(i.destination.index,0,N),X(w)},[O]);if(!t||t.length===0)return e.jsx(b,{sx:{p:3,textAlign:"center"},children:e.jsx(C,{variant:"h6",color:"text.secondary",children:s("dashboard.noDataAvailable")})});if(!l)return e.jsx(b,{sx:{p:3,textAlign:"center",minHeight:400,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:s("dashboard.loading")})});const M=Mt[h]&&Mt[h].length>0;return e.jsxs(b,{sx:{width:"100%",p:2},children:[e.jsxs(b,{sx:{mb:3,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:1},children:[e.jsxs(b,{children:[e.jsx(C,{variant:"h5",gutterBottom:!0,children:s("dashboard.title")}),e.jsxs(C,{variant:"body2",color:"text.secondary",children:[s("dashboard.showingRows",{count:Xe.metadata.filteredRows}),Xe.metadata.dateRange&&e.jsxs(e.Fragment,{children:[" ",s("dashboard.fromTo",{start:kn(Xe.metadata.dateRange.start),end:kn(Xe.metadata.dateRange.end)})]})]})]}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2},children:[!Ge&&e.jsxs(ut,{size:"small",sx:{minWidth:180},children:[e.jsx(Ot,{children:s("dashboard.dateColumn")}),e.jsxs(Dt,{value:De||"",label:s("dashboard.dateColumn"),onChange:i=>Ue(i.target.value||null),children:[e.jsx(Ze,{value:"",children:e.jsx("em",{children:s("dashboard.none")})}),pe.map(i=>e.jsx(Ze,{value:i,children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(C,{sx:{flex:1},children:n[i]||i}),pe.length>0&&!pe.includes(i)&&e.jsx(He,{label:s("dashboard.notDate"),size:"small",variant:"outlined",color:"warning",sx:{fontSize:"0.7rem",height:20,"& .MuiChip-label":{fontSize:"0.65rem"}}})]})},i))]})]}),e.jsx(st,{control:e.jsx(Vt,{checked:L,onChange:i=>U(i.target.checked),size:"small"}),label:e.jsx(C,{variant:"body2",children:s("dashboard.anonymizeNames")})})]})]}),e.jsxs(ge,{sx:{p:2,mb:3},children:[e.jsx(C,{variant:"subtitle2",gutterBottom:!0,sx:{mb:2},children:s("dashboard.configureCharts")}),e.jsx(b,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:be&&e.jsx(st,{control:e.jsx(Ve,{checked:Ge,onChange:i=>{xt(i.target.checked),R(!0)},size:"small"}),label:s("dashboard.useFilenameDates")})}),(O||[]).length>0&&e.jsxs(b,{sx:{mt:2,p:1.5,borderRadius:1,bgcolor:"action.hover",border:"1px dashed",borderColor:"divider"},children:[e.jsx(C,{variant:"caption",sx:{width:"100%",mb:1,display:"block",color:"text.secondary",fontWeight:"bold",textTransform:"uppercase",letterSpacing:.5},children:s("dashboard.dataSeries")}),e.jsx(Zn,{onDragEnd:j,children:e.jsx(Jn,{droppableId:"columns",direction:"horizontal",children:i=>e.jsxs(b,{ref:i.innerRef,...i.droppableProps,sx:{display:"flex",flexWrap:"wrap",gap:1.5,alignItems:"center"},children:[(O||[]).map((w,N)=>{const W=G.has(w),B=fe[w]||Pt[N%Pt.length];return e.jsx(Xn,{draggableId:w,index:N,children:K=>e.jsxs(b,{ref:K.innerRef,...K.draggableProps,sx:{display:"flex",alignItems:"center",gap:.5,opacity:W?.4:1,transition:"opacity 0.2s"},children:[e.jsx(b,{...K.dragHandleProps,sx:{display:"flex",alignItems:"center",cursor:"grab","&:active":{cursor:"grabbing"}},children:e.jsx(Qn,{fontSize:"small",sx:{color:"text.secondary"}})}),e.jsx("input",{type:"color",value:B,onChange:Fe=>se($e=>({...$e,[w]:Fe.target.value})),style:{width:20,height:20,border:"none",background:"none",cursor:"pointer",padding:0}}),e.jsx(He,{label:n[w]||w,onClick:()=>m(w),onDelete:()=>Zt(w),size:"small",sx:{bgcolor:W?"grey.200":B+"15",border:`1px solid ${W?"grey.400":B+"40"}`,color:W?"text.secondary":B,fontWeight:500,cursor:"pointer",userSelect:"none","&:hover":{bgcolor:W?"grey.300":B+"25"},"& .MuiChip-deleteIcon":{color:W?"text.secondary":B,opacity:.7,"&:hover":{color:W?"text.primary":B,opacity:1}}},deleteIcon:e.jsx(er,{fontSize:"small"})})]})},w)}),i.placeholder]})})})]}),Q.length===0&&e.jsx(Ct,{severity:"warning",sx:{mt:2},children:s("dashboard.noNumericColumns")})]}),e.jsx(ht,{sx:{my:3}}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,gap:2,flexWrap:"wrap"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(C,{variant:"body2",color:"text.secondary",children:s("dashboard.rowHeight")}),e.jsx(ut,{size:"small",sx:{minWidth:80},children:e.jsx(Dt,{value:H,onChange:i=>te(Number(i.target.value)),children:[30,40,50,60,70,80].map(i=>e.jsxs(Ze,{value:i,children:[i,"px"]},i))})})]}),e.jsx(ne,{variant:"outlined",size:"small",onClick:P,children:s("dashboard.resetLayout")})]}),e.jsxs(ba,{className:"layout",layouts:I,breakpoints:re,cols:ae,rowHeight:H,onLayoutChange:v,onBreakpointChange:i=>{console.log("[DashboardView] Breakpoint changed to:",i),Z(i)},draggableHandle:".drag-handle",margin:[16,16],compactType:"vertical",preventCollision:!1,measureBeforeMount:!1,isDraggable:!0,isResizable:!0,children:[e.jsxs(ge,{sx:{p:0,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(b,{className:"drag-handle",sx:{cursor:"move",display:"flex",justifyContent:"space-between",alignItems:"center",p:2,flexWrap:"wrap",gap:1},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Wr,{color:"primary"}),e.jsx(C,{variant:"h6",children:s(M?"dashboard.trendOverTime":"dashboard.trendAnalysis")})]}),e.jsxs(b,{sx:{display:"flex",gap:1},onMouseDown:i=>i.stopPropagation(),children:[e.jsx(Y,{size:"small",onClick:i=>ie("trend-chart","png",i),onTouchEnd:i=>ie("trend-chart","png",i),title:s("dashboard.downloadAsPng"),sx:{minWidth:44,minHeight:44},children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:i=>ie("trend-chart","jpg",i),onTouchEnd:i=>ie("trend-chart","jpg",i),title:s("dashboard.downloadAsJpg"),sx:{minWidth:44,minHeight:44},children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("trend-chart",2),title:s("dashboard.taller"),children:e.jsx(jt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("trend-chart",-2),title:s("dashboard.shorter"),children:e.jsx(wt,{fontSize:"small"})})]}),M&&e.jsxs(b,{sx:{display:"flex",gap:1,alignItems:"center"},onMouseDown:i=>i.stopPropagation(),children:[e.jsxs(b,{sx:{minWidth:120},onClick:i=>i.stopPropagation(),children:[e.jsx(C,{variant:"caption",sx:{mb:.5,ml:1.5,color:"text.secondary"},children:s("dashboard.period")}),e.jsxs("select",{value:h,onChange:i=>{i.stopPropagation(),f(i.target.value)},onClick:i=>i.stopPropagation(),style:{minWidth:120,height:44,padding:"4px 8px",borderRadius:"4px",border:"1px solid rgba(0, 0, 0, 0.23)",backgroundColor:"var(--mui-palette-background-paper, #fff)",fontSize:"0.875rem",cursor:"pointer",touchAction:"manipulation"},children:[e.jsx("option",{value:"weekly",children:s("dashboard.weekly")}),e.jsx("option",{value:"monthly",children:s("dashboard.monthly")}),e.jsx("option",{value:"quarterly",children:s("dashboard.quarterly")}),e.jsx("option",{value:"yearly",children:s("dashboard.yearly")})]})]}),e.jsxs(Lr,{value:d,exclusive:!0,onChange:(i,w)=>{i?.stopPropagation(),w&&y(w)},onClick:i=>i.stopPropagation(),sx:{"& .MuiToggleButton-root":{minWidth:44,minHeight:44,padding:"8px 12px",WebkitTapHighlightColor:"rgba(0, 0, 0, 0.1)",touchAction:"manipulation"}},children:[e.jsx(bn,{value:"line",title:s("dashboard.lineChart"),children:e.jsx(_r,{})}),e.jsx(bn,{value:"area",title:s("dashboard.areaChart"),children:e.jsx($r,{})}),e.jsx(bn,{value:"stacked",title:s("dashboard.stackedArea"),children:e.jsx(Br,{})})]})]})]}),e.jsx(b,{sx:{flex:1,minHeight:200,overflow:"hidden"},"data-chart-id":"trend-chart",children:M&&(O||[]).length>0?e.jsx(b,{sx:{height:"100%",width:"100%",display:"flex"},children:e.jsx(lr,{data:Mt[h],series:rt,periodType:h,type:d})}):e.jsx(b,{sx:{py:8,textAlign:"center",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{variant:"body2",color:"text.secondary",children:(O||[]).length===0?s("dashboard.selectColumns"):s(!Ge&&!De?"dashboard.enableFilenameDates":"dashboard.noTrendData")})})})]},"trend-chart"),Ut.length>0&&e.jsxs(ge,{sx:{p:0,height:"100%",display:bt>1?"flex":"none",flexDirection:"column"},children:[e.jsxs(b,{className:"drag-handle",sx:{cursor:"move",display:"flex",alignItems:"center",justifyContent:"space-between",p:2},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(Vr,{color:"primary"}),e.jsx(C,{variant:"h6",children:s("dashboard.topContributors")})]}),e.jsxs(b,{sx:{display:"flex",gap:1},onMouseDown:i=>i.stopPropagation(),children:[e.jsx(Y,{size:"small",onMouseDown:i=>ie("top-contributors","png",i),title:s("dashboard.downloadAsPng"),children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onMouseDown:i=>ie("top-contributors","jpg",i),title:s("dashboard.downloadAsJpg"),children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("top-contributors",2),title:s("dashboard.taller"),children:e.jsx(jt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("top-contributors",-2),title:s("dashboard.shorter"),children:e.jsx(wt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>g(i=>Math.max(5,i-5)),disabled:x<=5,title:s("dashboard.showFewer"),children:e.jsx(Qt,{fontSize:"small"})}),e.jsx(C,{variant:"body2",sx:{minWidth:60,textAlign:"center"},children:s("dashboard.donors",{count:x})}),e.jsx(Y,{size:"small",onClick:()=>g(i=>Math.min(Ee.length,i+5)),disabled:x>=Ee.length,title:s("dashboard.showMore"),children:e.jsx(It,{fontSize:"small"})})]})]}),e.jsx(b,{sx:{flex:1,minHeight:200,overflow:"hidden"},children:e.jsx(cr,{data:Ut,valueLabel:rt[0]?.label||"Value",limit:x,anonymize:L})})]},"top-contributors"),e.jsxs(ge,{sx:{p:0,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(b,{className:"drag-handle",sx:{cursor:"move",display:"flex",alignItems:"center",gap:1,p:2,mb:2},children:[e.jsx(Or,{color:"primary"}),e.jsx(C,{variant:"h6",children:s("dashboard.descriptiveStatistics")}),e.jsxs(b,{sx:{ml:"auto",display:"flex",gap:1},children:[e.jsx(Y,{size:"small",onClick:()=>ee("statistics-table",2),title:s("dashboard.taller"),children:e.jsx(jt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("statistics-table",-2),title:s("dashboard.shorter"),children:e.jsx(wt,{fontSize:"small"})})]})]}),e.jsx(b,{sx:{flex:1,minHeight:200,overflow:"auto",width:"100%"},children:e.jsx(gr,{statistics:Xe.numericColumns})})]},"statistics-table"),(O||[]).length>0&&e.jsxs(ge,{sx:{p:0,height:"100%",display:bt>1?"flex":"none",flexDirection:"column"},children:[e.jsxs(b,{className:"drag-handle",sx:{cursor:"move",display:"flex",alignItems:"center",justifyContent:"space-between",p:2,pb:1,flexWrap:"wrap",gap:1},children:[e.jsx(C,{variant:"subtitle1",children:s("dashboard.distributionHistogram")}),e.jsxs(b,{sx:{display:"flex",gap:1},onMouseDown:i=>i.stopPropagation(),children:[e.jsx(Y,{size:"small",onMouseDown:i=>ie("histogram","png",i),title:s("dashboard.downloadAsPng"),children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onMouseDown:i=>ie("histogram","jpg",i),title:s("dashboard.downloadAsJpg"),children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>$(i=>Math.max(10,i-10)),disabled:z<=10,title:s("dashboard.fewerBins"),children:e.jsx(Qt,{fontSize:"small"})}),e.jsxs(C,{variant:"body2",sx:{minWidth:45,textAlign:"center"},children:[z," bins"]}),e.jsx(Y,{size:"small",onClick:()=>$(i=>Math.min(200,i+10)),disabled:z>=200,title:s("dashboard.moreBins"),children:e.jsx(It,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("histogram",2),title:s("dashboard.taller"),children:e.jsx(jt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("histogram",-2),title:s("dashboard.shorter"),children:e.jsx(wt,{fontSize:"small"})}),e.jsx(ht,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),e.jsx(Y,{size:"small",onClick:xn,disabled:F===null&&k===null,title:s("dashboard.zoomOut"),children:e.jsx(Qt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:gn,disabled:Ae.length===0,title:s("dashboard.zoomIn"),children:e.jsx(It,{fontSize:"small"})}),(F!==null||k!==null)&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:"small",onClick:pn,disabled:F!==null&&F<=ve.min,title:s("dashboard.panLeft"),children:"<"}),e.jsx(Y,{size:"small",onClick:Kt,disabled:k!==null&&k>=ve.max,title:s("dashboard.panRight"),children:">"}),e.jsx(ne,{size:"small",onClick:Yt,sx:{ml:.5},children:s("dashboard.reset")})]})]})]}),e.jsxs(b,{sx:{flex:1,minHeight:200,overflow:"auto",width:"100%"},children:[e.jsx(xr,{data:mn,valueLabel:rt[0]?.label||"Value"}),(F!==null||k!==null)&&e.jsx(C,{variant:"caption",color:"text.secondary",align:"center",display:"block",children:s("dashboard.zoomed",{min:Oe(F??ve.min),max:Oe(k??ve.max)})})]})]},"histogram"),(O||[]).length>0&&at.length>0&&e.jsxs(ge,{sx:{p:0,height:"100%",display:bt>1?"flex":"none",flexDirection:"column"},children:[e.jsxs(b,{className:"drag-handle",sx:{cursor:"move",display:"flex",alignItems:"center",justifyContent:"space-between",p:2,pb:1},children:[e.jsx(C,{variant:"subtitle1",children:s("dashboard.paretoAnalysis")}),e.jsxs(b,{sx:{display:"flex",gap:1},onMouseDown:i=>i.stopPropagation(),children:[e.jsx(Y,{size:"small",onMouseDown:i=>ie("pareto","png",i),title:s("dashboard.downloadAsPng"),children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onMouseDown:i=>ie("pareto","jpg",i),title:s("dashboard.downloadAsJpg"),children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("pareto",2),title:s("dashboard.taller"),children:e.jsx(jt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("pareto",-2),title:s("dashboard.shorter"),children:e.jsx(wt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>S(i=>Math.max(5,i-5)),disabled:p<=5,title:s("dashboard.showFewer"),children:e.jsx(Qt,{fontSize:"small"})}),e.jsx(C,{variant:"body2",sx:{minWidth:80,textAlign:"center"},children:p>=Ee.length?s("dashboard.all",{count:Ee.length}):s("dashboard.donors",{count:p})}),e.jsx(Y,{size:"small",onClick:()=>S(i=>Math.min(Ee.length,i+5)),disabled:p>=Ee.length,title:s("dashboard.showMore"),children:e.jsx(It,{fontSize:"small"})})]})]}),e.jsx(b,{sx:{flex:1,minHeight:200,overflow:"auto",width:"100%"},children:e.jsx(pr,{data:at,valueLabel:rt[0]?.label||"Value",showTop:p,anonymize:L})})]},"pareto"),(O||[]).length>0&&qt.length>0&&e.jsxs(ge,{sx:{p:0,height:"100%",display:bt>1?"flex":"none",flexDirection:"column"},children:[e.jsxs(b,{className:"drag-handle",sx:{cursor:"move",display:"flex",alignItems:"center",gap:1,p:2,pb:1},children:[e.jsx(Hr,{color:"primary"}),e.jsx(C,{variant:"h6",children:s("dashboard.rangeDistribution")})]}),e.jsxs(b,{sx:{display:"flex",gap:1},onMouseDown:i=>i.stopPropagation(),children:[e.jsx(Y,{size:"small",onMouseDown:i=>ie("range-distribution","png",i),title:s("dashboard.downloadAsPng"),children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onMouseDown:i=>ie("range-distribution","jpg",i),title:s("dashboard.downloadAsJpg"),children:e.jsx(Ke,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("range-distribution",2),title:s("dashboard.taller"),children:e.jsx(jt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>ee("range-distribution",-2),title:s("dashboard.shorter"),children:e.jsx(wt,{fontSize:"small"})})]}),e.jsx(b,{sx:{flex:1,minHeight:200,overflow:"auto",width:"100%"},children:e.jsx(fr,{data:qt,valueLabel:rt[0]?.label||"Value"})})]},"range-distribution")]})]})};function ja(t,n,a){const r=new Map,s=new Map,o=new Map,l=new Map,c=x=>{if(x instanceof Date)return x;if(typeof x!="string")return null;const g=x.trim(),p=g.match(/(\d{4})(\d{2})(\d{2})/);if(p){const S=parseInt(p[1],10),z=parseInt(p[2],10)-1,$=parseInt(p[3],10);return new Date(S,z,$)}if(/^\d{4}-\d{2}-\d{2}$/.test(g))return new Date(g);if(/^\d{2}\.\d{2}\.\d{4}$/.test(g)){const S=g.split(".");return new Date(parseInt(S[2],10),parseInt(S[1],10)-1,parseInt(S[0],10))}if(/^\d{2}\/\d{2}\/\d{4}$/.test(g)){const S=g.split("/");return new Date(parseInt(S[2],10),parseInt(S[1],10)-1,parseInt(S[0],10))}return null},h=x=>{const g=new Date(Date.UTC(x.getFullYear(),x.getMonth(),x.getDate())),p=(g.getUTCDay()+6)%7;g.setUTCDate(g.getUTCDate()-p+3);const S=g.getUTCFullYear(),z=new Date(Date.UTC(S,0,4)),$=(z.getUTCDay()+6)%7,F=new Date(z);F.setUTCDate(z.getUTCDate()-$);const D=1+Math.round((g.getTime()-F.getTime())/6048e5),k=new Date(Date.UTC(x.getFullYear(),x.getMonth(),x.getDate())),T=(k.getUTCDay()+6)%7;return k.setUTCDate(k.getUTCDate()-T),{weekYear:S,weekNo:D,monday:k}},f=x=>{if(!x)return null;const g=x.match(/\b\d{8}\b/);if(g){const S=g[0],z=parseInt(S.substring(0,4),10),$=parseInt(S.substring(4,6),10)-1,F=parseInt(S.substring(6,8),10);return new Date(z,$,F)}const p=x.match(/(\d{4})(\d{2})(\d{2})/);if(p){const S=parseInt(p[1],10),z=parseInt(p[2],10)-1,$=parseInt(p[3],10);return new Date(S,z,$)}return null};t.forEach(x=>{let g=null;if(n==="_sourceFileName"?g=f(x._sourceFileName):g=c(x[n]),!g)return;const p={};a.forEach(Z=>{p[Z]=parseFloat(x[Z])||0});const{weekYear:S,weekNo:z,monday:$}=h(g),F=`${S}-W${String(z).padStart(2,"0")}`,D=new Date($);r.has(F)||r.set(F,{date:D,values:Object.fromEntries(a.map(Z=>[Z,0])),count:0,latest:g});const k=r.get(F);a.forEach(Z=>{k.values[Z]+=p[Z]}),k.count+=1,(!k.latest||g&&g.getTime()>k.latest.getTime())&&(k.latest=g);const T=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`,V=new Date(g.getFullYear(),g.getMonth(),1);s.has(T)||s.set(T,{date:V,values:Object.fromEntries(a.map(Z=>[Z,0])),count:0});const L=s.get(T);a.forEach(Z=>{L.values[Z]+=p[Z]}),L.count+=1;const U=Math.floor(g.getMonth()/3),J=`${g.getFullYear()}-Q${U+1}`,q=new Date(g.getFullYear(),U*3,1);o.has(J)||o.set(J,{date:q,values:Object.fromEntries(a.map(Z=>[Z,0])),count:0});const re=o.get(J);a.forEach(Z=>{re.values[Z]+=p[Z]}),re.count+=1;const ae=`${g.getFullYear()}`,xe=new Date(g.getFullYear(),0,1);l.has(ae)||l.set(ae,{date:xe,values:Object.fromEntries(a.map(Z=>[Z,0])),count:0});const he=l.get(ae);a.forEach(Z=>{he.values[Z]+=p[Z]}),he.count+=1});const d=(x,g)=>Array.from(x.entries()).map(([p,S])=>({period:g?g(p,S):p,count:S.count,date:S.date,...S.values})).sort((p,S)=>(p.date?.getTime()||0)-(S.date?.getTime()||0)),y=x=>{try{const g=x.toLocaleString("en-US",{month:"short"}),p=String(x.getDate()).padStart(2,"0");return`${g} ${p}`}catch{return`${x.getMonth()+1}/${x.getDate()}`}};return{weekly:d(r,(x,g)=>`${x}
(${y(g.latest||g.date)})`),monthly:d(s),quarterly:d(o),yearly:d(l)}}function wa(t,n){const a=new Map,r=new Map,s=new Map,o=new Map;t.forEach(h=>{const d=(h._sourceFileName||"").match(br);if(d){const y=d[1],x=parseInt(y.substring(0,4),10),g=parseInt(y.substring(4,6),10)-1,p=parseInt(y.substring(6,8),10),S={};n.forEach(E=>{S[E]=parseFloat(h[E])||0});const z=new Date(x,g,p||1),$=new Date(Date.UTC(z.getFullYear(),z.getMonth(),z.getDate())),F=($.getUTCDay()+6)%7;$.setUTCDate($.getUTCDate()-F+3);const D=$.getUTCFullYear(),k=new Date(Date.UTC(D,0,4)),T=(k.getUTCDay()+6)%7,V=new Date(k);V.setUTCDate(k.getUTCDate()-T);const L=1+Math.round(($.getTime()-V.getTime())/6048e5),U=new Date(Date.UTC(z.getFullYear(),z.getMonth(),z.getDate())),J=(U.getUTCDay()+6)%7;U.setUTCDate(U.getUTCDate()-J);const q=`${D}-W${String(L).padStart(2,"0")}`;a.has(q)||a.set(q,{date:new Date(U),values:Object.fromEntries(n.map(E=>[E,0])),count:0,latest:z});const re=a.get(q);n.forEach(E=>{re.values[E]+=S[E]}),re.count+=1,(!re.latest||z.getTime()>re.latest.getTime())&&(re.latest=z);const ae=`${x}-${String(g+1).padStart(2,"0")}`,xe=new Date(x,g,1);r.has(ae)||r.set(ae,{date:xe,values:Object.fromEntries(n.map(E=>[E,0])),count:0});const he=r.get(ae);n.forEach(E=>{he.values[E]+=S[E]}),he.count+=1;const Z=Math.floor(g/3),ie=`${x}-Q${Z+1}`,le=new Date(x,Z*3,1);s.has(ie)||s.set(ie,{date:le,values:Object.fromEntries(n.map(E=>[E,0])),count:0});const de=s.get(ie);n.forEach(E=>{de.values[E]+=S[E]}),de.count+=1;const _=`${x}`,A=new Date(x,0,1);o.has(_)||o.set(_,{date:A,values:Object.fromEntries(n.map(E=>[E,0])),count:0});const I=o.get(_);n.forEach(E=>{I.values[E]+=S[E]}),I.count+=1}});const l=(h,f)=>Array.from(h.entries()).map(([d,y])=>({period:f?f(d,y):d,count:y.count,date:y.date,...y.values})).sort((d,y)=>(d.date?.getTime()||0)-(y.date?.getTime()||0)),c=h=>{try{const f=h.toLocaleString("en-US",{month:"short"}),d=String(h.getDate()).padStart(2,"0");return`${f} ${d}`}catch{return`${h.getMonth()+1}/${h.getDate()}`}};return{weekly:l(a,(h,f)=>`${h}
(${c(f.latest||f.date)})`),monthly:l(r),quarterly:l(s),yearly:l(o)}}const yr=Ie.memo(ya,(t,n)=>t.data===n.data&&t.columnMapping===n.columnMapping&&t.nameColumn===n.nameColumn);yr.displayName="DashboardView";class Sa extends Ie.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[Dashboard ErrorBoundary]",n,a)}handleReset=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?e.jsx(b,{sx:{p:2},children:e.jsxs(Ct,{severity:"error",children:[e.jsx(Kr,{children:this.props.title||"Something went wrong in this view."}),String(this.state.error?.message||this.state.error||"Unknown error"),e.jsx(b,{sx:{mt:1},children:e.jsx(ne,{size:"small",variant:"outlined",onClick:this.handleReset,children:"Try again"})})]})}):this.props.children}}function On(t,n,a){const r=t[a],s=n[a];return r==null?s==null?0:1:s==null?-1:typeof r=="string"&&typeof s=="string"?s.localeCompare(r):typeof r=="number"&&typeof s=="number"?s-r:String(s).localeCompare(String(r))}function va(t,n){return t==="desc"?(a,r)=>On(a,r,n):(a,r)=>-On(a,r,n)}function Ca(t,n){const a=t.map((r,s)=>[r,s]);return a.sort((r,s)=>{const o=n(r[0],s[0]);return o!==0?o:r[1]-s[1]}),a.map(r=>r[0])}const Da=({data:t,filteredData:n,nameColumn:a,headerRowIndex:r,selectedUniqueNames:s,onToggleFullScreen:o,isFullScreen:l,columnVisibility:c,setColumnVisibility:h,columnMapping:f})=>{const{t:d}=Ce(),[y,x]=u.useState("asc"),[g,p]=u.useState(""),[S,z]=u.useState(""),[$,F]=u.useState(0),[D,k]=u.useState(10),[T,V]=u.useState(null),[L,U]=u.useState(new Set),[J,q]=u.useState(()=>{try{const m=localStorage.getItem("excel-processor-auto-deselect-zeros");return m!==null?JSON.parse(m):!0}catch{return!0}}),[re,ae]=u.useState(!1),[xe,he]=u.useState(!1),[Z,ie]=u.useState(()=>{try{return localStorage.getItem("excel-processor-hide-deselected")==="true"}catch{return!1}}),[le,de]=u.useState({}),[_,A]=u.useState(null),[I,E]=u.useState(null),[v,P]=u.useState(""),[H,te]=u.useState(()=>{try{const m=localStorage.getItem("excel-processor-column-order");return m?JSON.parse(m):[]}catch{return[]}}),ee=u.useMemo(()=>{if(!a||t.length===0||!(M=>/^[A-Z]+$/.test(M)||/^__EMPTY/.test(M))(a))return a;const j=r-1;if(j>=0&&j<t.length){const i=t[j][a];if(i!=null&&i!=="")return String(i)}return a},[t,a,r]),Q=(m,j,M)=>{if(M&&M in m)return m[M];if(j)return m[j]},pe=u.useMemo(()=>{if(f)return f;if(t.length===0)return{};const m=r-1;if(console.log("DetailedDataView - headerRowIndex:",r,"headerRowIdx:",m),m<0||m>=t.length)return{};const j=t[0],M=Object.keys(j).filter(B=>!B.startsWith("_")),i=B=>/^[A-Z]+$/.test(B)||/^__EMPTY/.test(B),w=M.length>0&&M.every(i),N={};if(!w)return Object.keys(j).forEach(B=>{N[B]=B}),console.log("DetailedDataView - columnMapping (identity):",N),N;const W=t[m];return console.log("DetailedDataView - headerRow sample:",W),Object.keys(W).forEach(B=>{const K=W[B];K!=null&&K!==""?N[B]=String(K):N[B]=B}),console.log("DetailedDataView - columnMapping:",N),N},[t,r,f]),be=u.useMemo(()=>{if(n!==void 0)return n;if(!a||s.length===0||t.length===0)return[];const m=r-1,j=new Set(s);return t.filter((M,i)=>i!==m).filter(M=>{const i=Q(M,a,ee);return j.has(i)||M._originalName&&j.has(M._originalName)})},[n,t,a,r,s,ee]),O=u.useMemo(()=>{if(be.length===0)return[];const m=Object.keys(be[0]);let j=[];m.includes("_sourceFileName")&&(j.push({id:"_sourceFileName",label:d("detailedView.fromFilename"),numeric:!1}),j.push({id:"_sourceSheetName",label:d("detailedView.fromSheet"),numeric:!1})),m.filter(i=>i!=="_sourceFileName"&&i!=="_sourceSheetName").forEach(i=>{const w=pe[i]||i;j.push({id:i,label:w,numeric:typeof be[0][i]=="number"})});const M={};if(j.forEach(i=>{M[i.label]=(M[i.label]||0)+1}),Object.values(M).some(i=>i>1)&&(j=j.map(i=>{if(M[i.label]>1){const w=i.id==="_sourceFileName"||i.id==="_sourceSheetName";return{...i,label:`${i.label} ${w?"(origin)":"(data)"}`}}return i})),H.length>0){const i=[];return H.forEach(w=>{const N=j.find(W=>W.id===w);N&&i.push(N)}),j.forEach(w=>{H.includes(w.id)||i.push(w)}),i}return j},[be,H,pe]);u.useEffect(()=>{if(O.length>0&&Object.keys(c).length===0){const m={};O.forEach(j=>{m[j.id]=!0}),h(m)}},[O,h]),u.useEffect(()=>{try{localStorage.setItem("excel-processor-auto-deselect-zeros",JSON.stringify(J))}catch(m){console.warn("Could not save auto-deselect preference to localStorage:",m)}},[J]),u.useEffect(()=>{if(xe)try{window.dispatchEvent(new Event("resize"));const m=setTimeout(()=>{try{window.dispatchEvent(new Event("resize"))}catch{}},80),j=setTimeout(()=>{try{window.dispatchEvent(new Event("resize"))}catch{}},200);return()=>{clearTimeout(m),clearTimeout(j)}}catch{}},[xe]);const X=u.useMemo(()=>O.filter(m=>c[m.id]),[O,c]),De=u.useCallback(m=>{const j=new Set;return be.forEach(M=>{let i;if(m==="_sourceFileName"||m==="_sourceSheetName")i=M[m];else{const w=pe[m]||m;i=Q(M,m,w)}i!=null?j.add(String(i)):j.add("(empty)")}),Array.from(j).sort((M,i)=>M==="(empty)"?1:i==="(empty)"?-1:M.localeCompare(i,"de"))},[be,pe]),Ue=u.useCallback(m=>{const j=le[m];if(!j)return!1;const M=De(m);return j.size<M.length},[le,De]),Ge=u.useCallback(m=>{for(const j of X){const M=le[j.id];if(!M||M.size===0)continue;let i;if(j.id==="_sourceFileName"||j.id==="_sourceSheetName")i=m[j.id];else{const N=pe[j.id]||j.id;i=Q(m,j.id,N)}const w=i!=null?String(i):"(empty)";if(!M.has(w))return!1}return!0},[X,le,pe]);u.useEffect(()=>{X.length>0&&!g&&(p(X[0].id),x("asc"))},[X]);const xt=(m,j)=>{x(g===j&&y==="asc"?"desc":"asc"),p(j)},pt=u.useMemo(()=>be.map((m,j)=>({...m,_stableIndex:j})),[be]),R=u.useMemo(()=>{let m=pt;if(S){const j=S.toLowerCase();m=m.filter(M=>Object.keys(M).some(i=>{if(i==="_stableIndex")return!1;if(i==="_sourceFileName"||i==="_sourceSheetName")return String(M[i]).toLowerCase().includes(j);const w=pe[i]||i,N=Q(M,i,w);return String(N).toLowerCase().includes(j)}))}return m=m.filter(j=>Ge(j)),g&&(m=Ca(m,(j,M)=>{let i,w;if(g==="_sourceFileName"||g==="_sourceSheetName")i=j[g],w=M[g];else{const N=pe[g]||g;i=Q(j,g,N),w=Q(M,g,N)}return va(y,g)({[g]:i},{[g]:w})})),m},[be,S,y,g,pe,Ge]);u.useEffect(()=>{if(be.length===0){U(new Set);return}const m=w=>/^[-+]?(\d+\.?\d*|\.\d+)([eE][-+]?\d+)?$/.test(w.trim()),j=(w,N)=>{if(N.size===0)return!1;for(const W of N){const B=w[W];if(!(B==null||B===""||typeof B=="boolean")){if(typeof B=="number"){if(B!==0)return!1;continue}if(typeof B=="string"){const K=B.trim();if(m(K)){const Fe=parseFloat(K);if(!isNaN(Fe)&&Fe!==0)return!1}continue}}}return!0},M=new Set(X.map(w=>w.id).filter(w=>w!=="_sourceFileName"&&w!=="_sourceSheetName")),i=new Set;be.forEach((w,N)=>{J&&j(w,M)||i.add(N)}),U(i)},[be,J,X]);const fe=u.useMemo(()=>{const m={};return X.forEach(j=>{let M=0,i=!1;R.forEach(w=>{if(!L.has(w._stableIndex))return;let N;if(j.id==="_sourceFileName"||j.id==="_sourceSheetName")N=w[j.id];else{const B=pe[j.id]||j.id;N=Q(w,j.id,B)}if(N==null||N===""||typeof N=="boolean")return;const W=parseFloat(String(N));isNaN(W)||(M+=W,i=!0)}),m[j.id]=i?M:""}),m},[R,X,pe,L]),se=u.useMemo(()=>{if(R.length===0)return[];const m=X.map(j=>j.id);return R.filter(j=>L.has(j._stableIndex)).map(j=>{const M={};return j._sourceFileName!==void 0&&(M._sourceFileName=j._sourceFileName),j._sourceSheetName!==void 0&&(M._sourceSheetName=j._sourceSheetName),m.forEach(i=>{i!=="_stableIndex"&&(M[i]=j[i])}),M})},[R,X,L]),G=u.useMemo(()=>{const m={};return X.forEach(j=>{m[j.id]=j.label}),m._sourceFileName=m._sourceFileName||d("detailedView.fromFilename"),m._sourceSheetName=m._sourceSheetName||d("detailedView.fromSheet"),m},[X]);u.useEffect(()=>{xe&&me("[Dashboard]","dialog open; prepared data",{rows:se.length,cols:se.length>0?Object.keys(se[0]).length:0,sampleCols:se.length>0?Object.keys(se[0]).slice(0,10):[]})},[xe,se]);const ye=()=>{if(R.length>0){const m=R.filter(w=>L.has(w._stableIndex)).map(w=>{const N={};return X.forEach(W=>{let B;if(W.id==="_sourceFileName"||W.id==="_sourceSheetName")B=w[W.id];else{const K=pe[W.id]||W.id;B=Q(w,W.id,K)}N[W.label]=B}),N}),j=nn.json_to_sheet(m),M=nn.book_new();nn.book_append_sheet(M,j,"SelectedData");const i=s.length>1?"selected_data.csv":`${s[0]}_data.csv`;es(M,i)}},_e=()=>({data:R,visibleHeaders:X,includedIndices:L,columnTotals:Object.fromEntries(Object.entries(fe).filter(([m,j])=>typeof j=="number")),selectedNames:s,sourceFiles:Array.from(new Set(R.map(m=>m._sourceFileName).filter(m=>!!m))),sourceSheets:Array.from(new Set(R.map(m=>m._sourceSheetName).filter(m=>!!m)))}),Ne=m=>{U(j=>{const M=new Set(j);return M.has(m)?M.delete(m):M.add(m),M})},ze=()=>{const m=M=>/^[-+]?(\d+\.?\d*|\.\d+)([eE][-+]?\d+)?$/.test(M.trim()),j=M=>{const i=new Set(X.map(w=>w.id));for(const[w,N]of Object.entries(M))if(i.has(w)&&!(w==="_sourceFileName"||w==="_sourceSheetName"||w==="_stableIndex")&&!(N==null||N===""||typeof N=="boolean")){if(typeof N=="number"){if(N!==0)return!1;continue}if(typeof N=="string"){const W=N.trim();if(m(W)){const B=parseFloat(W);if(!isNaN(B)&&B!==0)return!1}continue}}return!0};U(M=>{const i=new Set(M);return R.forEach(w=>{J&&j(w)||i.add(w._stableIndex)}),i})},ke=()=>{U(m=>{const j=new Set(m);return R.forEach(M=>{j.delete(M._stableIndex)}),j})},nt=(m,j)=>{F(j)},Xe=m=>{k(parseInt(m.target.value,10)),F(0)},Mt=m=>{V(m.currentTarget)},Ut=()=>{V(null)},ft=m=>{h(j=>({...j,[m]:!j[m]}))},bt=()=>{const m={};O.forEach(j=>{m[j.id]=!0}),h(m)},Ee=()=>{const m={};O.forEach(j=>{m[j.id]=!1}),h(m)},Gt=m=>{if(!m.destination)return;const j=Array.from(O),[M]=j.splice(m.source.index,1);j.splice(m.destination.index,0,M);const i=j.map(w=>w.id);te(i);try{localStorage.setItem("excel-processor-column-order",JSON.stringify(i))}catch(w){console.warn("Could not save column order to localStorage:",w)}},rt=u.useMemo(()=>X.some(m=>Ue(m.id)),[X,Ue]),Ae=(m,j)=>{A(m.currentTarget),E(j),P("")},mn=()=>{A(null),E(null),P("")},ve=(m,j)=>{de(M=>{const i=M[m]||new Set(De(m)),w=new Set(i);return w.has(j)?w.delete(j):w.add(j),{...M,[m]:w}})},gn=m=>{de(j=>({...j,[m]:new Set(De(m))}))},xn=m=>{de(j=>({...j,[m]:new Set}))},pn=m=>{de(j=>{const M={...j};return delete M[m],M})},Kt=()=>{de({})};u.useEffect(()=>{const m={};X.forEach(j=>{le[j.id]||(m[j.id]=new Set(De(j.id)))}),Object.keys(m).length>0&&de(j=>({...m,...j}))},[X,De]);const Yt=O.length>0&&O.every(m=>c[m.id]);if(s.length===0||t.length===0)return null;const at=Z?R.filter(m=>L.has(m._stableIndex)):R,qt=D>0?at.slice($*D,$*D+D):at,Zt=D-Math.min(D,at.length-$*D);return e.jsxs(b,{sx:{mt:l?0:4,width:"100%",height:l?"100%":"auto",display:"flex",flexDirection:"column"},children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(C,{variant:"h6",gutterBottom:!l,children:[d("detailedView.detailsFor")," ",e.jsx("strong",{children:s.length<=3?s.join(", "):`${s.slice(0,2).join(", ")} ${d("detailedView.andMore",{count:s.length-2})}`})," ","(",R.length," ",d("detailedView.rows"),")"]}),e.jsxs(b,{children:[e.jsx(Y,{onClick:o,size:"small",sx:{ml:1},children:e.jsx(Yr,{})}),e.jsx(Y,{onClick:Mt,size:"small",sx:{ml:1},children:e.jsx(qr,{})}),e.jsxs(Zr,{anchorEl:T,open:!!T,onClose:Ut,PaperProps:{sx:{maxHeight:600,width:320}},children:[e.jsx(Ze,{dense:!0,onClick:bt,disabled:Yt,children:e.jsx(C,{variant:"body2",children:d("detailedView.selectAllColumns")})}),e.jsx(Ze,{dense:!0,onClick:Ee,disabled:!Yt,children:e.jsx(C,{variant:"body2",children:d("detailedView.unselectAllColumns")})}),e.jsx(ht,{}),e.jsx(Zn,{onDragEnd:Gt,children:e.jsx(Jn,{droppableId:"column-list",children:m=>e.jsxs("div",{...m.droppableProps,ref:m.innerRef,children:[O.map((j,M)=>e.jsx(Xn,{draggableId:j.id,index:M,disableInteractiveElementBlocking:!0,children:(i,w)=>e.jsx("div",{ref:i.innerRef,...i.draggableProps,style:{...i.draggableProps.style,backgroundColor:w.isDragging?"rgba(0, 0, 0, 0.04)":"transparent"},children:e.jsxs(Ze,{dense:!0,disableRipple:!0,children:[e.jsx(b,{...i.dragHandleProps,sx:{display:"flex",alignItems:"center",mr:1,cursor:"grab"},children:e.jsx(Qn,{fontSize:"small",sx:{color:"text.secondary"}})}),e.jsx(st,{control:e.jsx(Ve,{checked:c[j.id],onChange:()=>ft(j.id),size:"small",onClick:N=>N.stopPropagation()}),label:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:.75},children:[e.jsx(C,{variant:"body2",children:j.label}),j.id==="_sourceFileName"&&e.jsx(He,{label:d("detailedView.fromFilename"),size:"small",variant:"outlined",color:"info",sx:{fontSize:"0.7rem",height:20,"& .MuiChip-label":{fontSize:"0.65rem"}}}),j.id==="_sourceSheetName"&&e.jsx(He,{label:d("detailedView.fromSheet"),size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,"& .MuiChip-label":{fontSize:"0.65rem"}}})]}),sx:{ml:0,flex:1}})]})})},j.id)),m.placeholder]})})})]})]})]}),e.jsxs(b,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,alignItems:{xs:"stretch",md:"center"},justifyContent:{xs:"flex-start",md:"space-between"},mb:2},children:[e.jsx(et,{variant:"outlined",size:"small",placeholder:d("detailedView.searchAllColumns"),value:S,onChange:m=>{z(m.target.value),F(0)},InputProps:{startAdornment:e.jsx(Wt,{position:"start",children:e.jsx(Sn,{})}),endAdornment:S&&e.jsx(Wt,{position:"end",children:e.jsx(Y,{onClick:()=>z(""),edge:"end",size:"small",children:e.jsx(sn,{})})})},sx:{width:{xs:"100%",md:"30%"}}}),e.jsxs(b,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center"},children:[(S||rt)&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{title:d("detailedView.selectRowsTooltip"),arrow:!0,children:e.jsx("span",{children:e.jsx(ne,{variant:"outlined",size:"small",onClick:ze,disabled:R.length===0,sx:{width:{xs:"100%",md:"auto"}},children:d("detailedView.selectAll")})})}),e.jsx(Be,{title:d("detailedView.deselectRowsTooltip"),arrow:!0,children:e.jsx("span",{children:e.jsx(ne,{variant:"outlined",size:"small",onClick:ke,disabled:L.size===0,sx:{width:{xs:"100%",md:"auto"}},children:d("detailedView.deselectAll")})})})]}),e.jsx(Be,{title:d("detailedView.exportCsvTooltip"),arrow:!0,children:e.jsx("span",{children:e.jsx(ne,{variant:"contained",color:"primary",onClick:ye,disabled:L.size===0,sx:{width:{xs:"100%",md:"auto"}},children:d("detailedView.exportCsv",{count:L.size})})})}),e.jsx(Be,{title:d("detailedView.pdfTooltip"),arrow:!0,children:e.jsx("span",{children:e.jsx(ne,{variant:"contained",color:"secondary",onClick:()=>ae(!0),disabled:L.size===0,startIcon:e.jsx(Jr,{}),sx:{width:{xs:"100%",md:"auto"}},children:d("detailedView.pdf",{count:L.size})})})})]})]}),e.jsxs(b,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center",mb:2},children:[e.jsx(C,{variant:"body2",color:"text.secondary",children:d("detailedView.rowsSelected",{total:R.length,selected:L.size})}),e.jsxs(Xr,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(st,{control:e.jsx(Vt,{checked:J,onChange:m=>q(m.target.checked),size:"small"}),label:e.jsx(Be,{title:d("detailedView.autoDeselectTooltip"),arrow:!0,children:e.jsx("span",{children:d("detailedView.autoDeselectZeros")})}),sx:{mr:1}}),e.jsx(st,{control:e.jsx(Vt,{checked:Z,onChange:m=>{const j=m.target.checked;ie(j);try{localStorage.setItem("excel-processor-hide-deselected",String(j))}catch{}F(0)},size:"small"}),label:e.jsx(Be,{title:d("detailedView.hideDeselectedTooltip"),arrow:!0,children:e.jsx("span",{children:d("detailedView.hideDeselected")})})})]})]}),rt&&e.jsxs(b,{sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{size:"small",label:d("detailedView.columnFiltersActive"),color:"primary",variant:"outlined",onDelete:Kt,deleteIcon:e.jsx(Pn,{})}),e.jsx(ne,{size:"small",variant:"text",onClick:Kt,startIcon:e.jsx(Pn,{}),children:d("detailedView.clearAllFilters")})]}),e.jsx(Nn,{component:ge,sx:{flexGrow:1,overflow:"auto"},children:e.jsxs(zn,{stickyHeader:!0,"aria-label":"detailed data table",children:[e.jsx(Mn,{children:e.jsxs(qe,{children:[e.jsx(oe,{padding:"checkbox",children:e.jsx(Ve,{indeterminate:(()=>{const m=R.filter(j=>L.has(j._stableIndex)).length;return m>0&&m<R.length})(),checked:R.length===0?!1:R.every(m=>L.has(m._stableIndex)),onChange:()=>{R.every(j=>L.has(j._stableIndex))?ke():ze()},inputProps:{"aria-label":d("detailedView.selectAllRowsAria")}})}),X.map((m,j)=>e.jsx(oe,{align:m.numeric?"right":"left",padding:"normal",sortDirection:g===m.id?y:!1,sx:{borderRight:j<X.length-1?1:0,borderColor:"divider"},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Kn,{active:g===m.id,direction:g===m.id?y:"asc",onClick:M=>xt(M,m.id),children:m.label}),e.jsx(Be,{title:Ue(m.id)?d("detailedView.filterActive"):d("detailedView.filterColumn"),children:e.jsx(Y,{size:"small",onClick:M=>Ae(M,m.id),sx:{ml:.5,padding:.25,color:Ue(m.id)?"primary.main":"action.active"},children:Ue(m.id)?e.jsx(Wn,{fontSize:"small"}):e.jsx(Wn,{fontSize:"small"})})})]})},m.id))]})}),e.jsxs(En,{children:[qt.map((m,j)=>{const M=L.has(m._stableIndex);return e.jsxs(qe,{hover:!0,sx:{opacity:M?1:.5},children:[e.jsx(oe,{padding:"checkbox",children:e.jsx(Ve,{checked:M,onChange:()=>Ne(m._stableIndex),inputProps:{"aria-label":`select row ${j+1}`}})}),X.map((i,w)=>{let N;if(i.id==="_sourceFileName"||i.id==="_sourceSheetName")N=m[i.id];else{const W=pe[i.id]||i.id;N=Q(m,i.id,W)}return e.jsx(oe,{sx:{borderRight:w<X.length-1?1:0,borderColor:"divider"},children:N!=null?String(N):""},`${j}-${i.id}`)})]},m._stableIndex)}),Zt>0&&e.jsx(qe,{style:{height:33*Zt},children:e.jsx(oe,{colSpan:X.length+1,sx:{borderRight:0}})}),e.jsxs(qe,{sx:{"& > td":{fontWeight:"bold"}},children:[e.jsx(oe,{}),X.map((m,j)=>e.jsx(oe,{align:j===0?"left":m.numeric?"right":"left",sx:{borderRight:j<X.length-1?1:0,borderColor:"divider"},children:j===0?d("detailedView.total"):typeof fe[m.id]=="number"?fe[m.id].toFixed(2):fe[m.id]},`total-${m.id}`))]})]})]})}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ne,{variant:"contained",color:"info",onClick:()=>{me("[Dashboard]","Open clicked",{includedVisibleRows:R.filter(m=>L.has(m._stableIndex)).length,totalVisibleRows:R.length,visibleHeaders:X.map(m=>m.id)}),he(!0)},disabled:R.filter(j=>L.has(j._stableIndex)).length===0,startIcon:e.jsx(Ln,{}),size:"small",children:d("detailedView.dashboard",{count:R.filter(m=>L.has(m._stableIndex)).length})}),e.jsx(Gn,{rowsPerPageOptions:[5,10,25,{label:"All",value:-1}],component:"div",count:at.length,rowsPerPage:D,page:$,onPageChange:nt,onRowsPerPageChange:Xe})]}),e.jsx(qs,{open:re,onClose:()=>ae(!1),context:_e()}),e.jsxs(ct,{fullScreen:!0,open:xe,onClose:()=>he(!1),TransitionProps:{onEntered:()=>{try{window.dispatchEvent(new Event("resize"))}catch{}}},children:[e.jsxs(dt,{sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ln,{}),e.jsx(C,{variant:"h6",children:d("detailedView.dashboardTitle")})]}),e.jsx(Y,{"aria-label":"close",onClick:()=>he(!1),sx:{color:m=>m.palette.grey[500]},children:e.jsx(sn,{})})]}),e.jsx(vt,{dividers:!0,sx:{p:0},children:e.jsx(Sa,{title:d("detailedView.dashboardFailed"),children:e.jsx(yr,{data:se,columnMapping:G,nameColumn:a,deferRendering:!0})})})]}),e.jsx(Qr,{open:!!_,anchorEl:_,onClose:mn,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{maxHeight:"60vh",width:320}},children:I&&e.jsxs(b,{children:[e.jsxs(b,{sx:{p:1.5,borderBottom:1,borderColor:"divider"},children:[e.jsxs(C,{variant:"subtitle2",gutterBottom:!0,children:[d("detailedView.filter"),": ",X.find(m=>m.id===I)?.label]}),e.jsx(et,{size:"small",placeholder:d("detailedView.searchValues"),value:v,onChange:m=>P(m.target.value),fullWidth:!0,InputProps:{startAdornment:e.jsx(Wt,{position:"start",children:e.jsx(Sn,{fontSize:"small"})})}})]}),e.jsxs(b,{sx:{px:1.5,py:1,borderBottom:1,borderColor:"divider",display:"flex",justifyContent:"space-between",gap:1},children:[e.jsxs(b,{sx:{display:"flex",gap:1},children:[e.jsx(ne,{size:"small",onClick:()=>gn(I),children:d("detailedView.selectAll")}),e.jsx(ne,{size:"small",onClick:()=>xn(I),children:d("detailedView.deselectAll")})]}),e.jsx(ne,{size:"small",onClick:()=>pn(I),color:"error",children:d("detailedView.reset")})]}),e.jsx(_t,{dense:!0,sx:{maxHeight:"55vh",overflow:"auto",py:0},children:De(I).filter(m=>!v||m.toLowerCase().includes(v.toLowerCase())).map(m=>{const j=le[I],M=j?j.has(m):!0;return e.jsxs(Cn,{dense:!0,onClick:()=>ve(I,m),children:[e.jsx(Dn,{sx:{minWidth:36},children:e.jsx(Ve,{edge:"start",checked:M,size:"small"})}),e.jsx(Rt,{primary:m||"(empty)",primaryTypographyProps:{variant:"body2",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}})]},m)})}),e.jsx(b,{sx:{p:1.5,borderTop:1,borderColor:"divider",bgcolor:"action.hover"},children:e.jsx(C,{variant:"caption",color:"text.secondary",children:d("detailedView.valuesSelected",{selected:le[I]?.size||De(I).length,total:De(I).length})})})]})})]})},ka=250,Fa=({files:t,onMerge:n,onCancel:a})=>{const{t:r}=Ce(),[s,o]=u.useState([]),l=d=>{const y=s.indexOf(d),x=[...s];y===-1?x.push(d):x.splice(y,1),o(x)},c=(d,y,x)=>{let g=[...s];const p=y.map(S=>`${d}::${S.sheetName}`);x?p.forEach(S=>{g.includes(S)||g.push(S)}):g=g.filter(S=>!p.includes(S)),o(g)},h=d=>{let y=[...s];const x=t.flatMap(p=>p.sheets.filter(S=>S.sheetName===d).map(S=>`${p.fileName}::${S.sheetName}`));x.every(p=>s.includes(p))?y=y.filter(p=>!x.includes(p)):x.forEach(p=>{y.includes(p)||y.push(p)}),o(y)},f=()=>{s.length>0&&n(s)};return e.jsxs(ge,{elevation:3,sx:{p:3,mt:4,width:"100%",overflow:"hidden"},children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:r("sheetSelector.title")}),e.jsx(C,{variant:"body2",color:"text.secondary",sx:{mb:2},children:r("sheetSelector.description")}),e.jsx(b,{sx:{display:"flex",overflowX:"auto",py:1,"& > div":{flexShrink:0,mr:2}},children:t.map(d=>{const y=d.sheets.map(p=>`${d.fileName}::${p.sheetName}`),x=y.every(p=>s.includes(p))&&y.length>0,g=y.some(p=>s.includes(p))&&!x;return e.jsxs(ge,{variant:"outlined",sx:{width:ka,p:1,maxHeight:400,overflowY:"auto"},children:[e.jsx(Un,{component:"div",sx:{p:0,lineHeight:"normal",bgcolor:"background.paper",position:"sticky",top:0,zIndex:1},children:e.jsx(st,{control:e.jsx(Ve,{size:"small",checked:x,indeterminate:g,onChange:p=>c(d.fileName,d.sheets,p.target.checked)}),label:e.jsx(C,{variant:"subtitle2",noWrap:!0,children:d.fileName}),sx:{m:0,width:"100%",".MuiFormControlLabel-label":{overflow:"hidden",textOverflow:"ellipsis"}}})}),e.jsx(ht,{sx:{my:.5}}),e.jsx(_t,{dense:!0,disablePadding:!0,children:d.sheets.map(p=>{const S=`${d.fileName}::${p.sheetName}`,z=s.includes(S);return e.jsxs(rn,{disablePadding:!0,onClick:()=>l(S),sx:{cursor:"pointer",backgroundColor:z?"action.selected":"transparent","&:hover":{backgroundColor:z?"action.selected":"action.hover"}},children:[e.jsx(Ve,{edge:"start",checked:z,tabIndex:-1,disableRipple:!0}),e.jsx(C,{variant:"body2",onClick:$=>{$.stopPropagation(),h(p.sheetName)},sx:{cursor:"pointer","&:hover":{textDecoration:"underline"},flexGrow:1,ml:1},children:p.sheetName})]},S)})})]},d.fileName)})}),e.jsxs(b,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(ne,{variant:"text",onClick:a,children:r("sheetSelector.cancel")}),e.jsx(ne,{variant:"contained",onClick:f,disabled:s.length===0,children:r("sheetSelector.merge",{count:s.length})})]})]})};function Na({progress:t}){const{t:n}=Ce(),{total:a,completed:r,stage:s,errors:o}=t,l=a>0?r/a*100:0,c=o.length>0,h=()=>{switch(s){case"reading":return n("progress.reading");case"parsing":return n("progress.parsing");default:return n("progress.processing")}};return e.jsxs(ge,{elevation:2,sx:{p:3,mt:4,width:"100%",maxWidth:600,display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(C,{variant:"h6",component:"div",children:h()}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[c?e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:.5,color:"error.main"},children:[e.jsx(ts,{fontSize:"small"}),e.jsx(C,{variant:"body2",color:"error",children:n("progress.error",{count:o.length})})]}):null,r===a&&a>0&&!c&&e.jsx(ns,{color:"success",fontSize:"small"})]})]}),e.jsx(rs,{variant:"determinate",value:l,sx:{height:10,borderRadius:5,backgroundColor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:5}}}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(C,{variant:"body2",color:"text.secondary",children:n("progress.processed",{completed:r,total:a,plural:a===1?"":"s"})}),e.jsxs(C,{variant:"body2",color:"text.secondary",fontWeight:"medium",children:[Math.round(l),"%"]})]}),c&&e.jsx(Ct,{severity:"warning",sx:{mt:1},children:e.jsx(C,{variant:"body2",children:n("progress.failed",{count:o.length})})})]})}const jr="excel-processor-name-merges";function za(){return`merge_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function Ea(){try{const t=localStorage.getItem(jr);if(t){const n=JSON.parse(t);return{mergeGroups:n.mergeGroups||[],nameToGroupId:n.nameToGroupId||{}}}}catch(t){console.warn("Could not load name merge state from localStorage:",t)}return{mergeGroups:[],nameToGroupId:{}}}function Et(t){try{localStorage.setItem(jr,JSON.stringify(t))}catch(n){console.warn("Could not save name merge state to localStorage:",n)}}function Ma(t,n,a){return!n||a.mergeGroups.length===0?t:t.map(r=>{const s=r[n];if(s==null)return r;const o=String(s),l=a.nameToGroupId[o];if(l){const c=a.mergeGroups.find(h=>h.id===l);if(c&&c.active)return{...r,[n]:c.displayName,_originalName:o,_mergedDisplayName:c.displayName}}return r})}function Ta(t,n){const a=t.mergeGroups.findIndex(l=>l.id===n);if(a===-1)return console.warn(`Merge group ${n} not found`),t;const r=[...t.mergeGroups],s=r[a];r[a]={...s,active:!s.active};const o={...t,mergeGroups:r};return Et(o),o}function Aa(t,n,a){if(n.length<2)return console.warn("Need at least 2 names to create a merge group"),t;const r=n.find(c=>t.nameToGroupId[c]);if(r)return console.warn(`Name "${r}" is already in a merge group`),t;const s={id:za(),displayName:a,originalNames:n,createdAt:Date.now(),active:!0},o={...t.nameToGroupId};n.forEach(c=>{o[c]=s.id});const l={mergeGroups:[...t.mergeGroups,s],nameToGroupId:o};return Et(l),l}function Ia(t,n){const a=t.mergeGroups.find(o=>o.id===n);if(!a)return console.warn(`Merge group ${n} not found`),t;const r={...t.nameToGroupId};a.originalNames.forEach(o=>{delete r[o]});const s={mergeGroups:t.mergeGroups.filter(o=>o.id!==n),nameToGroupId:r};return Et(s),s}function Ra(t,n,a){const r=t.mergeGroups.findIndex(l=>l.id===n);if(r===-1)return console.warn(`Merge group ${n} not found`),t;const s=[...t.mergeGroups];s[r]={...s[r],displayName:a};const o={...t,mergeGroups:s};return Et(o),o}function Pa(t,n){const a=t.mergeGroups.map(s=>({...s,active:n})),r={...t,mergeGroups:a};return Et(r),r}function Wa(){const t={mergeGroups:[],nameToGroupId:{}};return Et(t),t}const La=({availableNames:t,mergeState:n,onMergeStateChange:a})=>{const{t:r}=Ce(),[s,o]=u.useState(""),[l,c]=u.useState([]),[h,f]=u.useState(!1),[d,y]=u.useState(!1),[x,g]=u.useState(null),[p,S]=u.useState(""),[z,$]=u.useState(new Set),[F,D]=u.useState(!1),[k,T]=u.useState(()=>{try{const v=localStorage.getItem("excel-processor-name-merge-collapsed");return v===null?!0:v==="true"}catch{return!0}});Ie.useEffect(()=>{try{localStorage.setItem("excel-processor-name-merge-collapsed",String(k))}catch{}},[k]);const V=u.useMemo(()=>{if(!s)return t;const v=s.toLowerCase();return t.filter(P=>P.toLowerCase().includes(v))},[t,s]),L=u.useCallback(v=>{const P=n.nameToGroupId[v];if(P){const H=n.mergeGroups.find(te=>te.id===P);if(H&&H.active)return H}return null},[n]),U=v=>{c(P=>P.includes(v)?P.filter(H=>H!==v):[...P,v])},J=()=>{const v=V.filter(H=>!L(H)),P=new Set([...l,...v]);c(Array.from(P))},q=()=>{c([])},re=()=>{l.length<2||(S(`${l[0]} Family`),f(!0))},ae=()=>{if(l.length<2||!p.trim())return;const v=Aa(n,l,p.trim());a(v),c([]),S(""),f(!1)},xe=v=>{const P=Ia(n,v);a(P)},he=v=>{g(v),S(v.displayName),y(!0)},Z=()=>{if(!x||!p.trim())return;const v=Ra(n,x.id,p.trim());a(v),g(null),S(""),y(!1)},ie=v=>{const P=Ta(n,v);a(P)},le=v=>{const P=Pa(n,v.target.checked);a(P)},de=u.useMemo(()=>n.mergeGroups.every(v=>v.active),[n.mergeGroups]),_=v=>{$(P=>{const H=new Set(P);return H.has(v)?H.delete(v):H.add(v),H})},A=()=>{if(n.mergeGroups.length===0)return;const v=Wa();a(v),D(!1)},I=u.useMemo(()=>Object.keys(n.nameToGroupId).length,[n.nameToGroupId]),E=u.useMemo(()=>V.filter(v=>!L(v)),[V,L]);return e.jsxs(ge,{sx:{p:2},children:[e.jsx(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Y,{size:"small",onClick:()=>T(!k),sx:{mr:.5},"aria-label":k?"Expand":"Collapse",children:k?e.jsx(on,{}):e.jsx(an,{})}),e.jsx(ss,{color:"primary"}),e.jsx(C,{variant:"h6",children:r("nameMerging.title")}),e.jsx(C,{variant:"caption",color:"text.secondary",sx:{ml:1},children:r("nameMerging.optional")}),n.mergeGroups.length>0&&e.jsx(He,{size:"small",label:r("nameMerging.groups",{count:n.mergeGroups.length}),color:"primary",variant:"outlined",sx:{ml:1}})]})}),!k&&e.jsx(Ct,{severity:"info",sx:{mb:2},children:r("nameMerging.description")}),!k&&n.mergeGroups.length>0&&e.jsx(Ct,{severity:"info",sx:{mb:2},children:r("nameMerging.summary",{count:I,groupCount:n.mergeGroups.length})}),e.jsxs(ln,{in:!k,timeout:"auto",unmountOnExit:!0,children:[e.jsxs(b,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(et,{size:"small",placeholder:r("nameMerging.searchPlaceholder"),value:s,onChange:v=>o(v.target.value),fullWidth:!0}),e.jsx(ne,{variant:"contained",startIcon:e.jsx(It,{}),onClick:re,disabled:l.length<2,children:r("nameMerging.merge",{count:l.length})})]}),V.length>0&&e.jsxs(b,{sx:{display:"flex",gap:1,mb:1},children:[e.jsx(ne,{size:"small",onClick:J,disabled:E.length===0,children:r("nameMerging.addAllUnmerged")}),e.jsx(ne,{size:"small",onClick:q,disabled:l.length===0,children:r("nameMerging.clearSelection")})]}),e.jsx(C,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:r("nameMerging.availableNames",{count:V.length})}),e.jsx(_t,{dense:!0,sx:{maxHeight:200,overflow:"auto",border:1,borderColor:"divider",borderRadius:1},children:V.length===0?e.jsx(rn,{children:e.jsx(Rt,{secondary:r(s?"nameMerging.noMatch":"nameMerging.noNames")})}):V.map(v=>{const P=L(v),H=l.includes(v);return e.jsxs(Cn,{dense:!0,selected:H,onClick:()=>!P&&U(v),disabled:!!P,children:[e.jsx(Dn,{sx:{minWidth:36},children:e.jsx(Ve,{edge:"start",checked:H,disabled:!!P,size:"small"})}),e.jsx(Rt,{primary:v,secondary:P?r("nameMerging.mergedAs",{displayName:P.displayName}):void 0,secondaryTypographyProps:{color:"primary",variant:"caption"}})]},v)})}),n.mergeGroups.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ht,{sx:{my:2}}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(C,{variant:"subtitle2",color:"text.secondary",children:r("nameMerging.mergeGroups")}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.mergeGroups.length>0&&e.jsx(Be,{title:r(de?"nameMerging.deactivateAll":"nameMerging.activateAll"),children:e.jsx(Vt,{edge:"end",size:"small",checked:de,onChange:le,inputProps:{"aria-label":"toggle all merge groups"}})}),e.jsx(Be,{title:r("nameMerging.clearAll"),children:e.jsx(ne,{size:"small",color:"error",startIcon:e.jsx(sn,{}),onClick:()=>D(!0),children:r("nameMerging.clearAll")})})]})]}),e.jsx(_t,{dense:!0,children:n.mergeGroups.map(v=>e.jsxs(b,{sx:{opacity:v.active?1:.5},children:[e.jsx(rn,{secondaryAction:e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Be,{title:v.active?r("nameMerging.deactivate"):r("nameMerging.activate"),children:e.jsx(Vt,{edge:"end",size:"small",checked:v.active,onChange:()=>ie(v.id),inputProps:{"aria-label":"toggle merge group"}})}),e.jsx(Be,{title:r("nameMerging.edit"),children:e.jsx(Y,{edge:"end",size:"small",onClick:()=>he(v),children:e.jsx(as,{fontSize:"small"})})}),e.jsx(Be,{title:r("nameMerging.split"),children:e.jsx(Y,{edge:"end",size:"small",onClick:()=>xe(v.id),color:"error",children:e.jsx(Hn,{fontSize:"small"})})})]}),children:e.jsxs(Cn,{onClick:()=>_(v.id),children:[e.jsx(Dn,{sx:{minWidth:36},children:z.has(v.id)?e.jsx(an,{fontSize:"small"}):e.jsx(on,{fontSize:"small"})}),e.jsx(Rt,{primary:v.displayName,secondary:r("nameMerging.namesCount",{count:v.originalNames.length})})]})}),e.jsx(ln,{in:z.has(v.id),children:e.jsx(_t,{dense:!0,sx:{pl:4},children:v.originalNames.map(P=>e.jsx(rn,{dense:!0,children:e.jsx(Rt,{primary:P,primaryTypographyProps:{variant:"body2",color:"text.secondary"}})},P))})})]},v.id))})]}),e.jsxs(ct,{open:h,onClose:()=>f(!1),children:[e.jsx(dt,{children:r("nameMerging.createGroup")}),e.jsxs(vt,{children:[e.jsx(C,{variant:"body2",color:"text.secondary",sx:{mb:2},children:r("nameMerging.mergeDescription",{count:l.length})}),e.jsx(et,{autoFocus:!0,label:r("nameMerging.displayName"),fullWidth:!0,value:p,onChange:v=>S(v.target.value),sx:{mb:2}}),e.jsxs(C,{variant:"caption",color:"text.secondary",children:[r("nameMerging.namesToMerge"),":"]}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:l.map(v=>e.jsx(He,{label:v,size:"small"},v))})]}),e.jsxs(Lt,{children:[e.jsx(ne,{onClick:()=>f(!1),children:r("nameMerging.cancel")}),e.jsx(ne,{onClick:ae,variant:"contained",disabled:!p.trim(),children:r("nameMerging.createMerge")})]})]}),e.jsxs(ct,{open:d,onClose:()=>y(!1),children:[e.jsx(dt,{children:r("nameMerging.editDisplayName")}),e.jsx(vt,{children:e.jsx(et,{autoFocus:!0,label:r("nameMerging.displayName"),fullWidth:!0,value:p,onChange:v=>S(v.target.value),sx:{mt:1}})}),e.jsxs(Lt,{children:[e.jsx(ne,{onClick:()=>y(!1),children:r("nameMerging.cancel")}),e.jsx(ne,{onClick:Z,variant:"contained",disabled:!p.trim(),children:r("nameMerging.save")})]})]}),e.jsxs(ct,{open:F,onClose:()=>D(!1),children:[e.jsx(dt,{children:r("nameMerging.confirmClearAll")}),e.jsx(vt,{children:e.jsx(os,{children:r("nameMerging.confirmClearAllMessage")})}),e.jsxs(Lt,{children:[e.jsx(ne,{onClick:()=>D(!1),children:r("nameMerging.cancel")}),e.jsx(ne,{onClick:A,color:"error",variant:"contained",children:r("nameMerging.clearAll")})]})]})]})]})},_a=()=>{const{t,i18n:n}=Ce(),a=()=>{const l=n.language==="en"?"ko":"en";n.changeLanguage(l),localStorage.setItem("excel-processor-language",l)},s=n.language==="en"?"ko":"en";return e.jsx(b,{sx:{minWidth:80},children:e.jsxs(ne,{variant:"outlined",size:"small",onClick:a,sx:{minWidth:100,textTransform:"none",fontWeight:500},children:[e.jsx(C,{component:"span",sx:{mr:.5,fontFamily:"monospace",fontWeight:700,fontSize:"0.75rem",bgcolor:"action.hover",px:.75,py:.25,borderRadius:.5},children:s==="en"?"EN":"KO"}),t(s==="en"?"language.english":"language.korean")]})})},$a=t=>{switch(t){case"ready":return 0;case"parsing":return 1;case"files_uploaded":return 1;case"data_merged":return 2;default:return 0}},Ba=["Upload Files","Select Sheets","Process Data"];function Va({currentStep:t,sx:n}){const a=$a(t);return e.jsx(b,{sx:{width:"100%",mb:4,...n},children:e.jsx(is,{activeStep:a,alternativeLabel:!0,children:Ba.map(r=>e.jsx(ls,{children:e.jsx(cs,{children:r})},r))})})}function Oa({children:t,maxWidth:n="lg",sx:a}){return e.jsx(ds,{component:"main",maxWidth:n,sx:{minHeight:"100vh",py:4,display:"flex",flexDirection:"column",...a},children:t})}function At({children:t,sx:n,elevation:a=2,variant:r="elevation",...s}){return e.jsx(ge,{elevation:a,variant:r,sx:{p:3,borderRadius:2,transition:"box-shadow 0.3s ease-in-out","&:hover":a>0?{boxShadow:o=>o.shadows[a+2]}:{},...n},...s,children:t})}async function Ha(t,n,a={}){const{concurrency:r=3,onProgress:s}=a,o=[],l=[];for(let c=0;c<t.length;c+=r){const f=t.slice(c,c+r).map(async x=>{try{return{success:!0,data:await n(x),item:null}}catch(g){return{success:!1,error:g,item:x}}}),d=await Promise.all(f);for(const x of d)x.success?o.push(x.data):l.push({item:x.item,error:x.error});const y=Math.min(c+r,t.length);s?.(y,t.length),await new Promise(x=>setTimeout(x,0))}return l.length>0&&console.warn(`Completed with ${l.length} errors:`,l),o}const Ua="1.9.0";function Ga(){const{t}=Ce(),[n,a]=u.useState("ready"),[r,s]=u.useState([]),[o,l]=u.useState([]),[c,h]=u.useState({total:0,completed:0,stage:"reading",errors:[]}),[f,d]=u.useState(null),[y,x]=u.useState(1),[g,p]=u.useState([]),[S,z]=u.useState(!1),[$,F]=u.useState(()=>{try{const A=localStorage.getItem("excel-processor-column-visibility");return A?JSON.parse(A):{}}catch{return{}}}),[D,k]=u.useState(()=>Ea()),T=u.useMemo(()=>{const A=new Set;return g.forEach(I=>{A.add(I);const E=D.nameToGroupId[I];if(E){const v=D.mergeGroups.find(P=>P.id===E);v&&v.active&&A.add(v.displayName)}}),Array.from(A)},[g,D]),V=u.useMemo(()=>o.length===0?[]:Ma(o,f,D),[o,f,D]),L=A=>{F(I=>{const E=typeof A=="function"?A(I):A;try{localStorage.setItem("excel-processor-column-visibility",JSON.stringify(E))}catch(v){dn("ColumnVisibility","Could not save to localStorage:",v)}return E})},U=async A=>{a("parsing");const I=Array.from(A);h({total:I.length,completed:0,stage:"reading",errors:[]});try{const E=await Ha(I,async v=>{const P=await v.arrayBuffer(),H=v.name.toLowerCase().endsWith(".csv"),te=ms(P,{type:"array"}),ee=te.SheetNames.map(Q=>({sheetName:Q,data:nn.sheet_to_json(te.Sheets[Q],{header:"A",defval:"",blankrows:!1})}));return{fileName:v.name,sheets:ee.map(Q=>({...Q,data:Q.data})),isCSV:H}},{concurrency:3,onProgress:v=>{h(P=>({...P,completed:v,stage:"parsing"}))}});if(E.length===1&&E[0].sheets.length===1){const v=E[0],P=`${v.fileName}::${v.sheets[0].sheetName}`;s(E),J([P],E)}else s(E),a("files_uploaded")}catch(E){console.error("Error parsing files:",E),a("ready")}},J=(A,I)=>{me("SheetSelector","Merging sheets:",A);const E=I||r,v=[];A.forEach(te=>{const[ee,Q]=te.split("::"),be=E.find(O=>O.fileName===ee)?.sheets.find(O=>O.sheetName===Q);if(be?.data){const O=be.data.map(X=>({...X,_sourceFileName:ee,_sourceSheetName:Q}));v.push(O)}});const P=new Set;P.add("_sourceFileName"),P.add("_sourceSheetName"),v.flat().forEach(te=>{Object.keys(te).forEach(ee=>P.add(ee))});const H=v.flat().map(te=>{const ee={};return P.forEach(Q=>{ee[Q]=te[Q]!==void 0?te[Q]:null}),ee});l(H),me("Merge","Merged data created. Total rows:",H.length),H.length>0&&(me("Merge","Sample row:",H[0]),me("Merge","All columns:",Object.keys(H[0]))),a("data_merged")},q=()=>{s([]),a("ready")},re=u.useCallback((A,I)=>{d(A),x(I),p([]),me("ColumnSelector","Selected Name Column:",A,"from row",I)},[]),ae=u.useCallback(A=>{p(A),me("NameSelector","Selected Base Names:",A)},[]),xe=u.useCallback(()=>{z(A=>!A)},[]),he=u.useMemo(()=>{if(!f||o.length===0||!(E=>/^[A-Z]+$/.test(E)||/^__EMPTY/.test(E))(f))return f;const I=y-1;if(I>=0&&I<o.length){const v=o[I][f];if(v!=null&&v!=="")return String(v)}return f},[o,f,y]),Z=(A,I,E)=>{if(E&&E in A)return A[E];if(I)return A[I]},ie=u.useMemo(()=>{if(!f||T.length===0||V.length===0)return[];const A=y-1;return V.filter((I,E)=>E!==A).filter(I=>{const E=Z(I,f,he),v=I._originalName,P=I._mergedDisplayName,H=P&&D.mergeGroups.some(te=>te.active&&te.displayName===P?te.originalNames.some(ee=>T.includes(ee))||T.includes(te.displayName):!1);return T.includes(E)||v&&T.includes(v)||P&&T.includes(P)||H})},[V,f,y,T,he,D]),le=u.useMemo(()=>{if(!f||o.length===0)return[];const A=y-1,I=new Set;return o.filter((E,v)=>v!==A).forEach(E=>{const v=E[f];v!=null&&v!==""&&I.add(String(v))}),Array.from(I).sort()},[o,f,y]),de=u.useMemo(()=>{if(o.length===0)return{};const A=y-1,I=o[0],E=Object.keys(I).filter(te=>!te.startsWith("_")),v=te=>/^[A-Z]+$/.test(te)||/^__EMPTY/.test(te),P=E.length>0&&E.every(v),H={};if(!P)return Object.keys(I).forEach(te=>{H[te]=te}),H;if(A>=0&&A<o.length){const te=o[A];return Object.keys(te).forEach(ee=>{const Q=te[ee];Q!=null&&Q!==""?H[ee]=String(Q):H[ee]=ee}),H}return H},[o,y]),_=e.jsx(Da,{data:o,filteredData:ie,nameColumn:f,headerRowIndex:y,selectedUniqueNames:T,onToggleFullScreen:xe,isFullScreen:S,columnVisibility:$,setColumnVisibility:L,columnMapping:de});return e.jsxs(Oa,{maxWidth:"lg",children:[e.jsx(us,{}),e.jsxs(b,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:4},children:[e.jsx(C,{component:"h1",variant:"h3",gutterBottom:!0,fontWeight:"bold",children:t("app.title")}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsxs(C,{variant:"body2",color:"text.secondary",children:[t("app.version")," ",Ua," • ",t("app.lastUpdated"),": ","19.02.2026"]}),e.jsx(_a,{})]})]}),e.jsx(Va,{currentStep:n}),e.jsx(At,{children:e.jsx(js,{onFilesUpload:U,disabled:n==="parsing"})}),n==="parsing"&&e.jsxs(e.Fragment,{children:[e.jsx(Na,{progress:c}),e.jsx(hs,{sx:{mt:2}})]}),n==="files_uploaded"&&e.jsx(At,{sx:{mt:3},children:e.jsx(Fa,{files:r,onMerge:J,onCancel:q})}),n==="data_merged"&&o.length>0&&e.jsxs(b,{sx:{mt:3,width:"100%"},children:[e.jsxs(At,{sx:{mb:3},children:[e.jsx(C,{variant:"h5",gutterBottom:!0,children:t("mergedData.title")}),e.jsx(C,{variant:"body1",color:"text.secondary",sx:{mb:3},children:t("mergedData.rowsCombined",{count:o.length})}),e.jsx(Ss,{data:o,onColumnSelect:re})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx(At,{sx:{mb:3},children:e.jsx(Ds,{data:o,nameColumn:f,headerRowIndex:y,selectedNames:T,onNamesSelect:ae})}),e.jsx(At,{sx:{mb:3},children:e.jsx(La,{availableNames:le,mergeState:D,onMergeStateChange:k})})]}),T.length>0&&f&&!S&&_]}),e.jsxs(ct,{fullScreen:!0,open:S,onClose:xe,children:[e.jsxs(dt,{sx:{m:0,p:2},children:[t("detailedView.fullScreen"),e.jsx(Y,{"aria-label":t("detailedView.close"),onClick:xe,sx:{position:"absolute",right:8,top:8,color:A=>A.palette.grey[500]},children:e.jsx(er,{})})]}),e.jsx(b,{sx:{p:2,flexGrow:1,overflow:"auto"},children:_})]})]})}const Ka={title:"Excel Data Processor",version:"Version",lastUpdated:"Last updated"},Ya={title:"Upload Excel/CSV File(s)",button:"Upload File(s)",changeButton:"Change Files ({{count}} selected)",selected:"Selected",dragDrop:"Drag & drop Excel files here",dropFiles:"Drop files here",orClick:"or click to browse",supportedFormats:"Supports .xlsx, .xls, .csv files",selectedFiles:"Selected Files ({{count}})"},qa={reading:"Reading files...",parsing:"Parsing files...",processing:"Processing...",processed:"Processed {{completed}} of {{total}} file{{plural}}",error:"{{count}} error{{plural}}",failed:"{{count}} file{{plural}} failed to load. Will continue with remaining files."},Za={title:"Select Sheets to Merge",description:"Select one or more sheets from the uploaded files to combine into a single dataset. Clicking a sheet name will select all sheets with that name across all files.",cancel:"Cancel",merge:"Merge {{count}} Sheets"},Ja={title:"Select Column for Names",subtitle:"Showing values from first 3 rows to identify header row",label:"Select Name Column",row:"Row {{number}}"},Xa={title:"Unique Names",found:'Found {{count}} unique values in "{{column}}"',searchPlaceholder:"Search names...",selected:"selected",matchSearch:"({{count}} match search)",clearAll:"Clear all",searchResults:'{{count}} result{{plural}} for "{{term}}"',select:"Name",selectAll:"Select all",deselectAll:"Deselect all",rowsPerPage:"Rows per page"},Qa={title:"Name Merging",optional:"(optional)",groups:"{{count}} group{{plural}}",description:"Group similar donor names into a single display name. This affects statistics and dashboards only.",summary:"{{count}} name{{plural}} merged into {{groupCount}} group{{plural}}. Merged names will be treated as a single entity in statistics.",searchPlaceholder:"Search names...",merge:"Merge ({{count}})",addAllUnmerged:"Add All Unmerged",clearSelection:"Clear Selection",availableNames:"Available Names ({{count}})",noNames:"No names available",noMatch:"No names match your search",mergedAs:"Merged as: {{displayName}}",mergeGroups:"Merge Groups",activateAll:"Activate All",deactivateAll:"Deactivate All",clearAll:"Clear All",activate:"Activate",deactivate:"Deactivate",edit:"Edit display name",split:"Split (undo merge)",namesCount:"{{count}} name{{plural}}",createGroup:"Create Merge Group",mergeDescription:"Merging {{count}} names into a single entity.",displayName:"Display Name",namesToMerge:"Names to merge",cancel:"Cancel",createMerge:"Create Merge",editDisplayName:"Edit Display Name",save:"Save",confirmClearAll:"Confirm Clear All",confirmClearAllMessage:"Are you sure you want to permanently delete all merge groups? This action cannot be undone."},eo={title:"Detailed Data View",fullScreen:"Detailed Data View (Full Screen)",close:"close",detailsFor:"Details for:",rows:"rows",andMore:"and {{count}} more",searchAllColumns:"Search all columns...",rowsSelected:"of {{total}} rows selected",autoDeselectZeros:"Auto-deselect empty/zero-value rows",autoDeselectTooltip:"Only checks currently visible data columns",hideDeselected:"Hide deselected",hideDeselectedTooltip:"Temporarily hide deselected rows; selection still applies to exports",selectRowsTooltip:"Select all currently visible rows (after search/filters)",deselectRowsTooltip:"Deselect all currently visible rows (after search/filters)",exportCsvTooltip:"Exports included rows and currently visible columns",exportCsv:"Export as CSV ({{count}})",pdfTooltip:"Generates PDF using included rows and visible columns",pdf:"EXPORT PDF",columnFiltersActive:"Column filters active",clearAllFilters:"Clear all filters",filterActive:"Filter active",filterColumn:"Filter column",filterBy:"Filter by {{column}}",filter:"Filter",searchValues:"Search values...",reset:"Reset",valuesSelected:"{{selected}} of {{total}} values selected",selectAll:"Select All",deselectAll:"Deselect All",selectAllColumns:"Select All",unselectAllColumns:"Unselect All",total:"Total",fromFilename:"From filename",fromSheet:"From sheet",selectAllRowsAria:"select all visible rows",dashboard:"Dashboard ({{count}})",dashboardTitle:"Dashboard",dashboardFailed:"Dashboard failed to render"},to={title:"Export as PDF",rowsSelected:"{{count}} rows selected for export",cancel:"Cancel",generating:"Generating...",next:"Next",exportPdf:"EXPORT PDF",failed:"Failed to generate PDF. Please try again.",resetDefaults:"Reset to template defaults",customFields:{title:"PDF Export - Custom Fields",donorName:"Donor Name",address:"Address",amountColumn:"Amount Column",amountColumnHint:"Select the column containing donation amounts",monthlyAmounts:"Monthly Amounts (EUR)",totalAmount:"Total Amount (EUR)",amountInWords:"Amount in Words",period:"Period",taxExemption:"Not a Membership Fee",taxExemptionHint:"I confirm this is a donation and not a membership fee",taxExemptionType:"Tax Exemption Type",waiverReimbursementYes:"Waiver of Expenditure Reimbursement (Yes)",waiverReimbursementNo:"Waiver of Expenditure Reimbursement (No)",waiverReimbursementYesHint:"I waive my right to reimbursement of expenses",waiverReimbursementNoHint:"I do not waive reimbursement rights",taxExemptionNotice:"Tax Exemption According to Exemption Notice",taxExemptionNoticeHint:"Tax office approved tax exemption notice according to § 10 Abs. 1 Nr. 3 EStG (German Income Tax Act)",preliminaryCertificate:"Preliminary Certificate (Standard)",preliminaryCertificateHint:"Temporary tax certificate for donations",taxNumber:"Tax Number",taxDate:"Exemption Notice Date",taxDateHint:"Date when the tax office issued the exemption notice",validFrom:"Valid From",location:"Location",date:"Date",signature:"Signature",summary:"Summary"},colors:{red:"Red",black:"Black",blue:"Blue",green:"Green",darkBlue:"Dark Blue",brown:"Brown",purple:"Purple",gray:"Gray"}},no={title:"Merged Data",rowsCombined:"{{count}} rows combined."},ro={title:"Language",english:"English",korean:"한국어"},so={title:"Data Dashboard",noDataAvailable:"No data available for dashboard",loading:"Loading dashboard...",showingRows:"Showing {{count}} rows",fromTo:"from {{start}} to {{end}}",dateColumn:"Date Column",none:"None",notDate:"Not date",anonymizeNames:"Anonymize names",configureCharts:"Configure Dashboard Charts",useFilenameDates:"Use filename dates (YYYYMMDD)",dataSeries:"Data Series (drag to reorder • click to toggle • X to hide)",noNumericColumns:"No numeric columns detected. Make sure your data contains numeric values.",rowHeight:"Row height",resetLayout:"Reset Layout",px:"{{value}}px",trendOverTime:"Trend Over Time",trendAnalysis:"Trend Analysis",topContributors:"Top Contributors",donors:"{{count}} donors",showFewer:"Show fewer",showMore:"Show more",descriptiveStatistics:"Descriptive Statistics",distributionHistogram:"Distribution Histogram",paretoAnalysis:"Pareto Analysis (80/20 Rule)",rangeDistribution:"Range Distribution",period:"Period",weekly:"Weekly",monthly:"Monthly",quarterly:"Quarterly",yearly:"Yearly",lineChart:"Line Chart",areaChart:"Area Chart",stackedArea:"Stacked Area",downloadAsPng:"Download as PNG",downloadAsJpg:"Download as JPG",taller:"Taller (increase height)",shorter:"Shorter (decrease height)",fewerBins:"Fewer bins",moreBins:"More bins",zoomOut:"Zoom out",zoomIn:"Zoom in",panLeft:"Pan left",panRight:"Pan right",reset:"Reset",zoomed:"Zoomed: {{min}} - {{max}}",selectColumns:"Select value columns above to see trend analysis.",enableFilenameDates:'Enable "Use filename dates" or select a date column above.',noTrendData:"No trend data available for the selected columns.",all:"All {{count}}",bins:"{{count}} bins"},ao={loadingData:"Loading chart data...",errorLoading:"Error loading chart: {{message}}",noDataAvailable:"No data available",noDataForPeriod:"No data available for the selected period",noDataForRange:"No data available for range distribution",noDataForPareto:"No data available for Pareto analysis",noDataForHistogram:"No data available for histogram",anonymized:"(Anonymized #{{index}})",value:"Value",count:"Count",percentage:"Percentage",byDonorCount:"By Donor Count",byTotalValue:"By Total {{value}}",totalDonors:"Total: {{count}} donors",rangeDistributionSummary:"Range Distribution Summary",donors:"Donors",amount:"Amount",showPercentiles:"Show Percentiles",hidePercentiles:"Hide Percentiles",column:"Column",sum:"Sum",avg:"Avg",min:"Min",max:"Max",median:"Median",stdDev:"Std Dev",nonNullCount:"Count",percentile25:"25th",percentile75:"75th",percentile90:"90th",percentile95:"95th",cumulativePercent:"Cumulative %",percent80Threshold:"80% threshold",contributors80:"{{count}} contributor{{plural}} account for ~80% of total value",mean:"Mean",medianLabel:"Median"},oo={app:Ka,uploader:Ya,progress:qa,sheetSelector:Za,columnSelector:Ja,uniqueNames:Xa,nameMerging:Qa,detailedView:eo,pdfExport:to,mergedData:no,language:ro,dashboard:so,charts:ao},io={title:"엑셀 데이터 병합 및 대시보드",version:"버전",lastUpdated:"마지막 업데이트"},lo={title:"엑셀/CSV 파일 업로드",button:"파일 업로드",changeButton:"파일 변경 ({{count}}개 선택됨)",selected:"선택됨",dragDrop:"엑셀 파일을 여기로 드래그 앤 드롭하거나 클릭하여 선택하세요. 여러 파일을 한 번에 업로드할 수 있습니다.",dropFiles:"파일을 여기에 드롭하세요",orClick:"또는 클릭하여 찾아보기",supportedFormats:".xlsx, .xls, .csv 파일 지원",selectedFiles:"선택된 파일 ({{count}}개)"},co={reading:"파일 읽는 중...",parsing:"파일 분석 중...",processing:"처리 중...",processed:"{{completed}}/{{total}}개 파일 처리됨",error:"{{count}}개 오류",failed:"{{count}}개 파일을 불러오지 못했습니다. 나머지 파일로 계산합니다."},uo={title:"병합할 시트 선택",description:"업로드된 파일에서 하나 이상의 시트를 선택하여 단일 데이터 세트로 결합합니다. 시트 이름을 클릭하면 모든 파일에서 동일한 이름의 시트가 선택됩니다.",cancel:"취소",merge:"{{count}}개 시트 병합"},ho={title:"이름 데이터가 포함된 열을 선택하세요",subtitle:"헤더 행을 식별하기 위해 처음 3개 행의 값들을 표시합니다. 이름이 포함된 열을 선택하면 나머지 열이 데이터 열로 간주됩니다.",label:"이름 열 선택",row:"{{number}}행"},mo={title:"고유 이름 찾기",found:'"{{column}}"에서 {{count}}개의 고유한 값을 찾았습니다',searchPlaceholder:"이름 검색...",selected:"선택됨",matchSearch:"({{count}}개 일치)",clearAll:"모두 지우기",searchResults:'"{{term}}" 검색 결과 {{count}}개',select:"이름",selectAll:"모두 선택",deselectAll:"모두 선택 해제",rowsPerPage:"페이지당 행 수"},go={title:"이름 병합",optional:"(선택 사항)",groups:"{{count}}개 그룹",description:"비슷한 기부자 이름을 하나의 표시 이름으로 그룹화합니다. 이는 통계 및 대시보드에만 영향을 미칩니다.",summary:"{{count}}개 이름이 {{groupCount}}개 그룹으로 병합되었습니다. 병합된 이름은 통계에서 단일 엔터티로 처리됩니다.",searchPlaceholder:"이름 검색...",merge:"병합 ({{count}})",addAllUnmerged:"병합되지 않은 모두 추가",clearSelection:"선택 지우기",availableNames:"사용 가능한 이름 ({{count}})",noNames:"사용 가능한 이름 없음",noMatch:"검색과 일치하는 이름 없음",mergedAs:"병합됨: {{displayName}}",mergeGroups:"병합 그룹",activateAll:"모두 활성화",deactivateAll:"모두 비활성화",clearAll:"모두 지우기",activate:"활성화",deactivate:"비활성화",edit:"표시 이름 편집",split:"분할 (병합 취소)",namesCount:"{{count}}개 이름",createGroup:"병합 그룹 만들기",mergeDescription:"{{count}}개 이름을 단일 엔터티로 병합합니다.",displayName:"표시 이름",namesToMerge:"병합할 이름",cancel:"취소",createMerge:"병합 만들기",editDisplayName:"표시 이름 편집",save:"저장",confirmClearAll:"모두 지우기 확인",confirmClearAllMessage:"정말로 모든 병합 그룹을 영구적으로 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."},xo={title:"상세 데이터 보기",fullScreen:"상세 데이터 보기 (전체 화면)",close:"닫기",detailsFor:"상세 정보:",rows:"개 행",andMore:"외 {{count}}개 더보기",searchAllColumns:"모든 열 검색...",rowsSelected:"{{total}}개 행 중 선택됨",autoDeselectZeros:"비었거나 값이 0인 행 자동으로 선택 해제",autoDeselectTooltip:"현재 표시된 데이터 열만 확인합니다",hideDeselected:"선택 해제된 행 숨기기",hideDeselectedTooltip:"선택 해제된 행을 일시적으로 숨깁니다. 내보내기에는 선택 사항이 적용됩니다",selectRowsTooltip:"현재 표시된 모든 행 선택 (검색/필터 후)",deselectRowsTooltip:"현재 표시된 모든 행 선택 해제 (검색/필터 후)",exportCsvTooltip:"선택된 행과 현재 표시된 열을 내보냅니다",exportCsv:"CSV로 내보내기 ({{count}})",pdfTooltip:"선택된 행과 표시된 열로 PDF를 생성합니다",pdf:"PDF 출력",columnFiltersActive:"열 필터 활성화됨",clearAllFilters:"모든 필터 지우기",filterActive:"필터 활성화됨",filterColumn:"열 필터",filterBy:"{{column}}(으)로 필터",filter:"필터",searchValues:"값 검색...",reset:"초기화",valuesSelected:"{{total}}개 중 {{selected}}개 값 선택됨",selectAll:"모두 선택",deselectAll:"모두 선택 해제",selectAllColumns:"모든 열 선택",unselectAllColumns:"모든 열 선택 해제",total:"합계",fromFilename:"파일 이름에서",fromSheet:"시트에서",selectAllRowsAria:"표시된 모든 행 선택",dashboard:"대시보드 ({{count}})",dashboardTitle:"대시보드",dashboardFailed:"대시보드를 렌더링하지 못했습니다"},po={title:"PDF로 내보내기",rowsSelected:"{{count}}개 행이 내보내기에 선택됨",cancel:"취소",generating:"생성 중...",next:"다음",exportPdf:"PDF 출력",failed:"PDF 생성에 실패했습니다. 다시 시도해 주세요.",resetDefaults:"템플릿 기본값으로 초기화",customFields:{title:"PDF 내보내기 - 사용자 정의 필드",donorName:"기부자 이름",address:"주소",amountColumn:"금액 열",amountColumnHint:"기부금이 포함된 열을 선택하세요",monthlyAmounts:"월별 기부금액 (EUR)",totalAmount:"총 금액 (EUR)",amountInWords:"금액(문자)",period:"기간",taxExemption:"회비 아님 (세금 공제)",taxExemptionHint:"이것은 회비가 아니라 기부금임을 확인합니다",taxExemptionType:"세금 면제 유형",waiverReimbursementYes:"경비 환급 권리 포기 (예)",waiverReimbursementNo:"경비 환급 권리 포기 (아니오)",waiverReimbursementYesHint:"경비 환급 청구권을 포기합니다",waiverReimbursementNoHint:"경비 환급 청구권을 포기하지 않습니다",taxExemptionNotice:"면제 결정서에 따른 세금 면제",taxExemptionNoticeHint:"소득세법 § 10 Abs. 1 Nr. 3 EStG에 따른 면제 통지서가 있습니다",preliminaryCertificate:"예비 증명서 (표준)",preliminaryCertificateHint:"기부금을 위한 임시 세금 증명서",taxNumber:"세금 번호",taxDate:"면제 통지서 발급일",taxDateHint:"세무서에서 면제 통지서를 발급한 날짜",validFrom:"적용 시작일",location:"위치",date:"날짜",signature:"서명",summary:"요약"},colors:{red:"빨간색",black:"검은색",blue:"파란색",green:"초록색",darkBlue:"진한 파란색",brown:"갈색",purple:"보라색",gray:"회색"}},fo={title:"병합된 데이터",rowsCombined:"{{count}}개 행이 결합되었습니다."},bo={title:"언어",english:"English",korean:"한국어"},yo={title:"데이터 대시보드",noDataAvailable:"대시보드에 표시할 데이터가 없습니다",loading:"대시보드 불러오는 중...",showingRows:"{{count}}개 행 표시 중",fromTo:"{{start}}부터 {{end}}까지",dateColumn:"날짜 열",none:"없음",notDate:"날짜 아님",anonymizeNames:"이름 익명화",configureCharts:"대시보드 차트 구성",useFilenameDates:"파일명 날짜 사용 (YYYYMMDD)",dataSeries:"데이터 시리즈 (드래그하여 재정렬 • 클릭하여 토글 • X로 숨기기)",noNumericColumns:"숫자 열이 감지되지 않았습니다. 데이터에 숫자 값이 포함되어 있는지 확인하세요.",rowHeight:"행 높이",resetLayout:"레이아웃 리셋",px:"{{value}}px",trendOverTime:"시계 추이",trendAnalysis:"추세 분석",topContributors:"상위 기여자",donors:"{{count}}명 기여자",showFewer:"적게 보기",showMore:"더 보기",descriptiveStatistics:"통계",distributionHistogram:"분포 히스토그램",paretoAnalysis:"파레토 분석 (80/20 법칙)",rangeDistribution:"범위 분포",period:"기간",weekly:"주간",monthly:"월간",quarterly:"분기",yearly:"연간",lineChart:"선 차트",areaChart:"영역 차트",stackedArea:"누적 영역 차트",downloadAsPng:"PNG로 다운로드",downloadAsJpg:"JPG로 다운로드",taller:"더 높게 (높이 증가)",shorter:"더 낮게 (높이 감소)",fewerBins:"구간 간 줄이기",moreBins:"구간 늘리기",zoomOut:"축소",zoomIn:"확대",panLeft:"왼쪽으로 이동",panRight:"오른쪽으로 이동",reset:"초기화",zoomed:"줌: {{min}} - {{max}}",selectColumns:"추세 분석을 보려면 위에서 값 열을 선택하세요.",enableFilenameDates:'"파일명 날짜 사용"을 활성화하거나 위에서 날짜 열을 선택하세요.',noTrendData:"선택한 열에 대한 추세 데이터가 없습니다.",all:"전체 {{count}}",bins:"{{count}}개 구간"},jo={loadingData:"차트 데이터 불러오는 중...",errorLoading:"차트 불러오기 오류: {{message}}",noDataAvailable:"사용 가능한 데이터 없음",noDataForPeriod:"선택한 기간에 사용 가능한 데이터 없음",noDataForRange:"범위 분포에 사용 가능한 데이터 없음",noDataForPareto:"파레토 분석에 사용 가능한 데이터 없음",noDataForHistogram:"히스토그램에 사용 가능한 데이터 없음",anonymized:"(익명화 #{{index}})",value:"값",count:"개수",percentage:"백분율",byDonorCount:"기부자 수별",byTotalValue:"전체 {{value}}별",totalDonors:"총 {{count}}명 기부자",rangeDistributionSummary:"범위 분포 요약",donors:"기부자",amount:"금액",showPercentiles:"백분위수 표시",hidePercentiles:"백분위수 숨기기",column:"열",sum:"합계",avg:"평균",min:"최소",max:"최대",median:"중앙값",stdDev:"표준 편차",nonNullCount:"개수",percentile25:"25번째",percentile75:"75번째",percentile90:"90번째",percentile95:"95번째",cumulativePercent:"누적 %",percent80Threshold:"80% 임계값",contributors80:"{{count}}명의 기부자가 전체 값의 약 80%를 차지함",mean:"평균",medianLabel:"중앙값"},wo={app:io,uploader:lo,progress:co,sheetSelector:uo,columnSelector:ho,uniqueNames:mo,nameMerging:go,detailedView:xo,pdfExport:po,mergedData:fo,language:bo,dashboard:yo,charts:jo};gs.use(xs).use(ps).init({resources:{en:{translation:oo},ko:{translation:wo}},fallbackLng:"en",lng:localStorage.getItem("excel-processor-language")||"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"],lookupLocalStorage:"excel-processor-language"}});fs.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(Ga,{})}));export{ko as _,Co as c,Do as g};
